(window.__LOADABLE_LOADED_CHUNKS__=window.__LOADABLE_LOADED_CHUNKS__||[]).push([[15,2,10,11,12],{2360:function(e,t,a){"use strict";a.d(t,"d",(function(){return h})),a.d(t,"f",(function(){return b})),a.d(t,"e",(function(){return v})),a.d(t,"k",(function(){return E})),a.d(t,"j",(function(){return y})),a.d(t,"l",(function(){return I})),a.d(t,"a",(function(){return S})),a.d(t,"n",(function(){return O})),a.d(t,"c",(function(){return _})),a.d(t,"b",(function(){return C})),a.d(t,"g",(function(){return k})),a.d(t,"h",(function(){return A})),a.d(t,"m",(function(){return N})),a.d(t,"i",(function(){return T}));var n=a(78),r=a.n(n),i=a(9),o=a(2),c=a.n(o),l=a(102),s=a(142),u=a(189),d=function(e){return Object(s.b)(e,"checkedout")},m=function(e,t){return r()(t,"router.params.status")},p=function(e){return e.getIn(["entities","checkouts"],c.a.Map())},f=function(e){return e.getIn(["entities","bibs"],c.a.Map())},g=function(e){return e.getIn(["borrowing","checkedout","failures"],c.a.Map())},h=Object(i.createSelector)([p],(function(e){return e.groupBy((function(e){return e.get("metadataId")}))})),b=Object(i.createSelector)([function(e){return e.getIn(["borrowing","checkedout","items"],c.a.List())},p,f,u.f],(function(e,t,a,n){return e.map((function(e){return t.get(e)})).filter((function(e){return!!e})).map((function(e){return e.set("bib",a.get(e.get("metadataId")))})).map((function(e){var t=n.some((function(t){return t.get("metadataId")===e.get("metadataId")})),a=e.get("bib")&&!t?e.get("actions",c.a.List()).push("addToShelf"):e.get("actions");return e.set("actions",a)})).toList()})),v=Object(i.createSelector)([d],(function(e){return Object(l.getCountsByStatusFromSummary)(e)})),E=Object(i.createSelector)([function(e){return e.getIn(["borrowing","checkedout","pagination"],c.a.Map())}],(function(e){return e})),y=Object(i.createSelector)([d,m],(function(e,t){return Object(l.getMaterialTypeCountsForStatus)(e,t)})),I=Object(i.createSelector)([d],(function(e){return Object(l.getPresentStatusesFromSummary)(e)})),S=Object(i.createSelector)([d],(function(e){return e.get("quotas",c.a.List())})),O=Object(i.createSelector)([m],(function(e){return e?e.toUpperCase():e})),_=Object(i.createSelector)([function(e){return e.getIn(["borrowing","checkedout","checkoutTransactions"],c.a.Map())}],(function(e){return e})),C=Object(i.createSelector)([function(e){return e.getIn(["borrowing","checkedout","summary","status"],c.a.Map())}],(function(e){return e})),k=Object(i.createSelector)([function(e){return e.getIn(["borrowing","checkedout","view"])}],(function(e){return e})),A=Object(i.createSelector)([function(e){return e.getIn(["borrowing","checkedout","fetching"],!1)}],(function(e){return e})),N=(Object(i.createSelector)([g],(function(e){return e})),Object(i.createSelector)([g,f,p],(function(e,t,a){return e.get("renew",c.a.List()).map((function(e){return e.set("checkout",a.get(e.get("id")))})).map((function(e){return e.set("bib",t.get(e.getIn(["checkout","metadataId"])))}))}))),T=Object(i.createSelector)([function(e){return e.getIn(["borrowing","checkedout","fulfilment"],c.a.Map())}],(function(e){return e}))},2368:function(e,t,a){"use strict";var n=a(396);t.a={openEditor:function(e){return{type:n.a.OPEN_EDITOR,ugcType:e,middlewareData:{authRequired:!0}}},closeEditor:function(e){return{type:n.a.CLOSE_EDITOR,ugcType:e}}}},2371:function(e,t,a){"use strict";a.d(t,"a",(function(){return m}));var n=a(0),r=a.n(n),i=a(5),o=a(118),c=a(38),l=a.n(c),s=a(136),u=a(67),d=a.n(u);function m(e){var t=e.href,a=e.pageId,c=Object(s.readSessionStorageItem)("backToLink"),u=t||(null==c?void 0:c.href),m=a||(null==c?void 0:c.pageId),p=Object(n.useContext)(d.a),f=p.setBackToLinkEnabled,g=p.backToLinkEnabled,h=p.mobileApp;return Object(n.useEffect)((function(){f(!0)}),[f]),!h&&g&&u&&m?r.a.createElement("div",{className:"cp-back-to-link"},r.a.createElement(o.BackLink,{className:"back-to-link",dataKey:"back-to-link",href:u},r.a.createElement("span",{"aria-hidden":!0},r.a.createElement(i.FormattedMessage,{id:"back_to_link_"+m})),r.a.createElement(l.a,null,r.a.createElement(i.FormattedMessage,{id:"sr_back_to_link_"+m})))):null}},2375:function(e,t,a){"use strict";var n=a(247),r=a(516);var i={fetchMap:function(e,t){var a="https://"+e+".stackmap.com/json/?"+Object(r.createQueryString)(t)+"&callback=";return Object(r.jsonp)(a)}},o=a(249);t.a={openStackMap:function(e,t){return{types:[o.a.REQUEST,o.a.SUCCESS,o.a.FAILURE],middlewareData:{gaEvent:Object(n.openStackMap)(t.get("callNumber"))},apiRequest:function(){return i.fetchMap(e.get("domain"),{location:t.get("collection"),callno:t.get("callNumber"),library:t.getIn(["branch","name"])})},apiFailure:function(){return{messaging:null}}}},closeStackMap:function(){return{type:o.a.CLOSE}}}},2376:function(e,t,a){"use strict";a.d(t,"b",(function(){return c})),a.d(t,"a",(function(){return l})),a.d(t,"c",(function(){return s}));var n=a(9),r=a(2),i=a.n(r),o=a(506),c=(Object(o.d)("ratings"),Object(o.a)("ratings")),l=(Object(o.c)("ratings"),Object(o.b)("ratings")),s=Object(n.createSelector)([function(e){return e.getIn(["ugc","ratingsTransactions"],i.a.Map())}],(function(e){return e}))},2382:function(e,t,a){"use strict";a.d(t,"a",(function(){return o}));var n=a(2),r=a.n(n),i=a(9),o=Object(i.createSelector)([function(e){return e.getIn(["ui","openUgcEditors"],r.a.Map())}],(function(e){return e}))},2388:function(e,t,a){"use strict";a.d(t,"a",(function(){return g}));var n=a(0),r=a.n(n),i=a(2358),o=a.n(i),c=a(6),l=a.n(c),s=a(2333),u=a(164),d=a(13),m=a.n(d),p=a(5),f=function(e){function t(){return e.apply(this,arguments)||this}return m()(t,e),t.prototype.render=function(){var e=this.props.contentType;return r.a.createElement("div",{className:"cp-empty-ugc-display"},r.a.createElement(p.FormattedMessage,{id:"ugc_display_no_"+e}))},t}(r.a.PureComponent);function g(e){var t=e.items,a=e.catalogBib,i=e.contentType,c=e.pagination,d=e.transactions,m=e.itemClassName,p=e.renderEditor,g=e.renderItem,h=e.children,b=a.get("metadataId"),v=d.get(b),E=o()(t),y=Object(n.useRef)(null),I=Object(n.useRef)(null),S=Object(n.useRef)({}),O=null==p?void 0:p();return Object(n.useEffect)((function(){if(v&&(y.current=v),y.current&&!t.equals(E)){y.current=null;var e=t.find((function(e){return!E.includes(e)}));e&&S.current[e.get("id")]&&Object(u.setFocusWithinElement)(S.current[e.get("id")]);var a=E.find((function(e){return!t.includes(e)}));!e&&a&&I.current&&Object(u.setFocusWithinElement)(I.current)}}),[v,y,t,E,I,S]),r.a.createElement("div",{className:"cp-ugc-list"},O&&r.a.createElement("div",{ref:I},O),(null==c?void 0:c.get("count"))>0&&r.a.createElement(s.PaginationLabel,{pagination:c,autoFocus:!0}),h,t.size?t.map((function(e){return e?r.a.createElement("div",{key:e.get("id"),ref:function(t){return S.current[e.get("id")]=t},className:l()("ugc-list-item",m)},g(e)):null})):r.a.createElement(f,{contentType:i}))}},2389:function(e,t,a){"use strict";a.d(t,"a",(function(){return h}));var n=a(21),r=a.n(n),i=a(16),o=a.n(i),c=a(0),l=a.n(c),s=a(20),u=a(2372),d=a(2),m=a.n(d),p=a(9),f=Object(p.createSelector)([function(e){return e.getIn(["ui","fullScreenOverlay"],m.a.Map())}],(function(e){return e.filter((function(e){return!!e.get("open")}))})),g=["overlayKey","open"];var h=Object(s.connect)((function(e,t){return{open:t.open||f(e).has(t.overlayKey)}}))((function(e){var t=e.overlayKey,a=e.open,n=o()(e,g);return l.a.createElement(u.FullScreenOverlay,r()({open:a,key:t},n))}))},2390:function(e,t,a){"use strict";a.d(t,"a",(function(){return l}));var n=a(0),r=a.n(n),i=a(5),o=a(88),c=a(135);function l(e){var t=e.ugcType,a=e.catalogBib,n=e.id,l=e.removeUgcAction,s=e.handleClose,u=e.handleSuccess,d=e.transactions.getIn([a.get("metadataId"),n,"isRemoving"],!1);return r.a.createElement("div",{className:"cp-delete-ugc-form"},r.a.createElement(c.ModalHeader,{title:r.a.createElement(i.FormattedMessage,{id:"delete_"+t})}),r.a.createElement(c.ModalContent,null,r.a.createElement(i.FormattedMessage,{id:"delete_"+t+"_confirmation"})),r.a.createElement(c.ModalFooter,{primaryActionButtonText:r.a.createElement(i.FormattedMessage,{id:"delete_button"}),primaryActionButtonTag:o.TransactionalSolidButton,handlePrimaryAction:function(){var e;l(((e={metadataId:a.get("metadataId")})[t+"Id"]=n,e.postSuccess=function(){s(),u&&u()},e))},isLoading:d}))}},2398:function(e,t,a){"use strict";a.d(t,"a",(function(){return N}));var n,r,i,o,c=a(26),l=a.n(c),s=a(13),u=a.n(s),d=a(0),m=a.n(d),p=a(32),f=a(512),g=function(e){function t(t){var a;return a=e.call(this,t)||this,Object(p.bindAll)(l()(a)),a}u()(t,e);var a=t.prototype;return a.handleUpdateRating=function(e){return this.props.userRating?this.props.ratingsActions.changeItemRating(this.props.metadataId,e):this.props.ratingsActions.rateItem(this.props.metadataId,e)},a.handleRemoveRating=function(){return this.props.ratingsActions.removeItemRating(this.props.metadataId,this.props.userRating.get("id"))},a.handleSelect=function(e){e>0?this.handleUpdateRating(e):this.handleRemoveRating()},a.render=function(){var e=this.props,t=e.metadataId,a=e.userRating,n=e.ratingsTransactions,r=e.size,i=e.useLibraryBranding,o=a?a.get("rating"):0,c=n.getIn([t,"isLoading"],!1);return m.a.createElement(f.RatingControl,{className:"cp-user-rating-dropdown",handleSelect:this.handleSelect,rating:o,isLoading:c,size:r,useLibraryBranding:i})},t}(m.a.PureComponent),h=a(20),b=a(45),v=a(2376),E=a(33),y=a(12),I=a.n(y);var S={getItemRatings:function(e,t){var a=e.metadataIds,r=t.route(n||(n=I()(["/libraries/","/ugc/ratings"])),":librarySubdomain");return t.get(r,{query:{metadataIds:a}})},rateItem:function(e,t){var a=e.metadataId,n=e.rating,i=t.route(r||(r=I()(["/libraries/","/ugc/ratings/",""])),":librarySubdomain",a);return t.post(i,{metadataId:a,rating:n})},changeItemRating:function(e,t){var a=e.metadataId,n=e.rating,r=t.route(i||(i=I()(["/libraries/","/ugc/ratings/",""])),":librarySubdomain",a);return t.patch(r,{metadataId:a,rating:n})},removeItemRating:function(e,t){var a=e.metadataId,n=t.route(o||(o=I()(["/libraries/","/ugc/ratings/",""])),":librarySubdomain",a);return t.delete(n)}},O=a(144),_=a(42),C=a(125);var k={getItemRatings:function(e){return{metadataIds:e,types:[O.a.GET_ITEM_RATING_REQUEST,O.a.GET_ITEM_RATING_SUCCESS,O.a.GET_ITEM_RATING_FAILURE],middlewareData:{authRequired:!0},apiRequest:function(t,a){return S.getItemRatings({metadataIds:e,userId:Object(E.c)(t).get("id")},a)}}},rateItem:function(e,t){return{metadataIds:[e],types:[O.a.RATE_ITEM_REQUEST,O.a.RATE_ITEM_SUCCESS,O.a.RATE_ITEM_FAILURE],middlewareData:{authRequired:!0},apiRequest:function(a,n){return S.rateItem({metadataId:e,rating:t,userId:Object(E.c)(a).get("id")},n)},apiSuccess:function(t,a){return{messaging:Object(C.a)({response:t,store:a,metadataId:e,type:"rating"})}}}},changeItemRating:function(e,t){return{metadataIds:[e],types:[O.a.CHANGE_ITEM_RATING_REQUEST,O.a.CHANGE_ITEM_RATING_SUCCESS,O.a.CHANGE_ITEM_RATING_FAILURE],middlewareData:{authRequired:!0},apiRequest:function(a,n){return S.changeItemRating({metadataId:e,rating:t,userId:Object(E.c)(a).get("id")},n)},apiSuccess:function(){return{messaging:Object(C.a)({metadataId:e,type:"rating",updated:!0})}}}},removeItemRating:function(e,t){return{metadataIds:[e],types:[O.a.REMOVE_ITEM_RATING_REQUEST,O.a.REMOVE_ITEM_RATING_SUCCESS,O.a.REMOVE_ITEM_RATING_FAILURE],middlewareData:{authRequired:!0},apiRequest:function(t,a){return S.removeItemRating({metadataId:e,userId:t.getIn(["auth","currentUserId"])},a)},apiSuccess:function(){return{messaging:Object(_.a)("success_rating_clear_message"),deletedEntities:["ugc.ratings."+t]}}}}},A=function(e){function t(){return e.apply(this,arguments)||this}u()(t,e);var a=t.prototype;return a.componentDidMount=function(){this.props.currentUser&&!this.props.userRating&&this.props.ratingsActions.getItemRatings([this.props.metadataId])},a.render=function(){return m.a.createElement(g,this.props)},t}(m.a.PureComponent),N=Object(h.connect)((function(e,t){return{ratingsTransactions:Object(v.c)(e),userRating:Object(v.a)(e).get(t.metadataId),currentUser:Object(E.c)(e)}}),(function(e){return{ratingsActions:Object(b.bindActionCreators)(k,e)}}))(A)},2400:function(e,t,a){"use strict";a.d(t,"a",(function(){return l}));var n=a(0),r=a.n(n),i=a(520),o=a(2367),c=a.n(o);function l(e){var t=e.bibBrief,a=t.get("title"),n=t.get("authors"),o=t.get("format");return r.a.createElement("div",{className:"cp-bib-screen-reader-description"},a,o?r.a.createElement(c.a,{format:o.toUpperCase()}):null," ",r.a.createElement(i.a,{authors:n,renderAsLink:!1}))}},2401:function(e,t,a){"use strict";a.d(t,"a",(function(){return c})),a.d(t,"b",(function(){return l}));var n=a(2),r=a.n(n),i=a(9),o=function(e){return e.getIn(["ui","stackMap"],r.a.Map())},c=Object(i.createSelector)([o],(function(e){return e.get("data")})),l=Object(i.createSelector)([o],(function(e){return e.get("stackMapTransactions")}))},2416:function(e,t,a){"use strict";a.d(t,"c",(function(){return l})),a.d(t,"e",(function(){return s})),a.d(t,"a",(function(){return u})),a.d(t,"b",(function(){return d})),a.d(t,"d",(function(){return m}));var n=a(9),r=a(2),i=a.n(r),o=a(506),c=a(70),l=Object(o.a)("videos"),s=Object(n.createSelector)([function(e){return e.getIn(["ugc","videosTransactions"],i.a.Map())}],(function(e){return e})),u=Object(o.b)("videos"),d=Object(n.createSelector)([function(e){return e.getIn(["ugc","videos","results"],i.a.List())},c.P],(function(e,t){return e.map((function(e){return t.get(e.toString())}))})),m=Object(n.createSelector)([function(e){return e.getIn(["ugc","videos","pagination"],i.a.Map())}],(function(e){return e}))},2418:function(e,t,a){"use strict";a.d(t,"a",(function(){return m}));var n=a(0),r=a.n(n),i=a(295),o=a(20),c=a(5),l=a(82),s=a(135),u=a(2360);function d(e){var t=e.bib,a=e.accountId,i=e.checkoutActions,d=e.checkoutItem,m=Object(c.useIntl)(),p=Object(n.useState)(!1),f=p[0],g=p[1],h=Object(o.useSelector)(u.i),b=d.get("checkoutId"),v=t.getIn(["briefInfo","title"]);return Object(n.useEffect)((function(){i.getFulfilment({checkoutId:b,accountId:a})}),[b,a,i]),r.a.createElement("div",{className:"cp-fulfilment-content"},r.a.createElement(s.ModalHeader,{title:r.a.createElement(c.FormattedMessage,{id:"access_this_item"})}),r.a.createElement(s.ModalContent,null,h.get("fetching")||!f?r.a.createElement("div",{className:"loading"},r.a.createElement(l.Spinner,{primary:!0})):null,!h.get("fetching")&&h.get("url")?r.a.createElement("iframe",{src:h.get("url"),frameBorder:"0",allowFullScreen:!0,onLoad:function(){return g(!0)},title:m.formatMessage({id:"access_title"},{title:v}),"data-key":"fulfilment-iframe"}):null),r.a.createElement(s.ModalFooter,{renderPrimaryAction:function(){return null},secondaryActionButtonText:r.a.createElement(c.FormattedMessage,{id:"button_close"})}))}function m(e){var t=e.bib,a=e.modalKey,n=e.accountId,o=e.checkoutItem,c=e.checkoutActions,l=e.modalActions;return r.a.createElement(i.a,{className:"cp-fulfilment-modal",size:"large",modalKey:a,handleClose:function(){l.closeModal(a)}},r.a.createElement(d,{bib:t,accountId:n,checkoutActions:c,checkoutItem:o}))}},2419:function(e,t,a){"use strict";a.d(t,"a",(function(){return E}));var n=a(26),r=a.n(n),i=a(13),o=a.n(i),c=a(0),l=a.n(c),s=a(5),u=a(135),d=a(88),m=a(32),p=a(511),f=a.n(p),g=a(504),h=a(295),b=a(514),v=a(518),E=function(e){function t(t){var a;return(a=e.call(this,t)||this).state={addToShelf:!1},Object(m.bindAll)(r()(a)),a}o()(t,e);var a=t.prototype;return a.handleClose=function(){this.props.modalActions.closeModal(this.props.modalKey)},a.handleAddToShelf=function(){this.setState((function(e){return{addToShelf:!e.addToShelf}}))},a.handleCheckIn=function(e){var t=this;e.preventDefault();var a=this.props,n=a.accountId,r=a.metadataId,i=a.checkoutId,o=a.messagingId,c=a.shelfActions,l=a.bib;this.props.checkIn({accountId:n,metadataId:r,messagingId:o,checkoutId:i,postSuccess:function(){t.state.addToShelf&&c.addToShelf({metadataId:l.getIn(["briefInfo","metadataId"]),shelfToAdd:"completed"}),t.handleClose()}})},a.render=function(){var e=this.props,t=e.modalKey,a=e.bib,n=e.isLoading;return l.a.createElement(h.a,{className:"cp-return-checkout-item-confirmation-modal",modalKey:t,handleClose:this.handleClose},l.a.createElement(u.ModalHeader,{title:l.a.createElement(s.FormattedMessage,{id:"return_confirmation"})}),l.a.createElement(u.ModalContent,null,l.a.createElement("div",{className:"return-checkout-item-modal-content"},l.a.createElement("div",{className:"return-checkout-item-info"},l.a.createElement("div",{className:"return-checkout-item-item-jacket-cover"},l.a.createElement(b.a,{src:a.getIn(["briefInfo","jacket"]),format:a.getIn(["briefInfo","format"]),alt:""})),l.a.createElement(g.a,{bib:a.getIn(["briefInfo"]),renderTitleAsLink:!1,renderAuthorsAsLink:!1,titleTag:"h3"},l.a.createElement(v.a,{bib:a}))),l.a.createElement(s.FormattedMessage,{id:"keep_a_reference",tagName:"strong"}),l.a.createElement(f.a,{id:"add-overdrive-add-to-shelf",dataKey:"add-overdrive-to-completed",handleChange:this.handleAddToShelf,checked:this.state.addToShelf,label:l.a.createElement(s.FormattedMessage,{id:"add_to_my_shelf_completed"})}))),l.a.createElement(u.ModalFooter,{primaryActionButtonTag:d.TransactionalSolidButton,primaryActionButtonText:l.a.createElement(s.FormattedMessage,{id:"digital_return_now"}),handlePrimaryAction:this.handleCheckIn,isLoading:n}))},t}(l.a.PureComponent)},2422:function(e,t,a){"use strict";a.d(t,"b",(function(){return l})),a.d(t,"a",(function(){return s}));var n=a(2),r=a.n(n),i=a(9),o=a(70),c=a(33),l=Object(i.createSelector)([o.w,c.c],(function(e,t){var a=e.filter((function(e){return(null==e?void 0:e.get("ownerId"))===(null==t?void 0:t.get("id"))}));return r.a.Map(a.toList().map((function(e){return[e.get("contentId"),e]})))})),s=Object(i.createSelector)([function(e){return e.getIn(["ugc","likes","results"],r.a.List())},o.w],(function(e,t){return e.map((function(e){return t.get(e.toString())}))}));Object(i.createSelector)([function(e){return e.getIn(["ugc","likes","pagination"],r.a.Map())}],(function(e){return e}))},2423:function(e,t){function a(e,t){e.onload=function(){this.onerror=this.onload=null,t(null,e)},e.onerror=function(){this.onerror=this.onload=null,t(new Error("Failed to load "+this.src),e)}}function n(e,t){e.onreadystatechange=function(){"complete"!=this.readyState&&"loaded"!=this.readyState||(this.onreadystatechange=null,t(null,e))}}e.exports=function(e,t,r){var i=document.head||document.getElementsByTagName("head")[0],o=document.createElement("script");"function"==typeof t&&(r=t,t={}),t=t||{},r=r||function(){},o.type=t.type||"text/javascript",o.charset=t.charset||"utf8",o.async=!("async"in t)||!!t.async,o.src=e,t.attrs&&function(e,t){for(var a in t)e.setAttribute(a,t[a])}(o,t.attrs),t.text&&(o.text=""+t.text),("onload"in o?a:n)(o,r),o.onload||a(o,r),i.appendChild(o)}},2444:function(e,t,a){"use strict";a.d(t,"a",(function(){return q}));var n=a(0),r=a.n(n),i=a(6),o=a.n(i),c=a(20),l=a(5),s=a(88),u=a(82),d=a(2415),m=a.n(d),p=a(2406),f=a.n(p),g=a(118),h=a(512),b=a(67),v=a.n(b),E=a(38),y=a.n(E),I=a(507),S=a(189),O=a(2523),_=a(2524),C=a(2501),k=a(2519),A=a(13),N=a.n(A),T=a(45),M=a(213),j=a(2450),F=a(295),L=a(2),w=a.n(L),B=a(135),R=a(2357),D=a(2422),P=a(70);function x(e){var t=e.contentId,a=e.count,i=e.likesActions,o=Object(c.useSelector)(D.a).filter((function(e){return e.get("contentId")===t})),d=Object(c.useSelector)(P.O),p=Object(c.useSelector)((function(e){return e.getIn(["ugc","likes","isFetching"],!1)})),f=Object(n.useState)(w.a.List()),h=f[0],b=f[1],v=Object(n.useState)(1),E=v[0],I=v[1];return Object(n.useEffect)((function(){o.isSubset(h)||b(E>1?h.concat(o):o)}),[o,h,b,E]),Object(n.useEffect)((function(){i.getLikes({contentId:t,page:E})}),[E,t,i]),r.a.createElement("div",{className:"cp-ugc-likes-modal"},r.a.createElement(B.ModalHeader,{title:r.a.createElement(l.FormattedMessage,{id:"likes_count",values:{count:a}})}),r.a.createElement(B.ModalContent,null,1===E&&p?r.a.createElement(R.TableStencil,null):r.a.createElement(r.a.Fragment,null,r.a.createElement("ul",{className:"likes-list"},h.map((function(e){return function(e){var t=d.get(e.get("ownerId").toString());return r.a.createElement("li",{className:"ugc-likes-user",key:e.get("id")},r.a.createElement(m.a,{userIdentity:t,size:"xs"}),r.a.createElement(g.Link,{href:"/user_profile/"+t.get("id"),dataKey:"ugc-likes-owner"},r.a.createElement("span",{"aria-hidden":!0},t.get("name")),r.a.createElement(y.a,null,r.a.createElement(l.FormattedMessage,{id:"sr_liked_ugc_user",values:{username:t.get("name")}}))))}(e)}))),h.size<a&&r.a.createElement(s.TextButton,{handleClick:function(){return I(E+1)},className:"show-more-likes-button",dataKey:"show-more-likes-button",isLoading:p,size:"small"},r.a.createElement("span",null,r.a.createElement("span",{"aria-hidden":!0},r.a.createElement(l.FormattedMessage,{id:"button_show_more"})),r.a.createElement(y.a,null,r.a.createElement(l.FormattedMessage,{id:"button_show_more_liked_ugc_users"}))),r.a.createElement(u.ChevronDown,null)))))}function U(e){var t=e.contentId,a=e.count,n=e.modalActions,i=e.likesActions,o="ugc-likes-modal-"+t;return r.a.createElement("div",{className:"cp-ugc-likes-button"},r.a.createElement(s.TextButton,{handleClick:function(){n.openModal(o,{authRequired:!1})},className:"ugc-likes-modal-button",dataKey:"ugc-likes-modal-button",size:"small"},r.a.createElement(l.FormattedMessage,{id:"existing_likes",values:{count:a}})),r.a.createElement(F.a,{modalKey:o,handleClose:function(){return n.closeModal(o)},size:"small"},r.a.createElement(x,{contentId:t,count:a,likesActions:i})))}var K=function(e){function t(){return e.apply(this,arguments)||this}return N()(t,e),t.prototype.render=function(){return r.a.createElement(U,this.props)},t}(r.a.PureComponent),H=Object(c.connect)(null,(function(e){return{modalActions:Object(T.bindActionCreators)(M.a,e),likesActions:Object(T.bindActionCreators)(j.a,e)}}))(K),z=a(2529);function q(e){var t,a,i,d,p,b=e.ugcType,E=e.catalogBib,A=e.author,N=e.displayStaffBadge,T=e.compact,M=e.createdDate,j=e.rating,F=e.likesCount,L=e.isLikedByCurrentUser,w=e.id,B=e.children,R=e.className,D=e.optionsDropdownRef,P=e.handleDelete,x=e.handleEdit,U=e.handleLike,K=e.handleUnlike,q=e.hidePermalink,V=Object(n.useContext)(v.a).mobileApp,G=Object(C.a)(w),W=G.flags,Y=G.contentIsHidden,Q=G.placeholder,Z=G.toggleContent,X=Object(c.useSelector)(S.f).get(E.get("metadataId"));return r.a.createElement("div",{className:o()("cp-text-ugc-display",R)},(a="/user_profile/"+A.get("id"),i=r.a.createElement("div",{className:"right-side"},r.a.createElement(_.a,{author:A,flags:W,contentIsHidden:Y,toggleContent:Z,ugcType:b}),r.a.createElement(O.a,{author:A,shelfItem:X}),r.a.createElement(z.a,{id:w,ugcType:b,author:A,handleDelete:P,handleEdit:x,ref:D,hidePermalink:q})),d=r.a.createElement(l.FormattedMessage,{id:"ugc_display_rating_sr_label",values:{username:A.get("name"),rating:j/20}}),p=r.a.createElement("div",null,!T&&r.a.createElement(I.a,{value:M}),!T&&j&&r.a.createElement(h.RatingStars,{className:"ugc-display-rating",rating:j,screenReaderLabel:d})),r.a.createElement("div",{className:"ugc-display__header"},!T&&r.a.createElement(m.a,{userIdentity:A,size:"xs"}),r.a.createElement("div",{className:"user-area"},A.get("active")&&!V?r.a.createElement(g.Link,{href:a,dataKey:"bib-ugc-display-author"},r.a.createElement("span",{"aria-hidden":!0},A.get("name")),r.a.createElement(y.a,null,r.a.createElement(l.FormattedMessage,{id:"sr_ugc_username",values:{ugcType:b,username:A.get("name")}}))):A.get("name"),r.a.createElement(f.a,{userIdentity:A,displayStaffBadge:N,ugcType:b})),i,p)),Y?Q:B,r.a.createElement("div",{className:"ugc-display__footer"},!!F&&r.a.createElement(H,{contentId:w,count:F}),"comment"===b&&(L?r.a.createElement(s.TextButton,{className:"ugc-display__unlike-button",dataKey:"ugc-display-unlike",size:"small",renderLeadingIcon:function(){return r.a.createElement(u.Heart,null)},handleClick:K},r.a.createElement(l.FormattedMessage,{id:"you_liked_this"})):r.a.createElement(s.TextButton,{className:"ugc-display__like-button",dataKey:"ugc-display-like",size:"small",renderLeadingIcon:function(){return r.a.createElement(u.HeartOutline,null)},handleClick:U},r.a.createElement("span",{"aria-hidden":!0},r.a.createElement(l.FormattedMessage,{id:"like"})),r.a.createElement(y.a,null,r.a.createElement(l.FormattedMessage,{id:"sr_like",values:{ugcType:b}})))),(null===(t=W.get("flaggableTypes"))||void 0===t?void 0:t.size)>0&&r.a.createElement(k.a,{id:w,ugcType:b})))}q.defaultProps={displayStaffBadge:!0,hidePermalink:!1}},2446:function(e,t,a){"use strict";a.d(t,"a",(function(){return I}));var n=a(26),r=a.n(n),i=a(13),o=a.n(i),c=a(0),l=a.n(c),s=a(5),u=a(32),d=a(88),m=a(300),p=a(82),f=function(e){function t(t){var a;return a=e.call(this,t)||this,Object(u.bindAll)(r()(a)),a}o()(t,e);var a=t.prototype;return a.toggleSpoilers=function(e){this.props.contentWarningActions.toggleSpoilers(e)},a.toggleOffensiveContent=function(e){this.props.contentWarningActions.toggleOffensiveContent(e)},a.render=function(){var e=this,t=this.props,a=t.flaggedContentVisibility,n=t.flags,r=n.some((function(e){return e.get("flaggedTypes").includes(m.a.SPOILER)})),i=n.some((function(e){return e.get("flaggedTypes").includes(m.a.OFFENSIVE)}));return r||i?l.a.createElement("div",{className:"cp-content-warning-panel"},l.a.createElement("div",{className:"icon-wrapper"},l.a.createElement(p.Warning,null)),l.a.createElement("div",{className:"body"},l.a.createElement("span",{className:"title"},l.a.createElement(s.FormattedMessage,{id:"content_warning_title"})),l.a.createElement(s.FormattedMessage,{id:"content_warning_text"}),l.a.createElement("br",null),r&&(a.get("spoilersVisible")?l.a.createElement(d.SecondaryGhostButton,{handleClick:function(){return e.toggleSpoilers(!1)},size:"small",dataKey:"hide-spoilers"},l.a.createElement(s.FormattedMessage,{id:"hide_spoilers"})):l.a.createElement(d.SecondaryGhostButton,{handleClick:function(){return e.toggleSpoilers(!0)},size:"small",dataKey:"show-spoilers"},l.a.createElement(s.FormattedMessage,{id:"show_spoilers"}))),i&&(a.get("offensiveContentVisible")?l.a.createElement(d.SecondaryGhostButton,{handleClick:function(){return e.toggleOffensiveContent(!1)},size:"small",dataKey:"hide-offensive-content"},l.a.createElement(s.FormattedMessage,{id:"hide_offensive_content"})):l.a.createElement(d.SecondaryGhostButton,{handleClick:function(){return e.toggleOffensiveContent(!0)},size:"small",dataKey:"show-offensive-content"},l.a.createElement(s.FormattedMessage,{id:"show_offensive_content"}))))):null},t}(l.a.PureComponent),g=a(20),h=a(45),b=a(2502),v=a(70),E=a(2528),y=function(e){function t(){return e.apply(this,arguments)||this}return o()(t,e),t.prototype.render=function(){return l.a.createElement(f,this.props)},t}(l.a.PureComponent),I=Object(g.connect)((function(e){return{flags:Object(v.r)(e),flaggedContentVisibility:Object(b.a)(e).get("all")}}),(function(e){return{contentWarningActions:Object(h.bindActionCreators)(E.a,e)}}))(y)},2449:function(e,t,a){"use strict";a.d(t,"a",(function(){return o}));var n=a(0),r=a.n(n),i=a(188);function o(e){var t=e.messageIds,a=void 0===t?[]:t;return 0===a.length?null:r.a.createElement("div",null,a.map((function(e){return r.a.createElement("div",{className:"cp-hold-info-message",key:"hold_info_msg_block"+e},r.a.createElement(i.FormattedHTMLMessage,{id:"hold_info_msg_block"+e}))})))}},2450:function(e,t,a){"use strict";var n,r,i,o=a(12),c=a.n(o);var l={addLike:function(e,t){var a=e.contentId,r=t.route(n||(n=c()(["/libraries/","/ugc/likes"])),":librarySubdomain");return t.post(r,{contentId:a})},removeLike:function(e,t){var a=e.contentId,n=t.route(r||(r=c()(["/libraries/","/ugc/likes"])),":librarySubdomain");return t.delete(n,{contentId:a})},getLikes:function(e,t){var a=e.contentId,n=e.size,r=void 0===n?6:n,o=e.page,l=t.route(i||(i=c()(["/libraries/","/ugc/likes"])),":librarySubdomain");return t.get(l,{query:{contentId:a,size:r,page:o}})}},s=a(182);t.a={addLike:function(e){var t=e.contentId,a=e.postSuccess;return{types:[s.a.ADD_LIKE_REQUEST,s.a.ADD_LIKE_SUCCESS,s.a.ADD_LIKE_FAILURE],middlewareData:{authRequired:!0},apiRequest:function(e,a){return l.addLike({contentId:t},a)},postSuccess:a}},removeLike:function(e){var t=e.id,a=e.contentId,n=e.postSuccess;return{types:[s.a.REMOVE_LIKE_REQUEST,s.a.REMOVE_LIKE_SUCCESS,s.a.REMOVE_LIKE_FAILURE],middlewareData:{authRequired:!0},apiRequest:function(e,t){return l.removeLike({contentId:a},t)},apiSuccess:function(){return function(e){return{deletedEntities:["ugc.likes."+e]}}(t)},postSuccess:n}},getLikes:function(e){var t=e.contentId,a=e.size,n=e.page;return{types:[s.a.GET_LIKES_REQUEST,s.a.GET_LIKES_SUCCESS,s.a.GET_LIKES_FAILURE],apiRequest:function(e,r){return l.getLikes({contentId:t,size:a,page:n},r)}}}}},2456:function(e,t,a){"use strict";a.d(t,"b",(function(){return l})),a.d(t,"d",(function(){return s})),a.d(t,"e",(function(){return u})),a.d(t,"a",(function(){return d})),a.d(t,"c",(function(){return m}));var n=a(9),r=a(2),i=a.n(r),o=a(506),c=a(70),l=Object(o.a)("comments"),s=Object(n.createSelector)([function(e){return e.getIn(["ugc","commentsTransactions"],i.a.Map())}],(function(e){return e})),u=Object(o.b)("comments"),d=Object(n.createSelector)([function(e){return e.getIn(["ugc","comments","results"],i.a.List())},c.h],(function(e,t){return e.map((function(e){return t.get(e.toString())}))})),m=Object(n.createSelector)([function(e){return e.getIn(["ugc","comments","pagination"],i.a.Map())}],(function(e){return e}))},2463:function(e,t,a){"use strict";a.d(t,"a",(function(){return h}));var n=a(13),r=a.n(n),i=a(0),o=a.n(i),c=a(5),l=a(118),s=a(82),u=function(e){function t(){for(var t,a=arguments.length,n=new Array(a),r=0;r<a;r++)n[r]=arguments[r];return(t=e.call.apply(e,[this].concat(n))||this).handleClick=function(){var e=t.props,a=e.stackMapActions,n=e.bibItem,r=e.currentLibrary,i=e.handleClick;a.openStackMap(r.get("stackMap"),n),i&&i()},t}return r()(t,e),t.prototype.render=function(){var e=this.props,t=e.bibItem,a=e.currentLibrary.get("stackMap");return a.get("enabled")&&a.get("supportedBranches").includes(t.getIn(["branch","name"]))&&t.get("collection")&&t.get("callNumber")&&"UNAVAILABLE"!==t.getIn(["availability","statusType"])?o.a.createElement(l.Link,{className:"cp-stack-map-link",href:"#stack-map-display",dataKey:"stack-map-link",handleClick:this.handleClick,preventDefault:!0},o.a.createElement(s.ShelfMap,null),o.a.createElement(c.FormattedMessage,{id:"shelf_map"})):null},t}(o.a.PureComponent),d=a(20),m=a(45),p=a(52),f=a(2375),g=function(e){function t(){return e.apply(this,arguments)||this}return r()(t,e),t.prototype.render=function(){return o.a.createElement(u,this.props)},t}(o.a.PureComponent),h=Object(d.connect)((function(e){return{currentLibrary:Object(p.b)(e)}}),(function(e){return{stackMapActions:Object(m.bindActionCreators)(f.a,e)}}))(g)},2472:function(e,t,a){"use strict";var n=a(1);Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return r.default}});var r=n(a(2562))},2500:function(e,t,a){"use strict";a.d(t,"b",(function(){return l})),a.d(t,"d",(function(){return s})),a.d(t,"a",(function(){return u})),a.d(t,"c",(function(){return d}));var n=a(9),r=a(2),i=a.n(r),o=a(506),c=a(70),l=Object(o.e)("quotations"),s=(Object(o.c)("quotations"),Object(n.createSelector)([function(e){return e.getIn(["ugc","quotationsTransactions"],i.a.Map())}],(function(e){return e}))),u=Object(n.createSelector)([function(e){return e.getIn(["ugc","quotations","results"],i.a.List())},c.H],(function(e,t){return e.map((function(e){return t.get(e.toString())}))})),d=Object(n.createSelector)([function(e){return e.getIn(["ugc","quotations","pagination"],i.a.Map())}],(function(e){return e}))},2501:function(e,t,a){"use strict";a.d(t,"a",(function(){return p}));var n=a(0),r=a.n(n),i=a(2),o=a.n(i),c=a(5),l=a(20),s=a(2502),u=a(70),d=a(2528),m=a(300);function p(e){var t=Object(l.useSelector)(u.r),a=Object(l.useSelector)(s.a),n=(null==t?void 0:t.get(e.toString()))||o.a.Map(),i=n.get("flaggedTypes",o.a.List());var p,f,g=Object(l.useDispatch)();return{flags:n,contentIsHidden:(f=function(){if(!a)return{spoilersVisible:!1,offensiveContentVisible:!1};var t=a.has(e.toString())?e.toString():"all";return{spoilersVisible:a.getIn([t,"spoilersVisible"]),offensiveContentVisible:a.getIn([t,"offensiveContentVisible"])}}(),i.includes(m.a.SPOILER)&&!f.spoilersVisible||i.includes(m.a.OFFENSIVE)&&!f.offensiveContentVisible),placeholder:(p=null,i.includes(m.a.SPOILER)&&(p=r.a.createElement(c.FormattedMessage,{id:"content_is_spoiler"})),i.includes(m.a.OFFENSIVE)&&(p=r.a.createElement(c.FormattedMessage,{id:"content_is_offensive"})),i.includes(m.a.OFFENSIVE)&&i.includes(m.a.SPOILER)&&(p=r.a.createElement(c.FormattedMessage,{id:"content_is_offensive_spoiler"})),r.a.createElement("span",{className:"placeholder"},p)),toggleContent:function(t){g(d.a.toggleContent({contentId:e,value:t}))}}}},2502:function(e,t,a){"use strict";a.d(t,"a",(function(){return c}));var n=a(2),r=a.n(n),i=a(9),o=a(33),c=Object(i.createSelector)([function(e){return e.getIn(["ui","contentWarnings"],r.a.Map())},o.c],(function(e,t){var a=e.getIn(["defaults","spoilersVisible"]),n=e.getIn(["defaults","offensiveContentVisible"]);t&&(a=!t.getIn(["preferences","flags","filterSpoiler"]),n=!t.getIn(["preferences","flags","filterOffensive"]));var i=e.delete("defaults");return r.a.fromJS({all:{spoilersVisible:a,offensiveContentVisible:n}}).merge(i)}))},2503:function(e,t,a){"use strict";a.d(t,"c",(function(){return l})),a.d(t,"e",(function(){return s})),a.d(t,"a",(function(){return u})),a.d(t,"b",(function(){return d})),a.d(t,"d",(function(){return m}));var n=a(9),r=a(2),i=a.n(r),o=a(506),c=a(70),l=Object(o.a)("summaries"),s=Object(n.createSelector)([function(e){return e.getIn(["ugc","summariesTransactions"],i.a.Map())}],(function(e){return e})),u=Object(o.b)("summaries"),d=Object(n.createSelector)([function(e){return e.getIn(["ugc","summaries","results"],i.a.List())},c.N],(function(e,t){return e.map((function(e){return t.get(e.toString())}))})),m=Object(n.createSelector)([function(e){return e.getIn(["ugc","summaries","pagination"],i.a.Map())}],(function(e){return e}))},2519:function(e,t,a){"use strict";a.d(t,"a",(function(){return q}));var n,r=a(13),i=a.n(r),o=a(0),c=a.n(o),l=a(20),s=a(45),u=a(213),d=a(5),m=a(88),p=a(82),f=a(295),g=a(38),h=a.n(g),b=a(9),v=a(2),E=a.n(v),y=Object(b.createSelector)([function(e){return e.getIn(["ugc","flagsTransactions"],E.a.Map())}],(function(e){return e})),I=a(12),S=a.n(I);var O={addFlag:function(e,t){var a=e.contentId,r=e.userId,i=e.flagType,o=e.reason,c=e.violationType,l=t.route(n||(n=S()(["/libraries/","/ugc/flags"])),":librarySubdomain");return t.post(l,{contentId:a,userId:r,flagType:i,reason:o,violationType:c})}},_=a(300);var C={addFlag:function(e){var t=e.contentId,a=e.userId,n=e.flagType,r=e.reason,i=e.violationType,o=e.postSuccess;return{contentId:t,types:[_.c.ADD_FLAG_REQUEST,_.c.ADD_FLAG_SUCCESS,_.c.ADD_FLAG_FAILURE],apiRequest:function(e,o){return O.addFlag({contentId:t,userId:a,flagType:n,reason:r,violationType:i},o)},postSuccess:o}}},k=a(33),A=a(70),N=a(135),T=a(2455),M=a.n(T),j=a(118),F=a(511),L=a.n(F),w=function(e){function t(){for(var t,a=arguments.length,n=new Array(a),r=0;r<a;r++)n[r]=arguments[r];return(t=e.call.apply(e,[this].concat(n))||this).state={violationType:null,standardsReviewed:!1},t.handleViolationTypeChange=function(e){return t.setState({violationType:e})},t}return i()(t,e),t.prototype.render=function(){var e=this,t=this.props,a=t.handleSubmit,n=t.isLoading;return c.a.createElement("div",{className:"cp-standards-violation-form"},c.a.createElement(N.ModalHeader,{title:c.a.createElement(d.FormattedMessage,{id:"flag_appropriate_use_standards"})}),c.a.createElement(N.ModalContent,null,c.a.createElement("span",{className:"use-standards-note"},c.a.createElement(d.FormattedMessage,{id:"appropriate_use_standards_note",values:{link:function(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];return c.a.createElement("a",{href:"/info/terms","data-key":"use-standards-link"},t)}}})),c.a.createElement("ul",{className:"violation-types-list"},Object.values(_.b).map((function(t){return c.a.createElement(M.a,{checked:e.state.violationType===t,handleChange:e.handleViolationTypeChange,id:"select-"+t,label:c.a.createElement(d.FormattedMessage,{id:"violation_reason_"+t.toLowerCase()}),name:"select-violation-type",value:t,key:t,dataKey:"select-"+t})}))),c.a.createElement(L.a,{id:"standards-reviewed-confirmation",dataKey:"standards-reviewed-confirmation",label:c.a.createElement(d.FormattedMessage,{id:"standards_reviewed"}),checked:this.state.standardsReviewed,handleChange:function(t){return e.setState({standardsReviewed:t})}})),c.a.createElement(N.ModalFooter,{primaryActionButtonText:c.a.createElement(d.FormattedMessage,{id:"button_submit"}),primaryActionButtonTag:m.TransactionalSolidButton,handlePrimaryAction:function(){return a({violationType:e.state.violationType})},isLoading:n,disabled:!this.state.violationType||!this.state.standardsReviewed}))},t}(c.a.PureComponent),B=a(517),R=a.n(B),D=function(e){function t(){for(var t,a=arguments.length,n=new Array(a),r=0;r<a;r++)n[r]=arguments[r];return(t=e.call.apply(e,[this].concat(n))||this).state={offensiveDetails:""},t}return i()(t,e),t.prototype.render=function(){var e=this,t=this.props,a=t.handleSubmit,n=t.isLoading;return c.a.createElement("div",{className:"cp-offensive-content-form"},c.a.createElement(N.ModalHeader,{title:c.a.createElement(d.FormattedMessage,{id:"flag_offensive"})}),c.a.createElement(N.ModalContent,null,c.a.createElement(d.FormattedMessage,{id:"offensive_note"}),c.a.createElement(R.a,{value:this.state.offensiveDetails,handleChange:function(t){return e.setState({offensiveDetails:t})},id:"offensive-content-reason-text-area",maxLength:1e3,label:c.a.createElement(d.FormattedMessage,{id:"reason"}),fitToText:!0,minHeight:"9rem"})),c.a.createElement(N.ModalFooter,{primaryActionButtonText:c.a.createElement(d.FormattedMessage,{id:"button_submit"}),primaryActionButtonTag:m.TransactionalSolidButton,handlePrimaryAction:function(){return a({offensiveDetails:e.state.offensiveDetails})},isLoading:n,disabled:""===this.state.offensiveDetails}))},t}(c.a.PureComponent),P=function(e){function t(){return e.apply(this,arguments)||this}return i()(t,e),t.prototype.render=function(){var e=this.props,t=e.handleSubmit,a=e.isLoading;return c.a.createElement("div",{className:"cp-spoilers-form"},c.a.createElement(N.ModalHeader,{title:c.a.createElement(d.FormattedMessage,{id:"flag_spoilers"})}),c.a.createElement(N.ModalContent,null,c.a.createElement(d.FormattedMessage,{id:"spoilers_note"})),c.a.createElement(N.ModalFooter,{primaryActionButtonText:c.a.createElement(d.FormattedMessage,{id:"button_submit"}),primaryActionButtonTag:m.TransactionalSolidButton,handlePrimaryAction:t,isLoading:a}))},t}(c.a.PureComponent),x=function(e){function t(){for(var t,a=arguments.length,n=new Array(a),r=0;r<a;r++)n[r]=arguments[r];return(t=e.call.apply(e,[this].concat(n))||this).state={flagTypeIsSet:!1,selectedFlagType:null},t.flagUgc=function(e){var a=e.violationType,n=e.offensiveDetails,r=t.props,i=r.id,o=r.flagsActions,c=r.user,l=r.handleClose,s=t.state.selectedFlagType;o.addFlag({contentId:i,userId:c.get("id"),flagType:s,reason:n,violationType:a,postSuccess:l})},t.handleFlagTypeChange=function(e){return t.setState({selectedFlagType:e})},t.handleFlagTypeSubmit=function(){t.setState({flagTypeIsSet:!0})},t.renderSelectOptionForm=function(){var e=t.props,a=e.flags,n=e.id;return c.a.createElement("div",{className:"select-option-form"},c.a.createElement(N.ModalHeader,{title:c.a.createElement(d.FormattedMessage,{id:"flag_content"})}),c.a.createElement(N.ModalContent,null,c.a.createElement("span",{className:"select-option"},c.a.createElement(d.FormattedMessage,{id:"select_option"})),c.a.createElement("ul",{className:"flag-types-list"},Object.values(_.a).map((function(e){var r=!a.getIn([n.toString(),"flaggableTypes"]).includes(e),i=r&&c.a.createElement("span",{className:"already-flagged"},c.a.createElement(d.FormattedMessage,{id:"already_flagged"}));return c.a.createElement("li",{key:e},c.a.createElement(M.a,{checked:t.state.selectedFlagType===e,disabled:r,handleChange:t.handleFlagTypeChange,id:"select-"+e,label:c.a.createElement(d.FormattedMessage,{id:"contains_"+e.toLowerCase()}),name:"select-flag-type",value:e,dataKey:"select-"+e}),i)}))),c.a.createElement(j.ChevronLink,{href:"https://help.bibliocommons.com/025ug/060reporting-inappropriate-content/",dataKey:"find-out-more-link"},c.a.createElement(d.FormattedMessage,{id:"find_out_more_link"}))),c.a.createElement(N.ModalFooter,{primaryActionButtonText:c.a.createElement(d.FormattedMessage,{id:"next"}),primaryActionButtonTag:m.TransactionalSolidButton,handlePrimaryAction:t.handleFlagTypeSubmit,disabled:!t.state.selectedFlagType}))},t.renderDetailsForm=function(){var e=t.props,a=e.id,n=e.flagsTransactions.getIn([a,"isAdding"]);switch(t.state.selectedFlagType){case _.a.STANDARDS_VIOLATION:return c.a.createElement(w,{handleSubmit:t.flagUgc,isLoading:n});case _.a.OFFENSIVE:return c.a.createElement(D,{handleSubmit:t.flagUgc,isLoading:n});case _.a.SPOILER:return c.a.createElement(P,{handleSubmit:t.flagUgc,isLoading:n});default:return null}},t}return i()(t,e),t.prototype.render=function(){return c.a.createElement("div",{className:"cp-flag-ugc-form"},this.state.flagTypeIsSet?this.renderDetailsForm():this.renderSelectOptionForm())},t}(c.a.PureComponent),U=function(e){function t(){return e.apply(this,arguments)||this}return i()(t,e),t.prototype.render=function(){return c.a.createElement(x,this.props)},t}(c.a.PureComponent),K=Object(l.connect)((function(e){return{flagsTransactions:y(e),user:Object(k.c)(e),flags:Object(A.r)(e)}}),(function(e){return{flagsActions:Object(s.bindActionCreators)(C,e)}}))(U),H=function(e){function t(){for(var t,a=arguments.length,n=new Array(a),r=0;r<a;r++)n[r]=arguments[r];return(t=e.call.apply(e,[this].concat(n))||this).modalKey="flag-ugc-"+t.props.id,t.openModal=function(){return t.props.modalActions.openModal(t.modalKey)},t.closeModal=function(){return t.props.modalActions.closeModal(t.modalKey)},t}return i()(t,e),t.prototype.render=function(){var e=this.props.id;return c.a.createElement("div",{className:"cp-flag-ugc-button"},c.a.createElement(m.TextButton,{handleClick:this.openModal,className:"ugc-display__flag-button",dataKey:"flag-ugc-button",size:"small",renderLeadingIcon:function(){return c.a.createElement(p.FlagOutline,null)}},c.a.createElement("span",{"aria-hidden":!0},c.a.createElement(d.FormattedMessage,{id:"flag"})),c.a.createElement(h.a,null,c.a.createElement(d.FormattedMessage,{id:"sr_flag",values:{ugcType:this.props.ugcType}}))),c.a.createElement(f.a,{modalKey:this.modalKey,handleClose:this.closeModal},c.a.createElement(K,{id:e,handleClose:this.closeModal})))},t}(c.a.PureComponent),z=function(e){function t(){return e.apply(this,arguments)||this}return i()(t,e),t.prototype.render=function(){return c.a.createElement(H,this.props)},t}(c.a.PureComponent),q=Object(l.connect)(null,(function(e){return{modalActions:Object(s.bindActionCreators)(u.a,e)}}))(z)},2523:function(e,t,a){"use strict";a.d(t,"a",(function(){return s}));var n=a(0),r=a.n(n),i=a(5),o=a(82),c=a(38),l=a.n(c);function s(e){var t=e.author,a=e.shelfItem;return t.get("loggedIn")&&null!=a&&a.get("privateItem")?r.a.createElement("span",{className:"cp-privacy-indicator"},r.a.createElement(o.Lock,null),r.a.createElement("span",{className:"private-label","aria-hidden":!0},r.a.createElement(i.FormattedMessage,{id:"private"})),r.a.createElement(l.a,null,r.a.createElement(i.FormattedMessage,{id:"private_ugc_sr_message"}))):null}},2524:function(e,t,a){"use strict";a.d(t,"a",(function(){return p}));var n=a(0),r=a.n(n),i=a(2),o=a.n(i),c=a(5),l=a(82),s=a(38),u=a.n(s),d=a(88),m=a(300);function p(e){var t,a,n=e.author,i=e.flags,s=e.contentIsHidden,p=e.toggleContent,f=e.ugcType,g=(null==i?void 0:i.get("flaggedTypes",o.a.List()))||o.a.List();return g.includes(m.a.SPOILER)&&(a="spoiler_content_by_user"),g.includes(m.a.OFFENSIVE)&&(a="offensive_content_by_user"),g.includes(m.a.SPOILER)&&g.includes(m.a.OFFENSIVE)&&(a="offensive_spoiler_content_by_user"),r.a.createElement("div",{className:"cp-content-warnings"},g.includes(m.a.SPOILER)&&r.a.createElement("span",{className:"content-warning"},r.a.createElement(l.Flag,null),r.a.createElement("span",{className:"warning-label","aria-hidden":!0},r.a.createElement(c.FormattedMessage,{id:"spoiler"})),r.a.createElement(u.a,null,r.a.createElement(c.FormattedMessage,{id:"sr_spoiler",values:{ugcType:f}}))),g.includes(m.a.OFFENSIVE)&&r.a.createElement("span",{className:"content-warning"},r.a.createElement(l.Flag,null),r.a.createElement("span",{className:"warning-label","aria-hidden":!0},r.a.createElement(c.FormattedMessage,{id:"offensive"})),r.a.createElement(u.a,null,r.a.createElement(c.FormattedMessage,{id:"sr_offensive",values:{ugcType:f}}))),(g.includes(m.a.STANDARDS_VIOLATION)||0===(null===(t=i.get("flaggableTypes"))||void 0===t?void 0:t.size))&&r.a.createElement("span",{className:"content-warning"},r.a.createElement("span",{className:"reported-label"},r.a.createElement(c.FormattedMessage,{id:"reported"}))),g.size>0&&(s?r.a.createElement(d.SecondaryTextButton,{handleClick:function(){return p(!0)},dataKey:"show-content"},r.a.createElement("span",{"aria-hidden":!0},r.a.createElement(c.FormattedMessage,{id:"show"})),r.a.createElement(u.a,null,r.a.createElement(c.FormattedMessage,{id:"show_"+a,values:{username:n.get("name")}}))):r.a.createElement(d.SecondaryTextButton,{handleClick:function(){return p(!1)},dataKey:"hide-content"},r.a.createElement("span",{"aria-hidden":!0},r.a.createElement(c.FormattedMessage,{id:"hide"})),r.a.createElement(u.a,null,r.a.createElement(c.FormattedMessage,{id:"hide_"+a,values:{username:n.get("name")}})))))}},2525:function(e,t,a){"use strict";a.d(t,"a",(function(){return d}));var n=a(0),r=a.n(n),i=a(5),o=a(517),c=a.n(o),l=a(88),s=a(302),u=Object(n.forwardRef)((function(e,t){var a=e.children,o=e.label,u=e.isLoading,d=e.initialContent,m=e.metadataId,p=e.ugcType,f=e.maxLength,g=e.handleConfirm,h=e.handleCancel,b=Object(n.useState)(d||""),v=b[0],E=b[1];return r.a.createElement("div",{className:"cp-ugc-editor",ref:t},r.a.createElement(s.a,null,r.a.createElement(c.a,{value:v,handleChange:E,id:m+"-ugc-editor-text-area",maxLength:f,label:o,fitToText:!0,minHeight:"9rem"}),a,r.a.createElement("div",{className:"ugc-editor__buttons"},r.a.createElement(l.SecondaryTextButton,{dataKey:"cancel-button",handleClick:h},r.a.createElement(i.FormattedMessage,{id:"button_cancel"})),r.a.createElement(l.TransactionalSolidButton,{handleClick:function(){return g(v)},disabled:!v,"aria-disabled":!v,isLoading:u,dataKey:"post-ugc"},r.a.createElement(i.FormattedMessage,{id:"post_"+p})))))}));u.defaultProps={initialContent:"",maxLength:4e3};var d=u},2528:function(e,t,a){"use strict";var n,r=a(8),i=a.n(r),o=a(55),c=a.n(o),l=a(84),s=a(80),u=a(161),d=a(12),m=a.n(d);function p(e,t,a){var r=a.route(n||(n=m()(["/libraries/","/users/","/settings"])),":librarySubdomain",e);return a.patch(r,t)}var f=a(33);function g(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function h(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?g(Object(a),!0).forEach((function(t){i()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):g(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var b=u.c.SHOW_CONTENT,v=u.c.HIDE_CONTENT,E=u.c.SHOW_OFFENSIVE_CONTENT_REQUEST,y=u.c.SHOW_OFFENSIVE_CONTENT_SUCCESS,I=u.c.SHOW_OFFENSIVE_CONTENT_FAILURE,S=u.c.HIDE_OFFENSIVE_CONTENT_REQUEST,O=u.c.HIDE_OFFENSIVE_CONTENT_SUCCESS,_=u.c.HIDE_OFFENSIVE_CONTENT_FAILURE,C=u.c.SHOW_SPOILERS_REQUEST,k=u.c.SHOW_SPOILERS_SUCCESS,A=u.c.SHOW_SPOILERS_FAILURE,N=u.c.HIDE_SPOILERS_REQUEST,T=u.c.HIDE_SPOILERS_SUCCESS,M=u.c.HIDE_SPOILERS_FAILURE;function j(e,t,a){var n=t.getIn(["auth","currentUserId"]);return n?p(n,{flags:h(h({},Object(f.c)(t).getIn(["preferences","flags"]).toObject()),e)},a):Object(l.of)({})}t.a={toggleContent:function(e){return{contentId:e.contentId,type:e.value?b:v}},toggleOffensiveContent:function(e){var t=c()().add(10,"years").toDate();return Object(s.setCookie)(u.a,e,{path:"/",expires:t}),{types:e?[E,y,I]:[S,O,_],apiRequest:function(t,a){return j({filterOffensive:!e},t,a)}}},toggleSpoilers:function(e){var t=c()().add(10,"years").toDate();return Object(s.setCookie)(u.b,e,{path:"/",expires:t}),{types:e?[C,k,A]:[N,T,M],apiRequest:function(t,a){return j({filterSpoiler:!e},t,a)}}}}},2529:function(e,t,a){"use strict";a.d(t,"a",(function(){return g}));var n=a(0),r=a.n(n),i=a(2),o=a.n(i),c=a(5),l=a(2359),s=a(393),u=a(88),d=a(82),m=a(118),p=a(38),f=a.n(p),g=Object(n.forwardRef)((function(e,t){var a=e.id,n=e.ugcType,i=e.author,p=e.handleDelete,g=e.handleEdit,h=e.hidePermalink,b=[];return i.get("loggedIn")&&Object(l.allowFreeText)(i)&&g&&b.push(r.a.createElement(s.DropdownMenuItem,{key:"edit-"+n,handleClick:g,item:o.a.Map({label:r.a.createElement(c.FormattedMessage,{id:"edit_"+n}),value:"edit-"+n})})),i.get("loggedIn")&&p&&b.push(r.a.createElement(s.DropdownMenuItem,{key:"delete-"+n,handleClick:p,item:o.a.Map({label:r.a.createElement(c.FormattedMessage,{id:"delete_"+n}),value:"delete-"+n})})),h||b.push(r.a.createElement(s.DropdownMenuItem,{key:"permalink"},r.a.createElement(m.Link,{href:"/v2/"+n+"/"+a,dataKey:"ugc-permalink"},r.a.createElement(c.FormattedMessage,{id:"permalink"})))),b.length?r.a.createElement(s.Dropdown,{right:!0,ref:t,className:"cp-ugc-options-dropdown",dataKey:"ugc-options-dropdown",renderTrigger:function(e,t){return r.a.createElement(u.IconButton,{handleClick:e,dataKey:"ugc-display-ellipsis",className:"ugc-display-options","aria-expanded":t},r.a.createElement(f.a,null,r.a.createElement(c.FormattedMessage,{id:"ugc_action_menu_sr_label",values:{username:i.get("name"),ugcType:n}})),r.a.createElement(d.Ellipsis,null))}},b):null}))},2532:function(e,t,a){"use strict";var n=a(1);Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return r.default}});var r=n(a(2570))},2551:function(e,t,a){"use strict";var n=a(0),r=a.n(n),i=a(5);t.a=function(e){var t=e.src,a=e.title;return r.a.createElement(i.FormattedMessage,{id:"sr_video_title",values:{title:a}},(function(e){return r.a.createElement("iframe",{className:"cp-ugc-video-playback","data-key":"ugc-video-playback",src:t,frameBorder:"0",allowFullScreen:!0,title:e})}))}},2562:function(e,t,a){"use strict";var n=a(1);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(a(24)),i=n(a(25)),o=n(a(27)),c=n(a(28)),l=n(a(29)),s=n(a(0)),u=n(a(4)),d=n(a(2)),m=n(a(67));function p(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=(0,l.default)(e);if(t){var r=(0,l.default)(this).constructor;a=Reflect.construct(n,arguments,r)}else a=n.apply(this,arguments);return(0,c.default)(this,a)}}var f=function(e){(0,o.default)(a,e);var t=p(a);function a(){return(0,r.default)(this,a),t.apply(this,arguments)}return(0,i.default)(a,[{key:"render",value:function(){return this.props.children(this.context.features||d.default.Map())}}]),a}(s.default.Component);t.default=f,f.contextType=m.default,f.propTypes={children:u.default.func.isRequired}},2567:function(e,t,a){"use strict";var n=a(1);Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"videoUtils",{enumerable:!0,get:function(){return r.default}});var r=n(a(2568))},2568:function(e,t,a){"use strict";var n=a(1);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r={urlToIFrameSrc:n(a(2569)).default};t.default=r},2569:function(e,t,a){"use strict";var n=a(1);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(a(395)),i=n(a(530)),o={SCHOOLTUBE:"www.schooltube.com",TEACHERTUBE:"www.teachertube.com",VIMEO:"player.vimeo.com",YOUTUBE:"www.youtube.com"};function c(e){if(!e)return"";var t;if(!function(e){return/^(https?|ftp):\/\/[^\s/$.?:#]+\.[^\s]*$/i.test(e)}(t=function(e){return e.replace(/.*\/\//,"https://")}(t=(e.match(/src=["']([^"']*)["']/)||[])[1]||e)))return"";if(t.match(/vimeo/))return"https://"+o.VIMEO+"/video/"+t.match(/[0-9]+/);if(t.match(/youtu(\.?)be/)){var a="";return a=/\?v=|\/v\//.test(t)?t.split(/\?v=|\/v\//)[1]:function(e){return e.split("?")[0]}(function(e){return(0,r.default)(e.split("/"))}(t)),"https://"+o.YOUTUBE+"/embed/"+a}if(t.match(/teachertube/))return"https://"+o.TEACHERTUBE+"/embed/videos/"+t.match(/[0-9]+$/)[0];if(t.match(/schooltube/)){var n=t.match(/www\.schooltube\.com\/(video|embed_force)\/([^/]*)/i);return n?"https://"+o.SCHOOLTUBE+"/embed_force/"+n[2]:""}return""}t.default=function(e){var t=c(e);return t&&(0,i.default)(o,function(e){return(e.match(/:\/\/([^/]*)/)||[])[1]}(t))?t:""}},2570:function(e,t,a){"use strict";var n=a(1);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(a(4)),i=n(a(0)),o=n(a(22)),c=a(5),l=n(a(245)),s=n(a(38)),u=function(e){var t,a=e.format,n=e.title,r=e.authors,o=e.username,u=e.rating,d=(0,c.useIntl)(),m=r&&(r.size||r.length);m&&(t=Array.isArray(r)?r[0]:r.first());var p=a?d.formatMessage({id:"FORMAT."+a.toLowerCase()}):"",f=m?d.formatMessage({id:"by_authors"},{authorLinks:t}):"",g=u&&o?d.formatMessage({id:"ugc_display_rating_sr_label"},{username:o,rating:u/20}):"";return i.default.createElement(s.default,{className:"cp-screen-reader-item-info"},(0,l.default)([n,p,f,g]).join(", "))};u.propTypes={format:r.default.string,title:r.default.string.isRequired,authors:r.default.oneOfType([o.default.listOf(r.default.string),r.default.arrayOf(r.default.string)]),rating:r.default.number,username:r.default.string};var d=u;t.default=d},2585:function(e,t,a){"use strict";a.d(t,"a",(function(){return k}));var n=a(0),r=a.n(n),i=a(5),o=a(2358),c=a.n(o),l=a(88),s=a(2359),u=a(2567),d=a(397),m=a.n(d),p=a(517),f=a.n(p),g=a(164),h=a(298),b=a(302),v=Object(n.forwardRef)((function(e,t){var a,o=e.open,d=e.metadataId,p=e.currentUser,v=e.existingVideo,E=e.ugcEditorActions,y=e.videosTransactions,I=e.videosActions,S=e.handleCancel,O=e.handleSuccess,_=Object(n.useState)((null==v?void 0:v.get("title"))||""),C=_[0],k=_[1],A=Object(n.useState)((null==v?void 0:v.get("description"))||""),N=A[0],T=A[1],M=Object(n.useState)((null==v?void 0:v.get("url"))||""),j=M[0],F=M[1],L=Object(n.useState)(null),w=L[0],B=L[1],R=c()(o),D=Object(n.useRef)(),P=Object(n.useRef)();function x(){E.openEditor("video")}function U(){v||E.closeEditor("video"),S&&S()}function K(e){F(e),B(e&&!u.videoUtils.urlToIFrameSrc(e)?r.a.createElement(i.FormattedMessage,{id:"invalid_video_url",values:{link:function(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];return r.a.createElement(h.a,{showIcon:!1,page:"025ug/020video/"},t)}}}):null)}function H(){return j&&!w&&C}function z(e){if(e&&e.preventDefault(),H()){var t={metadataId:d,videoId:null==v?void 0:v.get("id"),url:j,title:C,description:N,postSuccess:function(){v||E.closeEditor("video"),O&&O()}};t.videoId?I.updateVideo(t):I.addVideo(t)}}return Object(n.useEffect)((function(){o&&!R&&P.current&&Object(g.setFocusWithinElement)(P.current),!o&&R&&D.current&&Object(g.setFocusWithinElement)(D.current)}),[o,R,P,D]),!p||Object(s.allowFreeText)(p)?r.a.createElement("div",{className:"cp-video-editor",ref:t},o?(a=v?y.getIn([d,v.get("id"),"isUpdating"]):y.getIn([d,"isAdding"]),r.a.createElement(b.a,null,r.a.createElement("form",{ref:P,onSubmit:z,autoComplete:"off",autoCorrect:"off"},r.a.createElement(m.a,{value:j,onChange:K,errorMessage:w,className:"video-field",id:d+"-video-url-field",info:r.a.createElement(i.FormattedMessage,{id:"video_url_info"}),label:r.a.createElement(i.FormattedMessage,{id:"video_url_label"}),maxLength:1e3,characterCountSrOnly:!0}),r.a.createElement(m.a,{value:C,onChange:k,className:"video-field",id:d+"-video-title-field",label:r.a.createElement(i.FormattedMessage,{id:"title"}),maxLength:50}),r.a.createElement(f.a,{value:N,handleChange:T,className:"video-field",id:d+"-video-description-field",label:r.a.createElement(i.FormattedMessage,{id:"description"}),maxLength:500,minHeight:"6rem",fitToText:!0,optional:!0}),r.a.createElement("div",{className:"action-buttons"},r.a.createElement(l.SecondaryTextButton,{dataKey:"cancel-button",type:"button",handleClick:U},r.a.createElement(i.FormattedMessage,{id:"button_cancel"})),r.a.createElement(l.TransactionalSolidButton,{handleClick:z,disabled:!H(),isLoading:a,dataKey:"post-ugc",type:"submit"},r.a.createElement(i.FormattedMessage,{id:"post_video"})))))):r.a.createElement(l.SecondaryGhostButton,{ref:D,dataKey:"add-ugc",handleClick:x},r.a.createElement(i.FormattedMessage,{id:"add_video"}))):null})),E=a(20),y=a(45),I=a(304),S=a(2368),O=a(33),_=a(2416),C=a(2382);var k=Object(E.connect)((function(e,t){return{currentUser:Object(O.c)(e),videosTransactions:Object(_.e)(e),open:!!t.existingVideo||Object(C.a)(e).has("video")}}),(function(e){return{videosActions:Object(y.bindActionCreators)(I.a,e),ugcEditorActions:Object(y.bindActionCreators)(S.a,e)}}))((function(e){return r.a.createElement(v,e)}))},2600:function(e,t,a){"use strict";var n=a(1);Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return r.default}});var r=n(a(2761))},2602:function(e,t,a){"use strict";a.d(t,"a",(function(){return c})),a.d(t,"b",(function(){return l})),a.d(t,"c",(function(){return s}));var n=a(9),r=a(2),i=a.n(r),o=a(506),c=Object(o.a)("ageSuitabilities"),l=Object(n.createSelector)([function(e){return e.getIn(["ugc","ageSuitabilitiesTransactions"],i.a.Map())}],(function(e){return e})),s=Object(o.b)("ageSuitabilities")},2732:function(e,t,a){"use strict";a.d(t,"a",(function(){return P}));var n=a(0),r=a.n(n),i=a(2358),o=a.n(i),c=a(118),l=a(297),s=a(82),u=a(2406),d=a.n(u),m=a(163),p=a.n(m),f=a(164),g=a(2523),h=a(2390),b=a(295);function v(e){var t=e.videoId,a=e.catalogBib,n=e.videosActions,i=e.handleSuccess,o=e.modalActions,c=e.videosTransactions,l="delete-video-"+t;function s(){o.closeModal(l)}return r.a.createElement(b.a,{className:"cp-delete-video-modal",modalKey:l,handleClose:s,size:"small"},r.a.createElement(h.a,{ugcType:"video",id:t,catalogBib:a,removeUgcAction:n.removeVideo,transactions:c,handleClose:s,handleSuccess:i}))}var E=a(13),y=a.n(E),I=a(20),S=a(45),O=a(2416),_=a(304),C=a(213),k=function(e){function t(){return e.apply(this,arguments)||this}return y()(t,e),t.prototype.render=function(){return r.a.createElement(v,this.props)},t}(r.a.PureComponent),A=Object(I.connect)((function(e){return{videosTransactions:Object(O.e)(e)}}),(function(e){return{videosActions:Object(S.bindActionCreators)(_.a,e),modalActions:Object(S.bindActionCreators)(C.a,e)}}))(k),N=a(2551),T=a(2524),M=a(2519),j=a(2529),F=a(2585),L=a(2501);function w(e){var t,a=e.video,i=e.users,u=e.catalogBib,m=e.modalActions,h=e.handleDeleteSuccess,b=e.shelfItem,v=e.displayStaffBadge,E=a.get("id"),y=i.get(a.get("userId").toString()),I=Object(L.a)(E),S=I.flags,O=I.contentIsHidden,_=I.placeholder,C=I.toggleContent,k=Object(n.useState)(!1),w=k[0],B=k[1],R=o()(w),D=Object(n.useRef)();function P(){m.openModal("delete-video-"+E)}function x(){B(!0)}function U(){B(!1)}return Object(n.useEffect)((function(){!w&&R&&D.current&&Object(f.setFocusWithinElement)(D.current)}),[w,R,D]),r.a.createElement("div",{className:"cp-video-display"},w?r.a.createElement(F.a,{existingVideo:a,metadataId:a.get("metadataId"),handleCancel:U,handleSuccess:U}):r.a.createElement("div",{className:"video-display"},r.a.createElement("div",{className:"video-wrapper"},O?r.a.createElement("div",{className:"placeholder-icon-wrapper"},r.a.createElement(s.Movies,null)):r.a.createElement(N.a,{key:E,src:a.get("url"),title:a.get("title")})),r.a.createElement("div",{className:"video-details"},r.a.createElement("div",{className:"user-area"},r.a.createElement(c.Link,{href:y.get("webUrl"),className:"author",dataKey:"bib-ugc-display-author"},y.get("name")),r.a.createElement(d.a,{userIdentity:y,displayStaffBadge:v,ugcType:"video"})),r.a.createElement("div",{className:"right-side"},r.a.createElement(g.a,{author:y,shelfItem:b}),r.a.createElement(j.a,{id:E,ugcType:"video",author:y,handleDelete:P,handleEdit:x,ref:D})),O?_:r.a.createElement("div",{className:"video-info"},r.a.createElement(p.a,{size:"modest",tagName:"div",className:"video-title"},a.get("title")),a.get("description")&&r.a.createElement(l.ExpandableText,{className:"video-description",text:a.get("description"),truncateCount:240,expandLinkHref:"#read-more-video-desc-"+E,textKey:"video"})),(null===(t=S.get("flaggableTypes"))||void 0===t?void 0:t.size)>0&&r.a.createElement(M.a,{id:E,ugcType:"video"}),r.a.createElement(T.a,{author:y,flags:S,contentIsHidden:O,toggleContent:C,ugcType:"video"})),r.a.createElement(A,{videoId:E,catalogBib:u,handleSuccess:h})))}w.defaultProps={displayStaffBadge:!0};var B=a(70),R=a(189),D=function(e){function t(){return e.apply(this,arguments)||this}return y()(t,e),t.prototype.render=function(){return r.a.createElement(w,this.props)},t}(r.a.PureComponent),P=Object(I.connect)((function(e,t){return{users:Object(B.O)(e),shelfItem:Object(R.f)(e).get(t.catalogBib.get("metadataId"))}}),(function(e){return{modalActions:Object(S.bindActionCreators)(C.a,e)}}))(D)},2734:function(e,t,a){"use strict";a.d(t,"a",(function(){return T}));var n=a(13),r=a.n(n),i=a(0),o=a.n(i),c=a(20),l=a(45),s=a(2376),u=a(70),d=a(2422),m=a(213),p=a(2450),f=a(26),g=a.n(f),h=a(32),b=a(164),v=a(2444),E=a(2738),y=a(2456),I=a(303),S=a(2390),O=a(295);function _(e){var t=e.commentId,a=e.catalogBib,n=e.commentsActions,r=e.handleSuccess,i=e.modalActions,c=e.commentsTransactions;function l(){i.closeModal("delete-comment-"+t)}return o.a.createElement(O.a,{className:"cp-delete-comment-modal",modalKey:"delete-comment-"+t,size:"small",handleClose:l},o.a.createElement(S.a,{ugcType:"comment",id:t,catalogBib:a,removeUgcAction:n.removeComment,transactions:c,handleClose:l,handleSuccess:r}))}var C=function(e){function t(){return e.apply(this,arguments)||this}return r()(t,e),t.prototype.render=function(){return o.a.createElement(_,this.props)},t}(o.a.PureComponent),k=Object(c.connect)((function(e){return{commentsTransactions:Object(y.d)(e)}}),(function(e){return{commentsActions:Object(l.bindActionCreators)(I.a,e),modalActions:Object(l.bindActionCreators)(m.a,e)}}))(C),A=function(e){function t(t){var a;return(a=e.call(this,t)||this).optionsDropdownRef=o.a.createRef(),a.likeComment=function(){var e=a.props,t=e.comment,n=e.likesActions,r=t.get("id");n.addLike({contentId:r,postSuccess:function(){return I.a.getComment(r)}})},a.unlikeComment=function(){var e=a.props,t=e.comment,n=e.currentUserLikes,r=e.likesActions,i=t.get("id");r.removeLike({id:n.getIn([i,"id"]),contentId:i,postSuccess:function(){return I.a.getComment(i)}})},a.state={editorIsOpen:!1},Object(h.bindAll)(g()(a)),a}r()(t,e);var a=t.prototype;return a.componentDidUpdate=function(e,t){!this.state.editorIsOpen&&t.editorIsOpen&&this.optionsDropdownRef.current&&Object(b.setFocusWithinElement)(this.optionsDropdownRef.current)},a.toggleEditor=function(e){this.setState({editorIsOpen:e})},a.openDeletionModal=function(){var e=this.props.comment.get("id");this.props.modalActions.openModal("delete-comment-"+e)},a.renderEditor=function(){var e=this,t=this.props,a=t.catalogBib,n=t.comment;return o.a.createElement(E.a,{catalogBib:a,commentId:n.get("id"),handleCancel:function(){return e.toggleEditor(!1)},handleSuccess:function(){return e.toggleEditor(!1)}})},a.render=function(){var e=this;if(this.state.editorIsOpen)return o.a.createElement("div",{className:"cp-comment-display"},this.renderEditor());var t=this.props,a=t.comment,n=t.displayStaffBadge,r=t.users,i=t.currentUserRating,c=t.catalogBib,l=t.currentUserLikes,s=t.children,u=t.handleDeleteSuccess,d=r.get(a.get("userId").toString()),m=a.get("id"),p=d&&d.get("loggedIn")&&i?i.get("rating"):a.get("rating"),f=a.get("likesCount");return o.a.createElement("div",{className:"cp-comment-display"},o.a.createElement(v.a,{ugcType:"comment",catalogBib:c,author:d,id:m,key:m,createdDate:a.get("createdDate"),rating:p,likesCount:f,isLikedByCurrentUser:!!l.get(m),displayStaffBadge:n,optionsDropdownRef:this.optionsDropdownRef,handleDelete:this.openDeletionModal,handleEdit:function(){return e.toggleEditor(!0)},handleLike:this.likeComment,handleUnlike:this.unlikeComment},s),o.a.createElement(k,{commentId:m,catalogBib:c,handleSuccess:u}))},t}(o.a.PureComponent);A.defaultProps={displayStaffBadge:!0};var N=function(e){function t(){return e.apply(this,arguments)||this}return r()(t,e),t.prototype.render=function(){return o.a.createElement(A,this.props)},t}(o.a.PureComponent),T=Object(c.connect)((function(e,t){return{users:Object(u.O)(e),currentUserRating:Object(s.a)(e).get(t.catalogBib.get("metadataId")),currentUserLikes:Object(d.b)(e)}}),(function(e){return{modalActions:Object(l.bindActionCreators)(m.a,e),likesActions:Object(l.bindActionCreators)(p.a,e)}}))(N)},2736:function(e,t,a){"use strict";a.d(t,"a",(function(){return _}));var n=a(0),r=a.n(n),i=a(5),o=a(2358),c=a.n(o),l=a(2359),s=a(88),u=a(164),d=a(2525);function m(e){var t=e.open,a=e.currentUser,o=e.initialContent,m=e.catalogBib,p=e.quotationsTransactions,f=e.quotationId,g=Object(i.useIntl)(),h=c()(t),b=Object(n.useRef)(),v=Object(n.useRef)();Object(n.useEffect)((function(){t&&!h&&v.current&&Object(u.setFocusWithinElement)(v.current),!t&&h&&b.current&&Object(u.setFocusWithinElement)(b.current)}),[t,h,v,b]);var E,y,I,S=function(){e.quotationId||e.ugcEditorActions.closeEditor("quotation"),e.handleSuccess&&e.handleSuccess()},O=function(){e.quotationId||e.ugcEditorActions.closeEditor("quotation"),e.handleCancel&&e.handleCancel()},_=function(t){e.quotationsActions.addQuotation({metadataId:e.catalogBib.get("metadataId"),quotation:t,postSuccess:S})},C=function(t){e.quotationsActions.updateQuotation({metadataId:e.catalogBib.get("metadataId"),quotationId:e.quotationId,quotation:t,postSuccess:S})};return!a||Object(l.allowFreeText)(a)?r.a.createElement("div",{className:"cp-quotation-editor"},t?(E=m.get("metadataId"),y=p.getIn([E,"isAdding"])||p.getIn([E,f,"isUpdating"]),I=f?g.formatMessage({id:"edit_quotation_prompt"}):g.formatMessage({id:"add_quotation_prompt"}),r.a.createElement(d.a,{ref:v,ugcType:"quotation",metadataId:E,handleConfirm:f?C:_,handleCancel:O,label:I,maxLength:1e3,isLoading:y,initialContent:o})):r.a.createElement(s.SecondaryGhostButton,{ref:b,dataKey:"add-ugc",handleClick:function(){return e.ugcEditorActions.openEditor("quotation")}},r.a.createElement(i.FormattedMessage,{id:"add_quotation"}))):null}m.defaultProps={initialContent:""};var p=a(13),f=a.n(p),g=a(20),h=a(45),b=a(306),v=a(2368),E=a(33),y=a(2500),I=a(70),S=a(2382),O=function(e){function t(){return e.apply(this,arguments)||this}return f()(t,e),t.prototype.render=function(){return r.a.createElement(m,this.props)},t}(r.a.PureComponent),_=Object(g.connect)((function(e,t){var a=t.quotationId;return{currentUser:Object(E.c)(e),quotationsTransactions:Object(y.d)(e),initialContent:a?Object(I.H)(e).getIn([a.toString(),"quotation"]):"",open:!!a||Object(S.a)(e).has("quotation")}}),(function(e){return{quotationsActions:Object(h.bindActionCreators)(b.a,e),ugcEditorActions:Object(h.bindActionCreators)(v.a,e)}}))(O)},2737:function(e,t,a){"use strict";a.d(t,"a",(function(){return _}));var n=a(0),r=a.n(n),i=a(5),o=a(2358),c=a.n(o),l=a(2359),s=a(88),u=a(164),d=a(2525);function m(e){var t=e.open,a=e.currentUser,o=e.initialContent,m=e.summariesTransactions,p=e.catalogBib,f=e.summaryId,g=Object(i.useIntl)(),h=c()(e),b=Object(n.useRef)(),v=Object(n.useRef)();Object(n.useEffect)((function(){!t||null!=h&&h.open||!v.current||Object(u.setFocusWithinElement)(v.current),!t&&null!=h&&h.open&&b.current&&Object(u.setFocusWithinElement)(b.current)}),[t,h,v,b]);var E,y,I,S=function(){e.summaryId||e.ugcEditorActions.closeEditor("summary"),e.handleSuccess&&e.handleSuccess()},O=function(){e.summaryId||e.ugcEditorActions.closeEditor("summary"),e.handleCancel&&e.handleCancel()},_=function(t){e.summariesActions.addSummary({metadataId:e.catalogBib.get("metadataId"),summary:t,postSuccess:S})},C=function(t){e.summariesActions.updateSummary({metadataId:e.catalogBib.get("metadataId"),summaryId:e.summaryId,summary:t,postSuccess:S})};return!a||Object(l.allowFreeText)(a)?r.a.createElement("div",{className:"cp-summary-editor"},t?(E=p.get("metadataId"),y=m.getIn([E,"isAdding"])||m.getIn([E,f,"isUpdating"]),I=f?g.formatMessage({id:"edit_summary_prompt"}):g.formatMessage({id:"add_summary_prompt"}),r.a.createElement(d.a,{ugcType:"summary",ref:v,metadataId:E,handleConfirm:f?C:_,handleCancel:O,label:I,isLoading:y,initialContent:o})):r.a.createElement(s.SecondaryGhostButton,{ref:b,dataKey:"add-ugc",handleClick:function(){return e.ugcEditorActions.openEditor("summary")}},r.a.createElement(i.FormattedMessage,{id:"add_summary"}))):null}m.defaultProps={initialContent:""};var p=a(13),f=a.n(p),g=a(20),h=a(45),b=a(307),v=a(2368),E=a(33),y=a(2503),I=a(70),S=a(2382),O=function(e){function t(){return e.apply(this,arguments)||this}return f()(t,e),t.prototype.render=function(){return r.a.createElement(m,this.props)},t}(r.a.PureComponent),_=Object(g.connect)((function(e,t){var a=t.summaryId;return{currentUser:Object(E.c)(e),summariesTransactions:Object(y.e)(e),initialContent:a?Object(I.N)(e).getIn([a.toString(),"summary"]):"",open:!!a||Object(S.a)(e).has("summary")}}),(function(e){return{summariesActions:Object(h.bindActionCreators)(b.a,e),ugcEditorActions:Object(h.bindActionCreators)(v.a,e)}}))(O)},2738:function(e,t,a){"use strict";a.d(t,"a",(function(){return N}));var n=a(0),r=a.n(n),i=a(2358),o=a.n(i),c=a(5),l=a(2359),s=a(38),u=a.n(s),d=a(164),m=a(2398),p=a(302),f=a(2525);function g(e){var t,a,i,s=e.catalogBib,g=e.commentId,h=e.handleSuccess,b=e.handleCancel,v=e.open,E=e.initialContent,y=e.currentUser,I=e.commentsTransactions,S=e.commentsActions,O=e.ugcEditorActions,_=e.intl,C=o()(v),k=Object(n.useRef)(),A=Object(n.useRef)();function N(){g||O.closeEditor("comment"),h&&h()}function T(){g||O.closeEditor("comment"),b&&b()}function M(e){S.addComment({metadataId:s.get("metadataId"),comment:e,postSuccess:N})}function j(e){S.updateComment({metadataId:s.get("metadataId"),commentId:g,comment:e,postSuccess:N})}return Object(n.useEffect)((function(){v&&!C&&A.current&&Object(d.setFocusWithinElement)(A.current),!v&&C&&k.current&&Object(d.setFocusWithinElement)(k.current)}),[v,C,A,k]),!y||Object(l.allowFreeText)(y)?r.a.createElement("div",{className:"cp-comment-editor"},v?(t=s.get("metadataId"),a=I.getIn([t,"isAdding"])||I.getIn([t,g,"isUpdating"]),i=g?_.formatMessage({id:"edit_comment_prompt"}):_.formatMessage({id:"add_comment_prompt"}),r.a.createElement(f.a,{ref:A,ugcType:"comment",metadataId:t,handleConfirm:g?j:M,handleCancel:T,label:i,isLoading:a,initialContent:E},r.a.createElement(m.a,{metadataId:t,size:"large",useLibraryBranding:!1}))):r.a.createElement(p.a,null,r.a.createElement("div",{className:"comment-editor__label"},r.a.createElement(c.FormattedMessage,{id:"add_comment_prompt"})),r.a.createElement("button",{ref:k,id:"add-comment",className:"comment-editor__add-comment",onClick:function(){return O.openEditor("comment")},type:"button","data-key":"comment-editor"},r.a.createElement("span",{"aria-hidden":"true"},r.a.createElement(c.FormattedMessage,{id:"add_comment"})),r.a.createElement(u.a,null,r.a.createElement(c.FormattedMessage,{id:"add_comment_sr_only"}))))):null}g.defaultProps={initialContent:""};var h=Object(c.injectIntl)(g),b=a(13),v=a.n(b),E=a(20),y=a(45),I=a(303),S=a(2368),O=a(33),_=a(2456),C=a(70),k=a(2382),A=function(e){function t(){return e.apply(this,arguments)||this}return v()(t,e),t.prototype.render=function(){return r.a.createElement(h,this.props)},t}(r.a.PureComponent),N=Object(E.connect)((function(e,t){var a=t.commentId;return{currentUser:Object(O.c)(e),commentsTransactions:Object(_.d)(e),initialContent:a?Object(C.h)(e).getIn([a.toString(),"comment"]):"",open:!!a||Object(k.a)(e).has("comment")}}),(function(e){return{commentsActions:Object(y.bindActionCreators)(I.a,e),ugcEditorActions:Object(y.bindActionCreators)(S.a,e)}}))(A)},2743:function(e,t,a){"use strict";var n=a(1);Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return r.default}});var r=n(a(2759))},2744:function(e,t,a){"use strict";var n=a(16),r=a.n(n),i=a(488),o=["authRequired","accountRequired"];t.a={openOverlay:function(e,t){void 0===t&&(t={});var a=t,n=a.authRequired,c=void 0!==n&&n,l=a.accountRequired,s=void 0!==l&&l;return{overlayKey:e,overlayData:r()(a,o),type:i.a.OPEN_FULLSCREEN_OVERLAY,middlewareData:{authRequired:c,accountRequired:s}}},closeOverlay:function(e){return{overlayKey:e,type:i.a.CLOSE_FULLSCREEN_OVERLAY}}}},2745:function(e,t,a){"use strict";a.d(t,"e",(function(){return m})),a.d(t,"f",(function(){return p})),a.d(t,"a",(function(){return f})),a.d(t,"c",(function(){return g})),a.d(t,"g",(function(){return h})),a.d(t,"i",(function(){return b})),a.d(t,"b",(function(){return v})),a.d(t,"h",(function(){return E})),a.d(t,"d",(function(){return y}));var n=a(2),r=a.n(n),i=a(9),o=a(70),c=a(71),l=function(e,t){return function(a){return function(n){return n.getIn(["lists","currentUserLists",a,e],t)}}},s=l("items",r.a.List()),u=l("pagination",r.a.List()),d=l("isFetching",!1),m=Object(i.createSelector)([o.x,function(e){return e.getIn(["lists","lists","items"],r.a.List())}],(function(e,t){return t.map((function(t){return e.get(t.toString())}))})),p=Object(i.createSelector)([function(e){return e.getIn(["lists","lists","pagination"],r.a.Map())}],(function(e){return e})),f=Object(i.createSelector)([o.x,s(c.a.DRAFT_NOT_PUBLISHED)],(function(e,t){return t.map((function(t){return e.get(t.toString())}))})),g=Object(i.createSelector)([u(c.a.DRAFT_NOT_PUBLISHED)],(function(e){return e})),h=Object(i.createSelector)([o.x,s(c.a.PUBLISHED)],(function(e,t){return t.map((function(t){return e.get(t.toString())}))})),b=Object(i.createSelector)([u(c.a.PUBLISHED)],(function(e){return e})),v=Object(i.createSelector)([d(c.a.DRAFT_NOT_PUBLISHED)],(function(e){return e})),E=Object(i.createSelector)([d(c.a.PUBLISHED)],(function(e){return e})),y=Object(i.createSelector)([function(e){return e.getIn(["lists","listItemTransactions"],r.a.Map())}],(function(e){return e}))},2749:function(e,t,a){"use strict";a.d(t,"a",(function(){return k}));var n=a(13),r=a.n(n),i=a(0),o=a.n(i),c=a(20),l=a(45),s=a(70),u=a(213),d=a(26),m=a.n(d),p=a(32),f=a(164),g=a(2444),h=a(2736),b=a(2500),v=a(306),E=a(2390),y=a(295);function I(e){var t=e.quotationId,a=e.catalogBib,n=e.quotationsActions,r=e.handleSuccess,i=e.modalActions,c=e.quotationsTransactions;function l(){i.closeModal("delete-quotation-"+t)}return o.a.createElement(y.a,{className:"cp-delete-quotation-modal",modalKey:"delete-quotation-"+t,size:"small",handleClose:l},o.a.createElement(E.a,{ugcType:"quotation",id:t,catalogBib:a,removeUgcAction:n.removeQuotation,transactions:c,handleClose:l,handleSuccess:r}))}var S=function(e){function t(){return e.apply(this,arguments)||this}return r()(t,e),t.prototype.render=function(){return o.a.createElement(I,this.props)},t}(o.a.PureComponent),O=Object(c.connect)((function(e){return{quotationsTransactions:Object(b.d)(e)}}),(function(e){return{quotationsActions:Object(l.bindActionCreators)(v.a,e),modalActions:Object(l.bindActionCreators)(u.a,e)}}))(S),_=function(e){function t(t){var a;return(a=e.call(this,t)||this).optionsDropdownRef=o.a.createRef(),a.state={editorIsOpen:!1},Object(p.bindAll)(m()(a)),a}r()(t,e);var a=t.prototype;return a.componentDidUpdate=function(e,t){!this.state.editorIsOpen&&t.editorIsOpen&&this.optionsDropdownRef.current&&Object(f.setFocusWithinElement)(this.optionsDropdownRef.current)},a.toggleEditor=function(e){this.setState({editorIsOpen:e})},a.openDeletionModal=function(){var e=this.props.quotation.get("id");this.props.modalActions.openModal("delete-quotation-"+e)},a.renderEditor=function(){var e=this,t=this.props,a=t.catalogBib,n=t.quotation;return o.a.createElement(h.a,{catalogBib:a,quotationId:n.get("id"),handleCancel:function(){return e.toggleEditor(!1)},handleSuccess:function(){return e.toggleEditor(!1)}})},a.render=function(){var e=this;if(this.state.editorIsOpen)return o.a.createElement("div",{className:"cp-quotation-display"},this.renderEditor());var t=this.props,a=t.quotation,n=t.displayStaffBadge,r=t.users,i=t.catalogBib,c=t.children,l=t.handleDeleteSuccess,s=r.get(a.get("userId").toString()),u=a.get("id");return o.a.createElement("div",{className:"cp-quotation-display"},o.a.createElement(g.a,{ugcType:"quotation",catalogBib:i,author:s,id:u,key:u,createdDate:a.get("createdDate"),displayStaffBadge:n,compact:!0,optionsDropdownRef:this.optionsDropdownRef,handleDelete:this.openDeletionModal,handleEdit:function(){return e.toggleEditor(!0)}},c),o.a.createElement(O,{quotationId:u,catalogBib:i,handleSuccess:l,handleFocusOnRestore:this.handleDeleteFocus}))},t}(o.a.PureComponent);_.defaultProps={displayStaffBadge:!0};var C=function(e){function t(){return e.apply(this,arguments)||this}return r()(t,e),t.prototype.render=function(){return o.a.createElement(_,this.props)},t}(o.a.PureComponent),k=Object(c.connect)((function(e){return{users:Object(s.O)(e)}}),(function(e){return{modalActions:Object(l.bindActionCreators)(u.a,e)}}))(C)},2750:function(e,t,a){"use strict";a.d(t,"a",(function(){return k}));var n=a(13),r=a.n(n),i=a(0),o=a.n(i),c=a(20),l=a(45),s=a(70),u=a(213),d=a(26),m=a.n(d),p=a(32),f=a(164),g=a(2444),h=a(2737),b=a(2503),v=a(307),E=a(2390),y=a(295);function I(e){var t=e.summaryId,a=e.catalogBib,n=e.summariesActions,r=e.handleSuccess,i=e.modalActions,c=e.summariesTransactions;function l(){i.closeModal("delete-summary-"+t)}return o.a.createElement(y.a,{className:"cp-delete-summary-modal",modalKey:"delete-summary-"+t,size:"small",handleClose:l},o.a.createElement(E.a,{ugcType:"summary",id:t,catalogBib:a,removeUgcAction:n.removeSummary,transactions:c,handleClose:l,handleSuccess:r}))}var S=function(e){function t(){return e.apply(this,arguments)||this}return r()(t,e),t.prototype.render=function(){return o.a.createElement(I,this.props)},t}(o.a.PureComponent),O=Object(c.connect)((function(e){return{summariesTransactions:Object(b.e)(e)}}),(function(e){return{summariesActions:Object(l.bindActionCreators)(v.a,e),modalActions:Object(l.bindActionCreators)(u.a,e)}}))(S),_=function(e){function t(t){var a;return(a=e.call(this,t)||this).optionsDropdownRef=o.a.createRef(),a.state={editorIsOpen:!1},Object(p.bindAll)(m()(a)),a}r()(t,e);var a=t.prototype;return a.componentDidUpdate=function(e,t){!this.state.editorIsOpen&&t.editorIsOpen&&this.optionsDropdownRef.current&&Object(f.setFocusWithinElement)(this.optionsDropdownRef.current)},a.toggleEditor=function(e){this.setState({editorIsOpen:e})},a.openDeletionModal=function(){var e=this.props.summary.get("id");this.props.modalActions.openModal("delete-summary-"+e)},a.renderEditor=function(){var e=this,t=this.props,a=t.catalogBib,n=t.summary;return o.a.createElement(h.a,{catalogBib:a,summaryId:n.get("id"),handleCancel:function(){return e.toggleEditor(!1)},handleSuccess:function(){return e.toggleEditor(!1)}})},a.render=function(){var e=this;if(this.state.editorIsOpen)return o.a.createElement("div",{className:"cp-summary-display"},this.renderEditor());var t=this.props,a=t.summary,n=t.displayStaffBadge,r=t.users,i=t.catalogBib,c=t.children,l=t.handleDeleteSuccess,s=r.get(a.get("userId").toString()),u=a.get("id");return o.a.createElement("div",{className:"cp-summary-display"},o.a.createElement(g.a,{ugcType:"summary",catalogBib:i,author:s,id:u,key:u,optionsDropdownRef:this.optionsDropdownRef,createdDate:a.get("createdDate"),displayStaffBadge:n,compact:!0,handleDelete:this.openDeletionModal,handleEdit:function(){return e.toggleEditor(!0)}},c),o.a.createElement(O,{handleSuccess:l,summaryId:u,catalogBib:i}))},t}(o.a.PureComponent);_.defaultProps={displayStaffBadge:!0};var C=function(e){function t(){return e.apply(this,arguments)||this}return r()(t,e),t.prototype.render=function(){return o.a.createElement(_,this.props)},t}(o.a.PureComponent),k=Object(c.connect)((function(e){return{users:Object(s.O)(e)}}),(function(e){return{modalActions:Object(l.bindActionCreators)(u.a,e)}}))(C)},2751:function(e,t,a){"use strict";a.d(t,"a",(function(){return g}));var n=a(26),r=a.n(n),i=a(13),o=a.n(i),c=a(0),l=a.n(c),s=a(5),u=a(32),d=a(135),m=a(41),p=a(295),f=function(e){function t(t){var a;return a=e.call(this,t)||this,Object(u.bindAll)(r()(a)),a}o()(t,e);var a=t.prototype;return a.handlePrimaryAction=function(){var e=this,t=this.props,a=t.shelfActions,n=t.items,r=t.isBatch,i=n.first().get("shelf"),o=n.map((function(e){return e.get("id")})).toArray(),c=n.map((function(e){return e.get("metadataId")})).toArray();a.removeShelfItems({shelfName:i,shelfItemIds:o,metadataIds:c,isBatch:r,postSuccess:function(){e.props.postSuccess(),e.handleClose()}})},a.handleClose=function(){this.props.modalActions.closeModal(this.props.modalKey)},a.render=function(){var e=this.props.items;return l.a.createElement(p.a,{className:"cp-delete-confirmation-modal",modalKey:this.props.modalKey,handleClose:this.handleClose},l.a.createElement(d.ModalHeader,{title:l.a.createElement(s.FormattedMessage,{id:"remove_item_from_shelves",values:{count:e.size}})}),l.a.createElement(d.ModalContent,null,l.a.createElement("div",{className:"shelves-modal-content"},l.a.createElement("div",{className:"shelves-modal-content-warning"},l.a.createElement(m.ExclamationMarkTriangle,{className:"shelves-modal-exclamation-icon"}),l.a.createElement("div",{className:"shelves-modal-content-warning-text"},l.a.createElement(s.FormattedMessage,{id:"remove_item_from_shelves_warning"}))),l.a.createElement("strong",null,l.a.createElement(s.FormattedMessage,{id:"caution_header"}),":"," "),l.a.createElement(s.FormattedMessage,{id:"remove_item_from_shelves_caution"}))),l.a.createElement(d.ModalFooter,{primaryActionButtonText:l.a.createElement(s.FormattedMessage,{id:"remove_items_button",values:{count:e.size}}),handlePrimaryAction:this.handlePrimaryAction,isLoading:this.props.isLoading}))},t}(l.a.PureComponent);f.defaultProps={postSuccess:function(){}};var g=f},2755:function(e,t,a){"use strict";var n,r,i,o=a(12),c=a.n(o);var l={addAgeSuitability:function(e,t){var a=e.userId,r=e.metadataId,i=e.min,o=t.route(n||(n=c()(["/libraries/","/ugc/ageSuitabilities"])),":librarySubdomain");return t.post(o,{userId:a,metadataId:r,min:i})},updateAgeSuitability:function(e,t){var a=e.userId,n=e.ageSuitabilityId,i=e.min,o=t.route(r||(r=c()(["/libraries/","/ugc/ageSuitabilities/",""])),":librarySubdomain",n);return t.patch(o,{userId:a,min:i})},removeAgeSuitability:function(e,t){var a=e.userId,n=e.ageSuitabilityId,r=t.route(i||(i=c()(["/libraries/","/ugc/ageSuitabilities/",""])),":librarySubdomain",n);return t.delete(r,{userId:a})}},s=a(147),u=a(42),d=a(125);t.a={addAgeSuitability:function(e){var t=e.metadataId,a=e.min,n=e.postSuccess;return{metadataId:t,postSuccess:n,types:[s.a.ADD_AGE_SUITABILITIES_REQUEST,s.a.ADD_AGE_SUITABILITIES_SUCCESS,s.a.ADD_AGE_SUITABILITIES_FAILURE],middlewareData:{authRequired:!0},apiRequest:function(e,n){return l.addAgeSuitability({metadataId:t,min:a,userId:e.getIn(["auth","currentUserId"])},n)},apiSuccess:function(e,a){return{messaging:Object(d.a)({response:e,store:a,metadataId:t,type:"ageRating"})}}}},updateAgeSuitability:function(e){var t=e.metadataId,a=e.ageSuitabilityId,n=e.min,r=e.postSuccess;return{metadataId:t,ageSuitabilityId:a,postSuccess:r,types:[s.a.UPDATE_AGE_SUITABILITIES_REQUEST,s.a.UPDATE_AGE_SUITABILITIES_SUCCESS,s.a.UPDATE_AGE_SUITABILITIES_FAILURE],middlewareData:{authRequired:!0},apiRequest:function(e,t){return l.updateAgeSuitability({ageSuitabilityId:a,min:n,userId:e.getIn(["auth","currentUserId"])},t)},apiSuccess:function(){return{messaging:Object(d.a)({type:"ageRating",metadataId:t,updated:!0})}}}},removeAgeSuitability:function(e){var t=e.metadataId,a=e.ageSuitabilityId,n=e.postSuccess;return{metadataId:t,ageSuitabilityId:a,postSuccess:n,types:[s.a.REMOVE_AGE_SUITABILITIES_REQUEST,s.a.REMOVE_AGE_SUITABILITIES_SUCCESS,s.a.REMOVE_AGE_SUITABILITIES_FAILURE],middlewareData:{authRequired:!0},apiRequest:function(e,t){return l.removeAgeSuitability({ageSuitabilityId:a,userId:e.getIn(["auth","currentUserId"])},t)},apiSuccess:function(){return function(e){return{messaging:Object(u.a)("success_ugc_remove_message",{values:{ugcType:"ageRating"}}),deletedEntities:["ugc.ageSuitabilities."+e]}}(a)}}}}},2756:function(e,t,a){var n=a(883),r=a(246),i=a(2757),o=a(89),c=a(877);e.exports=function(e,t,a){var l=o(e)?n:i;return a&&c(e,t,a)&&(t=void 0),l(e,r(t,3))}},2757:function(e,t,a){var n=a(399);e.exports=function(e,t){var a;return n(e,(function(e,n,r){return!(a=t(e,n,r))})),!!a}},2758:function(e,t,a){"use strict";a.d(t,"a",(function(){return c})),a.d(t,"b",(function(){return l}));var n=a(2),r=a.n(n),i=a(9),o=function(e){return e.get("preview",r.a.Map())},c=Object(i.createSelector)([o],(function(e){return e.get("previewFeatures",r.a.Map())})),l=Object(i.createSelector)([o],(function(e){return e.get("previewTransactions",r.a.Map())}))},2759:function(e,t,a){"use strict";var n=a(1);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(a(24)),i=n(a(25)),o=n(a(26)),c=n(a(27)),l=n(a(28)),s=n(a(29)),u=n(a(4)),d=n(a(0)),m=a(5),p=n(a(55)),f=n(a(6)),g=a(32),h=a(3),b=a(191),v=n(a(2406)),E=a(118),y=a(82),I=a(106),S=n(a(40)),O=a(126),_=n(a(67)),C=n(a(38));function k(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=(0,s.default)(e);if(t){var r=(0,s.default)(this).constructor;a=Reflect.construct(n,arguments,r)}else a=n.apply(this,arguments);return(0,l.default)(this,a)}}a(2760);var A=O.analyticsComposer.composeEvent,N=O.analyticsComposer.composeAnalytics,T=S.default.EVENTS,M=S.default.ACTIONS,j=S.default.CATEGORIES,F=S.default.CUSTOM_DIMENSIONS;function L(e){var t=e.gtmAction,a=e.gtmLabel,n=e.gtmValue,r=void 0===n?1:n,i=e.gtmContainerName,o=e.gtmContentCreator,c=e.gtmCreatorType,l=e.gtmCardTitle;return A(T.LIST_CARD,{gtmCategory:j.CARDS_LIST,gtmAction:t,gtmLabel:a,gtmValue:r,gtmContainerName:i,gtmContentType:F.CONTENT_TYPES.LIST,gtmContentCreator:o,gtmCreatorType:c,gtmCardTitle:l})}var w=function(e){(0,c.default)(a,e);var t=k(a);function a(e){var n;return(0,r.default)(this,a),(n=t.call(this,e)).state={useDefaultImage:!1},(0,g.bindAll)((0,o.default)(n)),n}return(0,i.default)(a,[{key:"useDefaultImage",value:function(){this.setState({useDefaultImage:!0})}},{key:"getHeadingClass",value:function(){return(0,f.default)("list-card__title",{"list-card__title--small":this.props.smallHeading})}},{key:"renderDescription",value:function(){if(!this.props.list.get("description"))return null;var e=(0,b.truncate)(this.props.list.get("description",""),{desiredLength:120});return d.default.createElement("div",{className:"list-card__description"},e)}},{key:"renderDate",value:function(){return d.default.createElement("div",{className:"list-card__date"},d.default.createElement(m.FormattedDate,{value:p.default.utc(this.props.list.get("created")).toDate(),year:"numeric",month:"short",day:"2-digit"}))}},{key:"renderLibraryName",value:function(){var e=this.props,t=e.creator,a=e.library,n=t.get("homeLibrarySubdomain")===a.get("domain"),r=a.get("longName");return n?d.default.createElement(d.default.Fragment,null,d.default.createElement("div",{className:"list-card__library-name","aria-hidden":!0},r),d.default.createElement(C.default,null,d.default.createElement(m.FormattedMessage,{id:"sr_library_user",values:{libraryName:r}}))):null}},{key:"render",value:function(){var e=this.props,t=e.creator,a=e.horizontal,n=e.list,r=e.showDescription,i=e.showDate,o=e.showUserBadge,c="/list/share/"+t.get("id")+"/"+n.get("id"),l="/user_profile/"+t.get("id"),s=t.get("name"),u=this.props.titleTag,p=t.get("staff")?F.CREATOR_TYPES.LIBRARY_STAFF:F.CREATOR_TYPES.LIBRARY_PATRON;return d.default.createElement("div",{className:(0,f.default)("cp-list-card",{"list-card--horizontal":a})},d.default.createElement("div",{className:"list-card__image-wrapper"},d.default.createElement(E.Link,{href:c,className:"list-card__image-link",dataKey:"list-card-image-link","aria-hidden":"true",tabIndex:"-1",handleClick:function(){return function(e,t,a,n,r){(0,I.sendAnalyticsEvents)(N([L({gtmAction:M.CLICK_IMAGE,gtmLabel:e,gtmContainerName:t,gtmContentCreator:a,gtmCreatorType:n,gtmCardTitle:r})]))}(n.get("name")+" | "+n.get("id"),F.CONTAINER_NAMES.BIB_STAFF_LISTS,t.get("name"),p,n.get("name")+" | "+n.get("id"))}},this.state.useDefaultImage?d.default.createElement(y.Lattice,null):d.default.createElement("img",{className:"list-card__image",src:n.get("imageUrl"),alt:n.get("name")+" - "+t.get("name"),"aria-hidden":this.props.imageIsDecorative,onError:this.useDefaultImage,loading:"lazy"}))),d.default.createElement("div",{className:"list-card__content"},d.default.createElement("div",{className:"list-card__type","aria-hidden":!0},d.default.createElement(m.FormattedMessage,{id:"user_list_purpose_"+n.get("listType").toLowerCase()})),d.default.createElement(C.default,null,d.default.createElement(m.FormattedMessage,{id:"sr_list_type",values:{listType:d.default.createElement(m.FormattedMessage,{id:"user_list_purpose_"+n.get("listType").toLowerCase()})}})),d.default.createElement(E.Link,{href:c,className:this.getHeadingClass(),dataKey:"list-card-title-link",handleClick:function(){return function(e,t,a,n,r){(0,I.sendAnalyticsEvents)(N([L({gtmAction:M.CLICK_TITLE,gtmLabel:e,gtmContainerName:t,gtmContentCreator:a,gtmCreatorType:n,gtmCardTitle:r})]))}(n.get("name")+" | "+n.get("id"),F.CONTAINER_NAMES.BIB_STAFF_LISTS,t.get("name"),p,n.get("name")+" | "+n.get("id"))}},d.default.createElement(u,null,n.get("name"))),r&&this.renderDescription(),d.default.createElement("div",{className:"list-card__creator"},this.context.mobileApp?t.get("name"):d.default.createElement(E.Link,{href:l,className:(0,f.default)("list-card__creator-link",{"list-card__creator-link--small":this.props.smallCreatorLink}),dataKey:"list-card-creator-link"},d.default.createElement("span",{"aria-hidden":!0},s),d.default.createElement(C.default,null,d.default.createElement(m.FormattedMessage,{id:"sr_list_card_creator",values:{name:s}}))),o&&d.default.createElement(v.default,{className:"list-card__badge",userIdentity:t})),this.renderLibraryName(),i&&this.renderDate()))}}]),a}(d.default.PureComponent);t.default=w,w.propTypes={creator:h.userIdentityShape,list:h.listShape,library:h.libraryShape,imageIsDecorative:u.default.bool,titleTag:u.default.string,horizontal:u.default.bool,smallHeading:u.default.bool,smallCreatorLink:u.default.bool,showDescription:u.default.bool,showDate:u.default.bool,showUserBadge:u.default.bool},w.defaultProps={titleTag:"h3"},w.contextType=_.default},2760:function(e,t,a){"use strict";a.r(t)},2761:function(e,t,a){"use strict";var n=a(1);Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.Tabs=void 0;var r=n(a(24)),i=n(a(25)),o=n(a(27)),c=n(a(28)),l=n(a(29)),s=n(a(4)),u=n(a(0)),d=n(a(6)),m=a(5),p=n(a(2)),f=n(a(394)),g=a(393);function h(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=(0,l.default)(e);if(t){var r=(0,l.default)(this).constructor;a=Reflect.construct(n,arguments,r)}else a=n.apply(this,arguments);return(0,c.default)(this,a)}}a(2762);var b=function(e){(0,o.default)(a,e);var t=h(a);function a(){var e;(0,r.default)(this,a);for(var n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).handleDropDownSelect=function(t){e.handleTabClick(null,t)},e}return(0,i.default)(a,[{key:"componentDidUpdate",value:function(e){var t=this.props.options.find((function(e){return e.selected}));e.options.find((function(e){return e.selected})).value!==t.value&&this.focusOnTabContent()}},{key:"focusOnTabContent",value:function(){this.props.restoreFocus(),this.props.captureFocus(this._tabContentContainer,!1)}},{key:"handleTabClick",value:function(e,t){e&&e.preventDefault&&e.preventDefault(),this.props.handleSelect(t)}},{key:"renderTab",value:function(e){var t=this,a=(0,d.default)("tabs__tab-panel__tab",{"tabs__tab-panel__tab--active":e.selected}),n=e.selected?"true":"false";return u.default.createElement("li",{key:e.value,className:a},u.default.createElement("button",{"aria-pressed":n,"data-content":e.label,"data-key":"tab-link",onClick:function(a){return t.handleTabClick(a,e.value)},type:"button"},e.label))}},{key:"renderTabs",value:function(){var e=this;return u.default.createElement("ul",null,this.props.options.map((function(t){return e.renderTab(t)})))}},{key:"renderDropDown",value:function(){var e=this.props.options,t=p.default.List(e.map((function(e){return p.default.Map({label:e.label,value:e.value,selected:e.selected})})));return u.default.createElement(g.Dropdown,{handleSelect:this.handleDropDownSelect,options:t,className:"tabs__tab-panel__dropdown",dataKey:"tabs-dropdown",selectable:!0,buttonTag:g.FlatDropdownButton})}},{key:"render",value:function(){var e=this;return u.default.createElement("div",{className:"cp-tabs","data-key":"tabs"},u.default.createElement("div",{className:"tabs__tab-panel"},this.renderTabs(),this.renderDropDown()),u.default.createElement("div",{className:"tabs__tab-content",ref:function(t){return e._tabContentContainer=t}},this.props.renderContent()))}}]),a}(u.default.PureComponent);t.Tabs=b;var v=s.default.shape({label:s.default.oneOfType([s.default.arrayOf(s.default.node),s.default.node,s.default.string]).isRequired,value:s.default.oneOfType([s.default.string,s.default.number]).isRequired,selected:s.default.bool.isRequired});b.propTypes={options:s.default.arrayOf(v).isRequired,handleSelect:s.default.func.isRequired,renderContent:s.default.func.isRequired,captureFocus:s.default.func.isRequired,restoreFocus:s.default.func.isRequired};var E=(0,m.injectIntl)((0,f.default)(b));t.default=E},2762:function(e,t,a){"use strict";a.r(t)},2766:function(e,t,a){"use strict";var n=a(1);Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"LinkedPill",{enumerable:!0,get:function(){return i.default}}),Object.defineProperty(t,"Pill",{enumerable:!0,get:function(){return r.default}});var r=n(a(2767)),i=n(a(2769))},2767:function(e,t,a){"use strict";var n=a(1);Object.defineProperty(t,"__esModule",{value:!0}),t.default=m;var r=n(a(4)),i=n(a(0)),o=n(a(6)),c=a(5),l=n(a(38)),s=a(3),u=a(88),d=a(82);function m(e){var t=e.className,a=e.children,n=e.icon,r=e.handleDismiss,s=(0,o.default)("cp-pill",t,{"pill--dismissible":r});return i.default.createElement("span",{className:s},n,a,r&&i.default.createElement(u.IconButton,{dataKey:"pill-dismiss",handleClick:r},i.default.createElement(l.default,null,i.default.createElement(c.FormattedMessage,{id:"remove_pill",values:{name:a}})),i.default.createElement(d.Close,null)))}a(2768),m.propTypes={className:r.default.string,children:s.childrenShape.isRequired,icon:r.default.node,handleDismiss:r.default.func}},2768:function(e,t,a){"use strict";a.r(t)},2769:function(e,t,a){"use strict";var n=a(1);Object.defineProperty(t,"__esModule",{value:!0}),t.default=p;var r=n(a(21)),i=n(a(16)),o=n(a(4)),c=n(a(0)),l=n(a(6)),s=a(3),u=a(191),d=a(118);a(2770);var m=["className","children","icon"];function p(e){var t=e.className,a=e.children,n=e.icon,o=(0,i.default)(e,m),s=(0,u.truncate)(a,{desiredLength:20});return c.default.createElement(d.GhostLink,(0,r.default)({},o,{dataKey:"pill-link",className:(0,l.default)("cp-linked-pill",t),rounded:!0,size:"small"}),n,s)}p.propTypes={className:o.default.string,children:s.childrenShape.isRequired,href:o.default.string.isRequired,icon:o.default.node}},2770:function(e,t,a){"use strict";a.r(t)},2771:function(e,t,a){"use strict";a.d(t,"b",(function(){return c})),a.d(t,"c",(function(){return l})),a.d(t,"a",(function(){return s}));var n=a(9),r=a(2),i=a.n(r),o=a(506),c=(Object(o.d)("tags"),Object(o.e)("tags")),l=(Object(o.c)("tags"),Object(n.createSelector)([function(e){return e.getIn(["ugc","tagsTransactions"],i.a.Map())}],(function(e){return e}))),s=Object(n.createSelector)([function(e){return e.getIn(["ugc","tags","summaries"],i.a.List())}],(function(e){return e}))},2772:function(e,t,a){"use strict";a.d(t,"a",(function(){return c})),a.d(t,"c",(function(){return l})),a.d(t,"b",(function(){return s}));var n=a(9),r=a(2),i=a.n(r),o=a(506),c=Object(o.a)("iOwnThis"),l=Object(n.createSelector)([function(e){return e.getIn(["ugc","iOwnThisTransactions"],i.a.Map())}],(function(e){return e})),s=Object(o.b)("iOwnThis")},2883:function(e,t,a){"use strict";a.d(t,"a",(function(){return O}));var n=a(0),r=a.n(n),i=a(20),o=a(5),c=a(398),l=a.n(c),s=a(118),u=a(38),d=a.n(u),m=a(2389),p=a(2744),f=a(70),g=a(52),h=a(2423),b=a.n(h),v=a(2372),E=a(2357),y=a(508);function I(e){var t=e.catalogBib,a=e.isbn,c=Object(i.useSelector)(g.b),l=Object(n.useState)(!1),s=l[0],u=l[1],d=t.get("metadataId"),m=c.getIn(["novelistParameters","profile"]),p=c.getIn(["novelistParameters","password"]);return Object(n.useEffect)((function(){!function e(){window.novSelect?(u(!0),window.novSelect.loadContentForQuery({ClientIdentifier:a,ISBN:a,version:"2.3"},m,p,(function(){return u(!1)}))):b()("https://imageserver.ebscohost.com/novelistselect/ns2init.js",e)}()}),[a,m,p]),r.a.createElement(v.FullScreenOverlayBody,{className:"cp-novelist-overlay"},r.a.createElement(v.FullScreenOverlayHeader,{title:r.a.createElement(o.FormattedMessage,{id:"vendor_novelist"})}),r.a.createElement(v.FullScreenOverlayContent,{size:"medium"},r.a.createElement(y.b,{metadataId:d}),r.a.createElement("div",{"data-novelist-novelistselect":a}),s&&r.a.createElement(E.TableStencil,null)))}var S="more-from-novelist-overlay";function O(e){var t=e.catalogBib,a=e.heading,c=e.handleClick,u=Object(i.useDispatch)(),h=Object(i.useSelector)(f.d),b=Object(i.useSelector)(g.b),v=Object(n.useState)(!1),E=v[0],y=v[1],O=h.getIn([t.get("metadataId"),"briefInfo","isbns",0]),_=b.getIn(["novelistParameters","profile"]),C=b.getIn(["novelistParameters","password"]);return Object(n.useEffect)((function(){var e;return O&&_&&C&&(e=l.a.get("https://novselect.ebscohost.com/Data/ContentByQuery").query({profile:_,password:C,ClientIdentifier:O,ISBN:O}).then((function(t){if(!e.aborted){var a=JSON.parse(t.text),n=Object.keys(a.FeatureContent||{}).filter((function(e){return!["EResourceRecommendation","GoodReads"].includes(e)}));y(!!n.length)}}))),function(){e&&(e.aborted=!0)}}),[O,_,C]),O&&_&&C&&E?r.a.createElement("div",{className:"cp-more-from-novelist"},a&&r.a.createElement("div",{className:"heading"},a),r.a.createElement(s.ChevronLink,{href:"#novelist-overlay",dataKey:"more-from-novelist-link",handleClick:function(){u(p.a.openOverlay(S)),c&&c()},preventDefault:!0},r.a.createElement("span",{"aria-hidden":!0},r.a.createElement(o.FormattedMessage,{id:"view_all_from_novelist"})),r.a.createElement(d.a,null,r.a.createElement(o.FormattedMessage,{id:"sr_view_all_from_novelist"}))),r.a.createElement(m.a,{dataKey:"novelist-overlay",overlayKey:S,handleClose:function(){u(p.a.closeOverlay(S))}},r.a.createElement(I,{catalogBib:t,isbn:O}))):null}},2887:function(e,t,a){"use strict";a.d(t,"a",(function(){return f}));var n=a(0),r=a.n(n),i=a(6),o=a.n(i),c=a(5),l=a(163),s=a.n(l),u=a(297),d=a(118),m=a(507),p=a(15);function f(e){var t=e.review,a=e.compact;var n=o()("cp-bib-review",{"cp-bib-review--compact":a});return r.a.createElement("div",{className:n},r.a.createElement(s.a,{tagName:"h4",size:"modest",className:"review-source"},t.get("source")),!a&&r.a.createElement(m.a,{value:t.get("reviewDate")}),t.get("providerURI")===p.b.I_DREAM_BOOKS?r.a.createElement("div",{dangerouslySetInnerHTML:{__html:t.get("contents")}}):r.a.createElement(u.ExpandableHtml,{htmlText:t.get("contents"),truncateCount:240,dataKey:"critics-reviews",expandLinkHref:"#read-more-review-"+t.get("id"),textKey:"review"}),t.get("reviewLink")&&r.a.createElement(d.ChevronLink,{href:t.get("reviewLink"),className:"full-review",dataKey:"display-full-review"},r.a.createElement(c.FormattedMessage,{id:"full_review"})))}},2888:function(e,t,a){"use strict";a.d(t,"a",(function(){return o}));var n=a(0),r=a.n(n),i=a(118);function o(e){var t=e.userId,a=e.shelfName,n=e.children,o=e.handleClick;return r.a.createElement(i.Link,{className:"cp-shelf-link",href:"/v2/users/"+t+"/shelves/"+a,handleClick:o,dataKey:"shelf-link"},n)}},2893:function(e,t,a){"use strict";var n,r,i,o=a(12),c=a.n(o),l=a(132);var s={addTags:function(e,t){var a=e.userId,r=e.tags,i=t.route(n||(n=c()(["/libraries/","/ugc/tags"])),":librarySubdomain");return t.post(i,{userId:a,tags:r})},removeTag:function(e,t){var a=e.userId,n=e.tagId,i=e.type,o=t.route(r||(r=c()(["/libraries/","/ugc/tags/",""])),":librarySubdomain",n);return t.delete(o,{userId:a,type:i})},fetchTagSummaries:function(e,t){var a=t.route(i||(i=c()(["/libraries/","/ugc/tags/summaries"])),":librarySubdomain");return t.get(a,{query:{metadataId:e,size:l.a}})}},u=a(42);t.a={addTags:function(e,t,a){return{metadataId:e,types:[l.c.ADD_TAG_REQUEST,l.c.ADD_TAG_SUCCESS,l.c.ADD_TAG_FAILURE],middlewareData:{authRequired:!0},postSuccess:a,apiRequest:function(e,a){return s.addTags({tags:t,userId:e.getIn(["auth","currentUserId"])},a)}}},removeTag:function(e,t,a){return{metadataId:e,tagId:t,types:[l.c.REMOVE_TAG_REQUEST,l.c.REMOVE_TAG_SUCCESS,l.c.REMOVE_TAG_FAILURE],middlewareData:{authRequired:!0},apiRequest:function(e,n){return s.removeTag({tagId:t,userId:e.getIn(["auth","currentUserId"]),type:a},n)},apiSuccess:function(){return function(e){return{messaging:Object(u.a)("message_successful_remove_tag"),deletedEntities:["ugc.tags."+e]}}(t)}}},fetchTagSummaries:function(e){return{metadataId:e,types:[l.c.FETCH_TAG_SUMMARIES_REQUEST,l.c.FETCH_TAG_SUMMARIES_SUCCESS,l.c.FETCH_TAG_SUMMARIES_FAILURE],apiRequest:function(t,a){return s.fetchTagSummaries(e,a)}}}}},2894:function(e,t,a){"use strict";var n,r,i=a(12),o=a.n(i);var c={createIOwnThisSetting:function(e,t){var a=e.userId,r=e.metadataId,i=t.route(n||(n=o()(["/libraries/","/ugc/iownthis"])),":librarySubdomain");return t.post(i,{userId:a,metadataId:r})},removeIOwnThisSetting:function(e,t){var a=e.userId,n=e.ownerSettingId,i=t.route(r||(r=o()(["/libraries/","/ugc/iownthis/",""])),":librarySubdomain",n);return t.delete(i,{userId:a})}},l=a(209);t.a={createIOwnThisSetting:function(e){return{metadataId:e,types:[l.a.CREATE_I_OWN_THIS_SETTING_REQUEST,l.a.CREATE_I_OWN_THIS_SETTING_SUCCESS,l.a.CREATE_I_OWN_THIS_SETTING_FAILURE],middlewareData:{authRequired:!0},apiRequest:function(t,a){return c.createIOwnThisSetting({metadataId:e,userId:t.getIn(["auth","currentUserId"])},a)}}},removeIOwnThisSetting:function(e,t){return{metadataId:e,ownerSettingId:t,types:[l.a.REMOVE_I_OWN_THIS_SETTING_REQUEST,l.a.REMOVE_I_OWN_THIS_SETTING_SUCCESS,l.a.REMOVE_I_OWN_THIS_SETTING_FAILURE],middlewareData:{authRequired:!0},apiRequest:function(e,a){return c.removeIOwnThisSetting({ownerSettingId:t,userId:e.getIn(["auth","currentUserId"])},a)},apiSuccess:function(){return{deletedEntities:["ugc.iOwnThis."+t]}}}}}},2901:function(e,t,a){"use strict";var n=a(1);Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"Select",{enumerable:!0,get:function(){return r.default}}),Object.defineProperty(t,"SelectDivider",{enumerable:!0,get:function(){return i.default}}),Object.defineProperty(t,"SelectOption",{enumerable:!0,get:function(){return o.default}});var r=n(a(2962)),i=n(a(2966)),o=n(a(2902))},2902:function(e,t,a){"use strict";var n=a(1);Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return r.default}});var r=n(a(2964))},2903:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"SelectionCard",{enumerable:!0,get:function(){return n.SelectionCard}}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return n.default}});var n=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var a=r(t);if(a&&a.has(e))return a.get(e);var n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var c=i?Object.getOwnPropertyDescriptor(e,o):null;c&&(c.get||c.set)?Object.defineProperty(n,o,c):n[o]=e[o]}n.default=e,a&&a.set(e,n);return n}(a(2971));function r(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,a=new WeakMap;return(r=function(e){return e?a:t})(e)}},2904:function(e,t,a){"use strict";var n=a(1);Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return r.default}});var r=n(a(2972))},2962:function(e,t,a){"use strict";var n=a(1);Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return r.default}});var r=n(a(2963))},2963:function(e,t,a){"use strict";var n=a(1);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(a(21)),i=n(a(24)),o=n(a(25)),c=n(a(26)),l=n(a(27)),s=n(a(28)),u=n(a(29)),d=n(a(4)),m=n(a(0)),p=n(a(6)),f=a(165),g=a(32),h=a(3),b=a(82),v=n(a(2902));function E(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=(0,u.default)(e);if(t){var r=(0,u.default)(this).constructor;a=Reflect.construct(n,arguments,r)}else a=n.apply(this,arguments);return(0,s.default)(this,a)}}a(2965);var y=function(e){(0,l.default)(a,e);var t=E(a);function a(e){var n;return(0,i.default)(this,a),n=t.call(this,e),(0,g.bindAll)((0,c.default)(n)),n}return(0,o.default)(a,[{key:"handleChange",value:function(e){this.props.handleChange(e.target.value)}},{key:"render",value:function(){var e=this.props,t=e.className,a=e.children,n=e.flat,i=e.block,o=e.disabled,c=e.prompt,l=e.value,s=e.dataKey,u=(0,p.default)("cp-select",t,{"select--block":i,"select--disabled":o});return m.default.createElement("div",{className:u},m.default.createElement("select",(0,r.default)({},(0,f.getValidHtmlAttributes)(this.props,"select"),{className:(0,p.default)("select__select",{"select__select--flat":n}),"data-key":s,value:l||"",onChange:this.handleChange}),m.default.createElement(v.default,{key:"prompt",value:"",disabled:!0},c),a),m.default.createElement(b.ChevronDown,{className:"select__chevron"}))}}]),a}(m.default.PureComponent);t.default=y,y.propTypes={className:d.default.string,children:h.childrenShape.isRequired,id:d.default.string.isRequired,value:d.default.oneOfType([d.default.number,d.default.string]),handleChange:d.default.func.isRequired,dataKey:d.default.string.isRequired,name:d.default.string.isRequired,prompt:d.default.string.isRequired,flat:d.default.bool,block:d.default.bool,disabled:d.default.bool}},2964:function(e,t,a){"use strict";var n=a(1);Object.defineProperty(t,"__esModule",{value:!0}),t.default=c;var r=n(a(4)),i=n(a(0)),o=n(a(6));function c(e){var t=e.className,a=e.children,n=e.value,r=e.disabled;return i.default.createElement("option",{className:(0,o.default)("cp-select-option",t),value:n,disabled:r},a)}c.propTypes={className:r.default.string,disabled:r.default.bool,children:r.default.oneOfType([r.default.number,r.default.string]).isRequired,value:r.default.oneOfType([r.default.number,r.default.string]).isRequired}},2965:function(e,t,a){"use strict";a.r(t)},2966:function(e,t,a){"use strict";var n=a(1);Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return r.default}});var r=n(a(2967))},2967:function(e,t,a){"use strict";var n=a(1);Object.defineProperty(t,"__esModule",{value:!0}),t.default=c;var r=n(a(4)),i=n(a(0)),o=n(a(6));function c(e){var t=e.className;return i.default.createElement("option",{className:(0,o.default)("cp-select-divider",t),disabled:!0,"aria-hidden":!0},"")}c.propTypes={className:r.default.string}},2968:function(e,t,a){"use strict";function n(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var a=[],n=!0,r=!1,i=void 0;try{for(var o,c=e[Symbol.iterator]();!(n=(o=c.next()).done)&&(a.push(o.value),!t||a.length!==t);n=!0);}catch(e){r=!0,i=e}finally{try{n||null==c.return||c.return()}finally{if(r)throw i}}return a}}(e,t)||function(e,t){if(e){if("string"==typeof e)return r(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?r(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}!function(){function t(e){return["elInY+elHeight","elCenterY-".concat(e=0<arguments.length&&void 0!==e?e:30),"elCenterY","elCenterY+".concat(e),"elOutY-elHeight"]}var a,r,c,l,s,u,d={fadeInOut:function(e,a){return a=1<arguments.length&&void 0!==a?a:0,{opacity:[t(0<arguments.length&&void 0!==e?e:30),[a,1,1,1,a]]}},fadeIn:function(e,t){return{opacity:[["elInY+elHeight",0<arguments.length&&void 0!==e?e:"elCenterY"],[1<arguments.length&&void 0!==t?t:0,1]]}},fadeOut:function(e,t){return{opacity:[[0<arguments.length&&void 0!==e?e:"elCenterY","elOutY-elHeight"],[1,1<arguments.length&&void 0!==t?t:0]]}},blurInOut:function(e,a){return a=1<arguments.length&&void 0!==a?a:20,{blur:[t(0<arguments.length&&void 0!==e?e:100),[a,0,0,0,a]]}},blurIn:function(e,t){return{blur:[["elInY+elHeight",0<arguments.length&&void 0!==e?e:"elCenterY"],[1<arguments.length&&void 0!==t?t:20,0]]}},blurOut:function(e,t){return{opacity:[[0<arguments.length&&void 0!==e?e:"elCenterY","elOutY-elHeight"],[0,1<arguments.length&&void 0!==t?t:20]]}},scaleInOut:function(e,a){return a=1<arguments.length&&void 0!==a?a:.6,{scale:[t(0<arguments.length&&void 0!==e?e:100),[a,1,1,1,a]]}},scaleIn:function(e,t){return{scale:[["elInY+elHeight",0<arguments.length&&void 0!==e?e:"elCenterY"],[1<arguments.length&&void 0!==t?t:.6,1]]}},scaleOut:function(e,t){return{scale:[[0<arguments.length&&void 0!==e?e:"elCenterY","elOutY-elHeight"],[1,1<arguments.length&&void 0!==t?t:.6]]}},slideX:function(e,t){return{translateX:[["elInY",0<arguments.length&&void 0!==e?e:0],[0,1<arguments.length&&void 0!==t?t:500]]}},slideY:function(e,t){return{translateY:[["elInY",0<arguments.length&&void 0!==e?e:0],[0,1<arguments.length&&void 0!==t?t:500]]}},spin:function(e,t){return{rotate:[[0,e=0<arguments.length&&void 0!==e?e:1e3],[0,1<arguments.length&&void 0!==t?t:360],{modValue:e}]}},flipX:function(e,t){return{rotateX:[[0,e=0<arguments.length&&void 0!==e?e:1e3],[0,1<arguments.length&&void 0!==t?t:360],{modValue:e}]}},flipY:function(e,t){return{rotateY:[[0,e=0<arguments.length&&void 0!==e?e:1e3],[0,1<arguments.length&&void 0!==t?t:360],{modValue:e}]}},jiggle:function(e,t){return{skewX:[[0,+(e=0<arguments.length&&void 0!==e?e:50),2*e,3*e,4*e],[0,t=1<arguments.length&&void 0!==t?t:40,0,-t,0],{modValue:4*e}]}},seesaw:function(e,t){return{skewY:[[0,+(e=0<arguments.length&&void 0!==e?e:50),2*e,3*e,4*e],[0,t=1<arguments.length&&void 0!==t?t:40,0,-t,0],{modValue:4*e}]}},zigzag:function(e,t){return{translateX:[[0,+(e=0<arguments.length&&void 0!==e?e:100),2*e,3*e,4*e],[0,t=1<arguments.length&&void 0!==t?t:100,0,-t,0],{modValue:4*e}]}},hueRotate:function(e,t){return{"hue-rotate":[[0,e=0<arguments.length&&void 0!==e?e:600],[0,1<arguments.length&&void 0!==t?t:360],{modValue:e}]}}},m=(a=["perspective","scaleX","scaleY","scale","skewX","skewY","skew","rotateX","rotateY","rotate"],r=["blur","hue-rotate","brightness"],c=["translateX","translateY","translateZ"],l=["perspective","border-radius","blur","translateX","translateY","translateZ"],s=["hue-rotate","rotate","rotateX","rotateY","skew","skewX","skewY"],u={easeInQuad:function(e){return e*e},easeOutQuad:function(e){return e*(2-e)},easeInOutQuad:function(e){return e<.5?2*e*e:(4-2*e)*e-1},easeInCubic:function(e){return e*e*e},easeOutCubic:function(e){return--e*e*e+1},easeInOutCubic:function(e){return e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1},easeInQuart:function(e){return e*e*e*e},easeOutQuart:function(e){return 1- --e*e*e*e},easeInOutQuart:function(e){return e<.5?8*e*e*e*e:1-8*--e*e*e*e},easeInQuint:function(e){return e*e*e*e*e},easeOutQuint:function(e){return 1+--e*e*e*e*e},easeInOutQuint:function(e){return e<.5?16*e*e*e*e*e:1+16*--e*e*e*e*e},easeOutBounce:function(e){var t=7.5625,a=2.75;return e<1/a?t*e*e:e<2/a?t*(e-=1.5/a)*e+.75:e<2.5/a?t*(e-=2.25/a)*e+.9375:t*(e-=2.625/a)*e+.984375},easeInBounce:function(e){return 1-u.easeOutBounce(1-e)},easeOutBack:function(e){return 1+2.70158*Math.pow(e-1,3)+1.70158*Math.pow(e-1,2)},easeInBack:function(e){return 2.70158*e*e*e-1.70158*e*e}},new function e(){var t=this;i(this,e),o(this,"drivers",[]),o(this,"elements",[]),o(this,"frame",0),o(this,"debug",!1),o(this,"windowWidth",0),o(this,"windowHeight",0),o(this,"presets",d),o(this,"debugData",{frameLengths:[]}),o(this,"init",(function(){t.findAndAddElements(),window.requestAnimationFrame(t.onAnimationFrame),t.windowWidth=document.body.clientWidth,t.windowHeight=document.body.clientHeight,window.onresize=t.onWindowResize})),o(this,"onWindowResize",(function(){document.body.clientWidth===t.windowWidth&&document.body.clientHeight===t.windowHeight||(t.windowWidth=document.body.clientWidth,t.windowHeight=document.body.clientHeight,t.elements.forEach((function(e){return e.calculateTransforms()})))})),o(this,"onAnimationFrame",(function(e){t.debug&&(t.debugData.frameStart=Date.now());var a,n={};t.drivers.forEach((function(e){n[e.name]=e.getValue(t.frame)})),t.elements.forEach((function(e){e.update(n,t.frame)})),t.debug&&t.debugData.frameLengths.push(Date.now()-t.debugData.frameStart),t.frame%60==0&&t.debug&&(a=Math.ceil(t.debugData.frameLengths.reduce((function(e,t){return e+t}),0)/60),console.log("Average frame calculation time: ".concat(a,"ms")),t.debugData.frameLengths=[]),t.frame++,window.requestAnimationFrame(t.onAnimationFrame)})),o(this,"addDriver",(function(e,a){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};t.drivers.push(new g(e,a,n))})),o(this,"removeDriver",(function(e){t.drivers=t.drivers.filter((function(t){return t.name!==e}))})),o(this,"findAndAddElements",(function(){t.elements=[],document.querySelectorAll(".lax").forEach((function(e){var a=[];e.classList.forEach((function(e){e.includes("lax_preset")&&(e=e.replace("lax_preset_",""),a.push(e))}));var n=o({},"scrollY",{presets:a});t.elements.push(new h(".lax",t,e,n,0,{}))}))})),o(this,"addElements",(function(e,a,n){document.querySelectorAll(e).forEach((function(r,i){t.elements.push(new h(e,t,r,a,i,n))}))})),o(this,"removeElements",(function(e){t.elements=t.elements.filter((function(t){return t.selector!==e}))})),o(this,"addElement",(function(e,a,n){t.elements.push(new h("",t,e,a,0,n))})),o(this,"removeElement",(function(e){t.elements=t.elements.filter((function(t){return t.domElement!==e}))}))});function p(e,t){if(Array.isArray(e))return e;for(var a=Object.keys(e).map((function(e){return parseInt(e)})).sort((function(e,t){return t<e?1:-1})),n=a[a.length-1],r=0;r<a.length;r++){var i=a[r];if(t<i){n=i;break}}return e[n]}function f(e,t,a){var n=t.width,r=t.height,i=t.x,o=t.y;if("number"==typeof e)return e;var c=document.body.scrollHeight,l=document.body.scrollWidth,s=window.innerWidth,u=window.innerHeight,d=window.scrollY;i=(t=i+window.scrollX)+n,d=(o=o+d)+r;return Function("return ".concat(e.replace(/screenWidth/g,s).replace(/screenHeight/g,u).replace(/pageHeight/g,c).replace(/pageWidth/g,l).replace(/elWidth/g,n).replace(/elHeight/g,r).replace(/elInY/g,o-u).replace(/elOutY/g,d).replace(/elCenterY/g,o+r/2-u/2).replace(/elInX/g,t-s).replace(/elOutX/g,i).replace(/elCenterX/g,t+n/2-s/2).replace(/index/g,a)))()}function g(e,t){var a=this,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};i(this,g),o(this,"getValueFn",void 0),o(this,"name",""),o(this,"lastValue",0),o(this,"frameStep",1),o(this,"m1",0),o(this,"m2",0),o(this,"inertia",0),o(this,"inertiaEnabled",!1),o(this,"getValue",(function(e){var t=a.lastValue;return e%a.frameStep==0&&(t=a.getValueFn()),a.inertiaEnabled&&(e=t-a.lastValue,a.m1=.8*a.m1+e*(1-.8),a.m2=.8*a.m2+a.m1*(1-.8),a.inertia=Math.round(5e3*a.m2)/15e3),a.lastValue=t,[a.lastValue,a.inertia]})),this.name=e,this.getValueFn=t,Object.keys(n).forEach((function(e){a[e]=n[e]})),this.lastValue=this.getValueFn()}function h(e,t,d,m){var g=this,b=4<arguments.length&&void 0!==arguments[4]?arguments[4]:0,v=5<arguments.length&&void 0!==arguments[5]?arguments[5]:{};i(this,h),o(this,"domElement",void 0),o(this,"transformsData",void 0),o(this,"styles",{}),o(this,"selector",""),o(this,"groupIndex",0),o(this,"laxInstance",void 0),o(this,"onUpdate",void 0),o(this,"update",(function(e,t){var a,r=g.transforms,i={};for(a in r){var o=r[a];e[a]||console.error("No lax driver with name: ",a);var c,d=n(e[a],2),m=d[0],p=d[1];for(c in o){var f,h=(I=n(o[c],3))[0],b=I[1],v=(_=void 0===(S=I[2])?{}:S).modValue,E=void 0===(O=_.frameStep)?1:O,y=_.easing,I=_.inertia,S=_.inertiaMode,O=_.cssFn,_=void 0===(_=_.cssUnit)?"":_;y=u[y];t%E==0&&(y=function(e,t,a,n){var r=0;if(e.forEach((function(e){e<a&&r++})),r<=0)return t[0];if(r>=e.length)return t[e.length-1];var i,o=(o=e[i=r-1],e=e[r],(a-o)/(e-o));return n&&(o=n(o)),(i=t[i])*(1-(o=o))+(t=t[r])*o}(h,b,v?m%v:m,y),I&&(f=p*I,"absolute"===S&&(f=Math.abs(f)),y+=f),f="px"==(_||l.includes(c)?"px":s.includes(c)?"deg":"")?0:3,f=y.toFixed(f),i[c]=O?O(f,g.domElement):f+_)}}g.applyStyles(i),g.onUpdate&&g.onUpdate(e,g.domElement)})),o(this,"calculateTransforms",(function(){g.transforms={};var e,t=g.laxInstance.windowWidth;for(e in g.transformsData)!function(e){var a=g.transformsData[e],r={},i=a.presets;for(var o in(void 0===i?[]:i).forEach((function(e){var t,r,i=(r=n(e.split("-"),3))[0],o=r[1];e=r[2];(r=window.lax.presets[i])?(t=r(o,e),Object.keys(t).forEach((function(e){a[e]=t[e]}))):console.error("Lax preset cannot be found with name: ",i)})),delete a.presets,a)!function(e){var i=void 0===(o=(c=n(a[e],3))[0])?[-1e9,1e9]:o,o=void 0===(o=c[1])?[-1e9,1e9]:o,c=void 0===(c=c[2])?{}:c,l=g.domElement.getBoundingClientRect();i=p(i,t).map((function(e){return f(e,l,g.groupIndex)})),o=p(o,t).map((function(e){return f(e,l,g.groupIndex)}));r[e]=[i,o,c]}(o);g.transforms[e]=r}(e)})),o(this,"applyStyles",(function(e){var t,n,i,o=(t=e,n={transform:"",filter:""},i={translateX:1e-5,translateY:1e-5,translateZ:1e-5},Object.keys(t).forEach((function(e){var o=t[e],u=l.includes(e)?"px":s.includes(e)?"deg":"";c.includes(e)?i[e]=o:a.includes(e)?n.transform+="".concat(e,"(").concat(o).concat(u,") "):r.includes(e)?n.filter+="".concat(e,"(").concat(o).concat(u,") "):n[e]="".concat(o).concat(u," ")})),n.transform="translate3d(".concat(i.translateX,"px, ").concat(i.translateY,"px, ").concat(i.translateZ,"px) ").concat(n.transform),n);Object.keys(o).forEach((function(e){g.domElement.style.setProperty(e,o[e])}))})),this.selector=e,this.laxInstance=t,this.domElement=d,this.transformsData=m,this.groupIndex=b;var E=void 0===(b=v.style)?{}:b;v=v.onUpdate;Object.keys(E).forEach((function(e){d.style.setProperty(e,E[e])})),v&&(this.onUpdate=v),this.calculateTransforms()}void 0!==e.exports?e.exports=m:window.lax=m}()},2969:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,r=a(2970),i=(n=r)&&n.__esModule?n:{default:n},o=function(e){return"object"==typeof e},c=function(e){return e.replace(/[_.-](\w|$)/g,(function(e,t){return t.toUpperCase()}))};t.default=function e(t){var a=null==t?t:(0,i.default)(t,(function(t,a){var n=[];return Array.isArray(a)?(a.forEach((function(t){o(t)&&!Array.isArray(t)?n.push(e(t)):n.push(t)})),[c(t),n]):a?a instanceof Date?[c(t),a]:o(a)?[c(t),e(a)]:[c(t),a]:[c(t),a]}));return Array.isArray(t)?function(e){return Object.keys(e).map((function(t){return e[t]}))}(a):a},e.exports=t.default},2970:function(e,t,a){"use strict";e.exports=function(e,t){for(var a={},n=Object.keys(e),r=0;r<n.length;r++){var i=n[r],o=t(i,e[i],e);a[o[0]]=o[1]}return a}},2971:function(e,t,a){"use strict";var n=a(1);Object.defineProperty(t,"__esModule",{value:!0}),t.SelectionCard=u,t.default=void 0;var r=n(a(21)),i=n(a(4)),o=n(a(0)),c=n(a(6)),l=n(a(2904)),s=n(a(2455));function u(e){var t=e.label,a=e.name,n=e.selected,i=e.value,u=(0,c.default)("selection-card__content",{"selection-card__content--selected":n});return o.default.createElement(l.default,(0,r.default)({},e,{className:"cp-selection-card",handleClick:function(){e.handleClick&&e.handleClick(i)},role:"radio",active:n,contentClassName:u}),o.default.createElement(s.default,{id:i,label:t,name:a,checked:n}))}a(2974),u.defaultProps={selected:!1},u.propTypes={label:i.default.oneOfType([i.default.arrayOf(i.default.node),i.default.node,i.default.string]),name:i.default.string,selected:i.default.bool,handleClick:i.default.func,value:i.default.oneOfType([i.default.number,i.default.string])};var d=u;t.default=d},2972:function(e,t,a){"use strict";var n=a(1);Object.defineProperty(t,"__esModule",{value:!0}),t.default=p;var r=n(a(21)),i=n(a(16)),o=n(a(4)),c=n(a(0)),l=n(a(6)),s=a(118),u=a(3),d=a(165);a(2973);var m=["className","contentClassName","children","active","renderSecondaryInfo","dataKey","handleClick","role"];function p(e){var t=e.className,a=e.contentClassName,n=e.children,o=e.active,u=e.renderSecondaryInfo,p=e.dataKey,f=e.handleClick,g=e.role,h=(0,i.default)(e,m),b=(0,l.default)("capsule__content",a,{"capsule__content--active":o}),v=h.href?c.default.createElement(s.Link,(0,r.default)({className:b,dataKey:"capsule-link"},h),n):c.default.createElement("div",(0,r.default)({},(0,d.getValidHtmlAttributes)(h,"div"),{className:b}),n);return c.default.createElement("div",{"data-key":p,className:(0,l.default)("cp-capsule",t),onClick:f,onKeyPress:f,role:g},v,u&&c.default.createElement("div",{className:"secondary-info"},u()))}p.propTypes={className:o.default.string,children:u.childrenShape.isRequired,contentClassName:o.default.string,dataKey:o.default.string,href:o.default.string,renderSecondaryInfo:o.default.func,handleClick:o.default.func,role:o.default.string,active:o.default.bool}},2973:function(e,t,a){"use strict";a.r(t)},2974:function(e,t,a){"use strict";a.r(t)},2975:function(e,t,a){"use strict";var n=a(1);Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return r.default}});var r=n(a(2976))},2976:function(e,t,a){"use strict";var n=a(1);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(a(24)),i=n(a(25)),o=n(a(27)),c=n(a(28)),l=n(a(29)),s=n(a(4)),u=n(a(0)),d=n(a(6)),m=n(a(22)),p=n(a(38)),f=a(82),g=a(393),h=a(88);function b(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=(0,l.default)(e);if(t){var r=(0,l.default)(this).constructor;a=Reflect.construct(n,arguments,r)}else a=n.apply(this,arguments);return(0,c.default)(this,a)}}a(2977);var v=function(e){(0,o.default)(a,e);var t=b(a);function a(){return(0,r.default)(this,a),t.apply(this,arguments)}return(0,i.default)(a,[{key:"renderPrimaryButton",value:function(){var e=this.props,t=e.disabled,a=e.isLoading,n=e.rounded,r=e.buttonTag,i=e.handleClick,o=this.props.options.first(),c=r||h.Button,l=(0,d.default)("combo-button__primary-button",{"combo-button__primary-button--default":!r,"combo-button__primary-button--rounded":n});return u.default.createElement(c,{disabled:t||o.get("disabled"),className:l,isLoading:a,handleClick:function(){return i(o.get("value"))},dataKey:"combo-button-primary-button"},o.get("label"))}},{key:"renderSecondaryButton",value:function(){var e=this.props,t=e.disabled,a=e.rounded,n=e.right,r=e.isLoading,i=e.buttonTag,o=e.renderDropdownLabel,c=e.handleClick,l=this.props.options.slice(1),s=i||h.Button,m=(0,d.default)("combo-button__secondary-button",{"combo-button__secondary-button--default":!i,"combo-button__secondary-button--rounded":a});return u.default.createElement(g.Dropdown,{dataKey:"combo-button-dropdown",right:n,options:l,handleSelect:c,renderTrigger:function(e,a){return u.default.createElement(s,{disabled:t,className:m,handleClick:r?void 0:e,dataKey:"combo-button-secondary-button","aria-expanded":a,"aria-haspopup":!0},u.default.createElement(p.default,null,o()),u.default.createElement(f.ChevronDown,{className:"combo-button__secondary-button__chevron"}))}})}},{key:"render",value:function(){var e=this.props,t=e.block,a=e.dataKey,n=(0,d.default)("cp-combo-button",{"combo-button--block":t});return u.default.createElement("div",{className:n,"data-key":a},this.renderPrimaryButton(),this.renderSecondaryButton())}}]),a}(u.default.PureComponent);t.default=v,v.propTypes={buttonTag:s.default.elementType,dataKey:s.default.string,block:s.default.bool,rounded:s.default.bool,disabled:s.default.bool,isLoading:s.default.bool,right:s.default.bool,options:m.default.listOf(m.default.mapContains({label:s.default.oneOfType([s.default.arrayOf(s.default.node),s.default.node,s.default.string]),value:s.default.oneOfType([s.default.string,s.default.number]),disabled:s.default.bool})).isRequired,handleClick:s.default.func.isRequired,renderDropdownLabel:s.default.func.isRequired},v.defaultProps={right:!0}},2977:function(e,t,a){"use strict";a.r(t)},892:function(e,t,a){"use strict";a.r(t),a.d(t,"BibPageContainer",(function(){return Rs}));var n=a(21),r=a.n(n),i=a(13),o=a.n(i),c=a(0),l=a.n(c),s=a(245),u=a.n(s),d=a(5),m=a(20),p=a(45),f=a(64),g=a(40),h=a(67),b=a.n(h),v=a(181),E=a(244),y=a(8),I=a.n(y),S=a(2),O=a.n(S),_=a(9),C=a(70),k=a(52);function A(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}var N="Book",T="Audiobook",M="MusicAlbum",j="Movie",F="CreativeWork",L={AUDIOBOOK:"http://schema.org/AudiobookFormat",EBOOK:"http://schema.org/EBook",PAPERBACK:"http://schema.org/Paperback",BK:"http://schema.org/Hardcover"};function w(e){var t=e.getIn(["briefInfo","superFormats"]);return t.includes("BOOKS")?N:t.includes("MUSIC_SOUND")?M:t.includes("MOVIES_TV_VIDEO")?j:t.includes("AUDIOBOOKS_SPOKEN_WORD")?T:F}function B(e){switch(e.get("statusType")){case"AVAILABLE":case"ON_ORDER":return"http://schema.org/InStock";default:return"http://schema.org/OutOfStock"}}function R(e){var t=e.get("linkedDataGeoLocation");if(t&&t.get("address"))return O.a.fromJS({"@type":"Place",address:t.get("address"),hasMap:t.get("hasMap"),geo:{"@type":"GeoCoordinates",latitude:t.get("latitude"),longitude:t.get("longitude")}})}function D(e,t,a){return O.a.Map({"@type":"Offer",availability:B(e.get("availability",O.a.Map())),availableAtOrFrom:R(t),sku:e.getIn(["briefInfo","callNumber"]),seller:a,price:"0.00"})}var P,x=Object(_.createSelector)([k.b,k.d,C.d,E.b],(function(e,t,a,n){if(!n)return O.a.Map();var r=a.get(n.get("metadataId")),i=r.get("briefInfo",O.a.Map()),o=n.get("brief",O.a.Map()),c=o.get("otherScriptTitle")||o.get("title"),l=o.get("description"),s=o.get("creators",O.a.List()),u=i.get("rating",O.a.Map()),d=O.a.Map(function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?A(Object(a),!0).forEach((function(t){I()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):A(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({"@context":"http://schema.org","@type":w(r),name:c,about:i.get("subjectHeadings"),aggregateRating:u.get("totalCount")?{"@type":"AggregateRating",bestRating:10,worstRating:1,ratingCount:u.get("totalCount"),ratingValue:u.get("averageRating")/10}:void 0,author:s.size>0?s.map((function(e){return{"@type":"Person",name:e.get("fullName")}})):void 0,datePublished:o.get("publicationDate"),description:l?[l]:void 0,image:o.getIn(["coverImage","large"])},function(e,t){switch(w(e)){case j:case M:return{copyrightYear:t.getIn(["brief","publicationDate"])};case N:case T:return{isbn:e.getIn(["briefInfo","isbns"]),bookEdition:e.getIn(["briefInfo","edition"]),bookFormat:{"@id":L[e.getIn(["briefInfo","format"])]||L.BK,"@type":"BookFormatType"}};default:return{}}}(r,n))),m=O.a.Map({"@context":"http://schema.org","@type":"Product",name:c,gtin13:i.get("isbns"),offers:D(r,e,t)});return O.a.Map({"@graph":O.a.List([d,m])})})),U=Object(_.createSelector)([function(e){return e.getIn(["catalogBibs","manifestations","ids"],O.a.List())},C.d],(function(e,t){return e.map((function(e){return t.get(e)}))})),K=Object(_.createSelector)([function(e){return e.getIn(["catalogBibs","manifestations"],O.a.Map())}],(function(e){return e})),H=Object(_.createSelector)([function(e){return e.getIn(["catalogBibs","catalogBib","editions"],O.a.List())},C.d],(function(e,t){return e.map((function(e){return t.get(e)}))})),z=Object(_.createSelector)([function(e){return e.getIn(["bibs","evaluation","authorNote","id"])||""},C.a],(function(e,t){return t.getIn([e.toString(),"notes"],"")})),q=Object(_.createSelector)([C.J,function(e){return e.getIn(["bibs","evaluation","reviews"],O.a.Map())}],(function(e,t){return O.a.Map({totalReviews:t.get("totalReviews",0),items:t.get("items",O.a.List()).map((function(t){return e.get(t.toString())}))})})),V=Object(_.createSelector)([function(e){return e.getIn(["bibs","evaluation","mediaSummary","id"])||""},C.C],(function(e,t){return t.getIn([e.toString(),"contents"])})),G=Object(_.createSelector)([function(e){return e.getIn(["bibs","evaluation","relatedAuthors","items"],O.a.List())},C.I],(function(e,t){return e.map((function(e){return t.get(e.toString())}))})),W=Object(_.createSelector)([function(e){return e.getIn(["bibs","evaluation","excerpt","id"])||""},C.p],(function(e,t){return t.getIn([e.toString(),"excerpt"])})),Y=Object(_.createSelector)([function(e){return e.getIn(["bibs","evaluation","externalResources","items"],O.a.List())},C.D],(function(e,t){return e.map((function(e){return t.get(e.toString())}))})),Q=Object(_.createSelector)([C.d,E.b,K,C.c,q,z],(function(e,t,a,n,r,i){if(!t)return O.a.Map();var o=t.get("metadataId"),c=e.get(o);return O.a.Map({metadataId:o,format:c.getIn(["briefInfo","format"]),language:t.getIn(["brief","primaryLanguage"]),description:!!t.getIn(["brief","description"]),rating:c.getIn(["briefInfo","rating","averageRating"],0),groupKey:a.get("groupKey"),manifestationCount:a.get("editionsCount"),availabilityStatus:n.getIn([o,"status"],""),provider:c.getIn(["policy","provider"],""),content:c.getIn(["briefInfo","contentType"],""),audience:c.getIn(["briefInfo","audiences",0],""),reviews:r.get("items").size>0,authorNotes:i.length>0})})),Z=Object(_.createSelector)([function(e){return e.getIn(["bibs","ugc","summary"],O.a.Map())}],(function(e){return e})),X=function(e){return function(t){return t.getIn(["bibs","ugc",e,"results"],O.a.List())}},J=function(e){return Object(_.createSelector)([X(e),C.h],(function(e,t){return e.map((function(e){return t.get(e.toString())}))}))},$=J("communityComments"),ee=J("staffComments"),te=Object(_.createSelector)([function(e){return e.getIn(["bibs","ugc","tags","summaries"],O.a.List())}],(function(e){return e})),ae=Object(_.createSelector)([(P="tags",function(e){return e.getIn(["bibs","ugc",P,"pagination"],O.a.Map())})],(function(e){return e})),ne=Object(_.createSelector)([X("quotations"),C.H],(function(e,t){return e.map((function(e){return t.get(e.toString())}))})),re=Object(_.createSelector)([X("summaries"),C.N],(function(e,t){return e.map((function(e){return t.get(e.toString())}))})),ie=Object(_.createSelector)([X("videos"),C.P],(function(e,t){return e.map((function(e){return t.get(e.toString())}))})),oe=a(2758);function ce(e){return Object(_.createSelector)([e,C.K],(function(e,t){var a=e.get("entries",O.a.List()).map((function(e){return t.get(e,O.a.Map())}));return e.delete("entries").set("seriesEntries",a)}))}var le,se,ue=ce((function(e){return e.getIn(["bibs","seriesInfo"])||O.a.List()})),de=function(e){return function(t){return t.getIn(["bibs","discovery",e,"items"],O.a.List())}},me=Object(_.createSelector)([de("recommendations")],(function(e){return e})),pe=Object(_.createSelector)([de("relatedTitles"),C.g],(function(e,t){return e.map((function(e){return t.get(e)}))})),fe=Object(_.createSelector)([de("authorSuggestions"),C.b],(function(e,t){return e.map((function(e){return t.get(e.toString())}))})),ge=ce((function(e){return e.getIn(["bibs","discovery","seriesInfo"])||O.a.Map()})),he=Object(_.createSelector)([de("staffLists"),C.x],(function(e,t){return e.map((function(e){return t.get(e.toString())}))})),be=Object(_.createSelector)([de("communityLists"),C.x],(function(e,t){return e.map((function(e){return t.get(e.toString())}))})),ve=Object(_.createSelector)([(le="communityLists",function(e){return e.getIn(["bibs","discovery",le,"pagination"],O.a.Map())})],(function(e){return e})),Ee=Object(_.createSelector)([de("otherLanguageTitles"),C.g],(function(e,t){return e.map((function(e){return t.get(e.toString())}))})),ye=a(296),Ie=a(143),Se=a.n(Ie),Oe=Se()(g.CONTEXTS),_e=function(e){function t(t){var a;a=e.call(this,t)||this;var n=t.context,r=t.contextName,i=t.analyticsActions;if(!Oe.includes(r))throw new Error(r+" is not a supported analytics context.");return i.setContext(r,n),a}o()(t,e);var a=t.prototype;return a.componentDidUpdate=function(){var e=this.props,t=e.context,a=e.contextName;e.analyticsActions.setContext(a,t)},a.componentWillUnmount=function(){var e=this.props,t=e.contextName;e.analyticsActions.setContext(t,void 0)},a.render=function(){return null},t}(l.a.PureComponent),Ce=a(12),ke=a.n(Ce);var Ae={fetchDataLayer:function(e){var t=e.route(se||(se=ke()(["/libraries/","/analytics/dataLayer"])),":librarySubdomain");return e.get(t)}},Ne=a(502);var Te={fetchDataLayer:function(){return{types:[Ne.a.FETCH_DATALAYER_REQUEST,Ne.a.FETCH_DATALAYER_SUCCESS,Ne.a.FETCH_DATALAYER_FAILURE],apiRequest:function(e,t){return Ae.fetchDataLayer(t)}}},setContext:function(e,t){return{type:Ne.a.SET_CONTEXT,contextName:e,context:t}}},Me=function(e){function t(){return e.apply(this,arguments)||this}return o()(t,e),t.prototype.render=function(){return l.a.createElement(_e,this.props)},t}(l.a.PureComponent),je=Object(m.connect)(null,(function(e){return{analyticsActions:Object(p.bindActionCreators)(Te,e)}}))(Me),Fe=a(522),Le=a(2340),we=a.n(Le),Be=a(2472),Re=a.n(Be),De=a(214),Pe=a(88),xe=a(82),Ue=a(2371);function Ke(){return Object(c.useContext)(b.a).mobileApp?null:l.a.createElement("div",{className:"cp-header-bar"},l.a.createElement(Ue.a,null),l.a.createElement(Re.a,null,(function(e){return e.get(De.TOGGLZ_FEATURES.NERF_BIB_PAGE_DEVELOPMENT)?l.a.createElement("div",{className:"print-share-buttons"},l.a.createElement(Pe.IconButton,{className:"print-button",dataKey:"print-button"},l.a.createElement(xe.Print,null)),l.a.createElement(Pe.IconButton,{className:"share-button",dataKey:"share-button"},l.a.createElement(xe.Share,null))):null})))}var He=a(163),ze=a.n(He),qe=a(118),Ve=a(106),Ge=a(126),We=a(38),Ye=a.n(We),Qe=a(2389),Ze=a(6),Xe=a.n(Ze);function Je(e){var t=e.className,a=e.field;return l.a.createElement("div",{className:Xe()("cp-bib-field-label",t)},l.a.createElement(d.FormattedMessage,{id:"bib_metadata_field_"+a.get("fieldName","").toLowerCase()}))}var $e=a(889),et=a.n($e),tt=a(537),at=a.n(tt);function nt(e){var t=e.fieldValue.get("contentLabel");return t?l.a.createElement("div",{className:"cp-bib-content-label"},t):null}function rt(e,t){return"/v2/search?searchType="+e+"&query="+encodeURIComponent(t)}function it(e,t){return l.a.createElement("span",{className:"formatted-value",key:t},e)}var ot=function(e){function t(){return e.apply(this,arguments)||this}o()(t,e);var a=t.prototype;return a.renderContent=function(e,t,a){if(e&&e.size){var n=this.props,r=n.part,i=n.compact,o=n.handleClick,c=r.get("searchType"),s=i?e.join(", "):e.map(it);return c&&t?l.a.createElement(qe.SecondaryLink,{className:a,href:rt(c,t),dataKey:"value-part-link",handleClick:o},s):l.a.createElement("span",{className:a},s)}return null},a.render=function(){var e=this.props,t=e.part,a=e.className;if(!t)return null;var n=this.renderContent(t.get("values"),t.get("searchQuery"),"main-content"),r=this.renderContent(t.get("otherScript"),t.get("otherScriptSearchQuery"),"other-script-content");if(!n&&!r)return null;var i=n&&r&&l.a.createElement("span",{className:"separator"},""),o=Xe()("cp-value-part",a,{"with-separator":!!i});return l.a.createElement("div",{className:o},r,i,n)},t}(l.a.PureComponent),ct=function(e){function t(){return e.apply(this,arguments)||this}o()(t,e);var a=t.prototype;return a.renderContributorRelationship=function(){var e=(this.props.value.get("relationship")||O.a.Map()).get("values",O.a.List()).map(et.a).join(", ");return e&&l.a.createElement("div",{className:"part-contributor-relationship"},e)},a.renderURL=function(){var e=this.props.value.get("sourceURI");if(e){var t=new at.a(e).hostname.replace(/^www\./,"");return l.a.createElement("div",{className:"part-source"},l.a.createElement(qe.Link,{href:e,dataKey:"source-url-link"},l.a.createElement(d.FormattedMessage,{id:"view_on_source",values:{source:t}})))}return null},a.render=function(){return l.a.createElement("div",{className:"cp-bib-field-value"},l.a.createElement(nt,{fieldValue:this.props.value}),l.a.createElement("div",{className:"main-content"},l.a.createElement(ot,{className:"part-primary",compact:this.props.compact,part:this.props.value.get("primary"),handleClick:this.props.handleClick}),l.a.createElement(ot,{className:"part-secondary",compact:this.props.compact,part:this.props.value.get("secondary"),handleClick:this.props.handleClick})),l.a.createElement("div",{className:"other-content"},l.a.createElement(ot,{className:"part-contributor",compact:this.props.compact,part:this.props.value.get("contributor"),handleClick:this.props.handleClick}),this.renderContributorRelationship(),this.renderURL()))},t}(l.a.PureComponent);function lt(e){var t=e.field,a=e.compact,n=e.handleClick,r=!!t.getIn(["fieldValues",0,"contentLabel"]);return l.a.createElement("div",{className:"cp-bib-field"},l.a.createElement(Je,{className:Xe()({"with-content-label":r}),field:t}),l.a.createElement("ul",{className:"values-list"},t.get("fieldValues").map((function(e,t){return l.a.createElement("li",{className:"bib-field-value",key:t},l.a.createElement(ct,{value:e,compact:a,handleClick:n}))}))))}function st(e){var t=e.className,a=e.fields,n=e.compact,r=e.handleClick,i=Xe()("cp-metadata-display",t,{"metadata-display--compact":n});return l.a.createElement("div",{className:i},a.map((function(e){return l.a.createElement(lt,{key:e.get("fieldName"),field:e,compact:n,handleClick:function(){return r(e)}})})))}var ut=a(2372),dt=a(508),mt=Ge.bibMetadataEventComposer.composeMetadataLinkClickEvent,pt=Ge.bibMetadataEventComposer.composeMARCLinkClickEvent,ft=g.CUSTOM_DIMENSIONS;function gt(){Object(Ve.sendAnalyticsEvents)(pt())}var ht=function(e){function t(){return e.apply(this,arguments)||this}o()(t,e);var a=t.prototype;return a.categoriesInOrder=function(){var e=this.props.catalogBib.get("fields"),t=["DETAILS","AUDIENCE","SERIES","CONTRIBUTORS","CONTAINS","SUBJECTGENRE","RELATED","NOTES","CALLCLASS","IDENTIFIERS"];return e.sortBy((function(e){return t.indexOf(e.get("category"))}))},a.renderContent=function(){return this.categoriesInOrder().map((function(e){var t,a="bib_metadata_category_"+e.get("category").toLowerCase();return"ABOUT"===e.get("category")?null:l.a.createElement("div",{key:e.get("category")},l.a.createElement(we.a,null),l.a.createElement("div",{className:"field-detail"},l.a.createElement(ze.a,{tagName:"h3",size:"medium",variant:!0,className:"field-detail-label"},l.a.createElement(d.FormattedMessage,{id:a})),l.a.createElement(st,{fields:e.get("items"),handleClick:(t=e.get("category"),function(e){Object(Ve.sendAnalyticsEvents)(mt({fieldName:e.get("fieldName"),category:t,gtmContainerName:ft.CONTAINER_NAMES.BIB_ABOUT_OVERLAY}))})})))}))},a.renderLinkToMarcPage=function(){return l.a.createElement(qe.ChevronLink,{href:"/v2/record/"+this.props.catalogBib.get("metadataId")+"/originalrecord",dataKey:"original-record-link",handleClick:gt},l.a.createElement(d.FormattedMessage,{id:"original_record"}))},a.render=function(){var e=this.props.catalogBib.get("metadataId");return l.a.createElement(ut.FullScreenOverlayBody,{className:"cp-full-details"},l.a.createElement(ut.FullScreenOverlayHeader,{title:l.a.createElement(d.FormattedMessage,{id:"full_details"})}),l.a.createElement(ut.FullScreenOverlayContent,{size:"medium"},l.a.createElement("div",{className:"full-details-brief"},l.a.createElement(dt.b,{metadataId:e})),this.renderContent(),l.a.createElement(we.a,null),this.renderLinkToMarcPage()))},t}(l.a.PureComponent),bt=function(e){function t(){return e.apply(this,arguments)||this}return o()(t,e),t.prototype.render=function(){return l.a.createElement(ht,this.props)},t}(l.a.PureComponent),vt=Object(m.connect)((function(e){return{catalogBib:Object(E.b)(e)}}))(bt),Et=Ge.bibMetadataEventComposer.composeFullDetailsEvent,yt=Ge.bibMetadataEventComposer.composeMetadataLinkClickEvent,It=Ge.bibMetadataEventComposer.composeMARCLinkClickEvent,St=g.CUSTOM_DIMENSIONS;function Ot(){Object(Ve.sendAnalyticsEvents)(Et())}var _t=function(e){return function(t){Object(Ve.sendAnalyticsEvents)(yt({fieldName:t.get("fieldName"),category:e.get("category"),gtmContainerName:St.CONTAINER_NAMES.BIB_ABOUT}))}};function Ct(){Object(Ve.sendAnalyticsEvents)(It())}var kt=function(e){function t(){for(var t,a=arguments.length,n=new Array(a),r=0;r<a;r++)n[r]=arguments[r];return(t=e.call.apply(e,[this].concat(n))||this).state={open:!1},t.handleOpen=function(){t.setState({open:!0}),Ot()},t.handleClose=function(){t.setState({open:!1})},t.renderFullDetailsLink=function(){return l.a.createElement("div",{className:"cp-full-details-link"},l.a.createElement(qe.ChevronLink,{href:"#full-details-overlay",dataKey:"full-details-link",handleClick:t.handleOpen,preventDefault:!0},l.a.createElement("span",{"aria-hidden":!0},l.a.createElement(d.FormattedMessage,{id:"full_details"})),l.a.createElement(Ye.a,null,l.a.createElement(d.FormattedMessage,{id:"full_details_open"}))),l.a.createElement(Qe.a,{open:t.state.open,handleClose:t.handleClose,overlayKey:"bib-details-full-screen-overlay",dataKey:"bib-details-full-screen-overlay"},t.state.open&&l.a.createElement(vt,null)))},t}o()(t,e);var a=t.prototype;return a.renderLinkToMarcPage=function(){return this.props.currentUser&&this.props.currentUser.get("staff")?l.a.createElement(qe.ChevronLink,{href:"/v2/record/"+this.props.catalogBib.get("metadataId")+"/originalrecord",className:"original-record-link",dataKey:"original-record-link",handleClick:Ct},l.a.createElement(d.FormattedMessage,{id:"original_record"})):null},a.render=function(){var e=this.props.fields;return l.a.createElement("div",{className:"cp-bib-details"},l.a.createElement(ze.a,{tagName:"h3",size:"medium",variant:!0},l.a.createElement(d.FormattedMessage,{id:"bib_metadata_category_about"})),e&&l.a.createElement(st,{fields:e.get("items"),compact:!0,handleClick:_t(e)}),this.renderFullDetailsLink(),this.renderLinkToMarcPage())},t}(l.a.PureComponent),At=a(33),Nt=function(e){function t(){return e.apply(this,arguments)||this}return o()(t,e),t.prototype.render=function(){return l.a.createElement(kt,this.props)},t}(l.a.PureComponent),Tt=Object(m.connect)((function(e){var t=Object(E.b)(e);return{fields:t.get("fields").find((function(e){return"ABOUT"===e.get("category")})),currentUser:Object(At.c)(e),catalogBib:t}}))(Nt),Mt=a(297),jt=Ge.bibMetadataEventComposer.composeReadMoreEvent,Ft=g.CUSTOM_DIMENSIONS;function Lt(e){Object(Ve.sendAnalyticsEvents)(jt({expanded:e,gtmContainerName:Ft.CONTAINER_NAMES.BIB_ABOUT_ABOUT_AUTHOR}))}var wt=function(e){function t(){return e.apply(this,arguments)||this}return o()(t,e),t.prototype.render=function(){var e=this.props.authorNote;return e?l.a.createElement("div",{className:"cp-about-the-author"},l.a.createElement(ze.a,{tagName:"h3",size:"medium",variant:!0},l.a.createElement(d.FormattedMessage,{id:"about_the_author"})),l.a.createElement(Mt.ExpandableHtml,{htmlText:e,expandLinkHref:"#author-description-read-more",dataKey:"author-description-read-more-link",textKey:"about_the_author",handleToggle:Lt})):null},t}(l.a.PureComponent),Bt=function(e){function t(){return e.apply(this,arguments)||this}return o()(t,e),t.prototype.render=function(){return l.a.createElement(wt,this.props)},t}(l.a.PureComponent),Rt=Object(m.connect)((function(e){return{authorNote:z(e)}}))(Bt),Dt=a(26),Pt=a.n(Dt),xt=a(32),Ut=a(551);function Kt(e){var t=e.className,a=e.metadataId,n=e.children,r=e.handleClick,i=e.isDecorative,o={className:Xe()("cp-bib-link",t),href:"/v2/record/"+a,dataKey:"bib-link",handleClick:r};return i&&(o["aria-hidden"]=!0,o.tabIndex="-1"),l.a.createElement(qe.Link,o,n)}var Ht=Ge.seriesCardEventComposer.composeImageClickEvent,zt=Ge.seriesCardEventComposer.composeTitleClickEvent;function qt(e,t){var a=t.getIn(["coverImage","providerURI"]),n=t.get("metadataId");Object(Ve.sendAnalyticsEvents)(e({providerURI:a,metadataId:n}))}function Vt(e){var t=e.bib,a=e.number,n=e.isCurrentItem,r=t.get("coverImage"),i=t.get("metadataId"),o=t.get("title"),c=t.get("volumeLabel");return l.a.createElement("div",{className:"cp-bib-card"},l.a.createElement("div",{className:"bib-card-contents"},l.a.createElement("div",{className:"number"},a&&!c&&l.a.createElement(l.a.Fragment,null,l.a.createElement("span",{"aria-hidden":"true"},a),l.a.createElement(Ye.a,null,l.a.createElement(d.FormattedMessage,{id:"seriesTitleNumber",values:{number:a}})))),l.a.createElement("div",{className:"bib-wrapper"},l.a.createElement(Kt,{metadataId:i,handleClick:function(){return qt(Ht,t)},isDecorative:!0},l.a.createElement(Ut.a,{placeholder:a,title:o,cover:r,metadataId:i})),l.a.createElement(Kt,{className:"title-link",metadataId:i,handleClick:function(){return qt(zt,t)}},l.a.createElement("div",{className:"bib-title"},o)),n&&l.a.createElement("div",{className:"current-item-indicator"},l.a.createElement(d.FormattedMessage,{id:"this_item"})),c&&l.a.createElement(l.a.Fragment,null,"(",c,")"))))}var Gt,Wt=function(e){function t(){return e.apply(this,arguments)||this}o()(t,e);var a=t.prototype;return a.renderItem=function(e){var t=e.get("metadataId"),a=this.props.catalogBib,n=a&&t===a.get("metadataId");return l.a.createElement(Vt,{bib:e,number:e.get("volume"),key:t,isCurrentItem:n})},a.render=function(){var e=this,t=this.props.bibs;return t&&t.size?l.a.createElement("div",{className:"cp-bib-card-row"},t.map((function(t){return e.renderItem(t)}))):null},t}(l.a.PureComponent),Yt=a(2357),Qt=function(e){function t(){return e.apply(this,arguments)||this}o()(t,e);var a=t.prototype;return a.componentDidMount=function(){this.props.seriesInfoActions.fetchSeriesInfo(this.props.catalogBib.get("metadataId"))},a.render=function(){var e=this.props,t=e.series,a=e.catalogBib,n=e.isFetching,r=t.get("seriesEntries",O.a.List());return l.a.createElement(ut.FullScreenOverlayBody,{className:"cp-same-series-overlay"},l.a.createElement(ut.FullScreenOverlayHeader,{title:l.a.createElement(d.FormattedMessage,{id:"in_the_same_series"})}),l.a.createElement(ut.FullScreenOverlayContent,{size:"small"},n?l.a.createElement(Yt.TableStencil,null):l.a.createElement(l.a.Fragment,null,l.a.createElement(ze.a,{tagName:"h3",size:"moderate",variant:!0,className:"same-series-heading"},t.get("seriesTitle")),l.a.createElement(Wt,{bibs:r,catalogBib:a}))))},t}(l.a.PureComponent);var Zt={fetchSeriesInfo:function(e,t){var a=t.route(Gt||(Gt=ke()(["/libraries/","/bibs/","/seriesinfo"])),":librarySubdomain",e);return t.get(a)}},Xt=a(378);var Jt={fetchSeriesInfo:function(e){return{types:[Xt.a.FETCH_SAME_SERIES_REQUEST,Xt.a.FETCH_SAME_SERIES_SUCCESS,Xt.a.FETCH_SAME_SERIES_FAILURE],apiRequest:function(t,a){return Zt.fetchSeriesInfo(e,a)}}}},$t=function(e){function t(){return e.apply(this,arguments)||this}return o()(t,e),t.prototype.render=function(){return l.a.createElement(Qt,this.props)},t}(l.a.PureComponent),ea=Object(m.connect)((function(e){return{isFetching:e.getIn(["bibs","seriesInfo","isFetching"],!1),series:ue(e),catalogBib:Object(E.b)(e)}}),(function(e){return{seriesInfoActions:Object(p.bindActionCreators)(Jt,e)}}))($t);function ta(e){var t=e.name;return l.a.createElement("div",{className:"cp-vendor-attribution-label"},l.a.createElement("span",{"aria-hidden":!0},t),l.a.createElement(Ye.a,null,l.a.createElement(d.FormattedMessage,{id:"sr_vendor_attribution_label",values:{name:t}})))}var aa=function(e){function t(t){var a;return(a=e.call(this,t)||this).state={overlayOpen:!1},Object(xt.bindAll)(Pt()(a)),a}o()(t,e);var a=t.prototype;return a.openOverlay=function(){this.setState({overlayOpen:!0})},a.closeOverlay=function(){this.setState({overlayOpen:!1})},a.render=function(){var e=this.props,t=e.series,a=e.catalogBib,n=t.get("seriesEntries"),r=t.get("totalSeriesEntries"),i=t.get("seriesTitle");if(!n||!n.size)return null;var o=n.filter((function(e){return e.get("metadataId")!==a.get("metadataId")})).slice(0,3);return l.a.createElement("div",{className:"cp-same-series"},l.a.createElement("div",{className:"same-series-heading"},l.a.createElement(ze.a,{tagName:"h3",size:"medium",variant:!0},l.a.createElement(d.FormattedMessage,{id:"in_the_same_series"}),i&&": "+i),l.a.createElement(ta,{name:"novelist"})),l.a.createElement(Wt,{bibs:o}),r>o.size&&l.a.createElement(qe.ChevronLink,{href:"#same-series-overlay",dataKey:"same-series-view-all-link",preventDefault:!0,handleClick:this.openOverlay},l.a.createElement("span",{"aria-hidden":!0},l.a.createElement(d.FormattedMessage,{id:"view_all"})),l.a.createElement(Ye.a,null,l.a.createElement(d.FormattedMessage,{id:"view_all_in_the_same_series"}))),l.a.createElement(Qe.a,{open:this.state.overlayOpen,handleClose:this.closeOverlay,overlayKey:"same-series-full-screen-overlay",dataKey:"same-series-full-screen-overlay"},this.state.overlayOpen&&l.a.createElement(ea,this.props)))},t}(l.a.PureComponent),na=function(e){function t(){return e.apply(this,arguments)||this}return o()(t,e),t.prototype.render=function(){return l.a.createElement(aa,this.props)},t}(l.a.PureComponent),ra=Object(m.connect)((function(e){return{series:ge(e),catalogBib:Object(E.b)(e)}}))(na),ia=Ge.bibMetadataEventComposer.composeMetadataLinkClickEvent,oa=Ge.bibMetadataEventComposer.composeShowMoreEvent,ca=g.CUSTOM_DIMENSIONS;function la(){Object(Ve.sendAnalyticsEvents)(ia({fieldName:"CONTAINS_WORK",category:"CONTAINS",gtmContainerName:ca.CONTAINER_NAMES.BIB_ABOUT}))}function sa(e){Object(Ve.sendAnalyticsEvents)(oa({expanded:e}))}function ua(e){var t=e.containedWork;if(!t||!t.size)return null;return l.a.createElement("div",{className:"cp-contains"},l.a.createElement(ze.a,{tagName:"h3",size:"medium",variant:!0},l.a.createElement(d.FormattedMessage,{id:"bib_metadata_category_contains"})),l.a.createElement(Mt.ExpandableList,{list:t,getItemKey:function(e){return e.getIn(["primary","values",0])},renderItem:function(e){return l.a.createElement(ct,{value:e,handleClick:la})},collapseCount:3,expandLinkHref:"#show-more-contains",handleToggle:sa,stacked:!0,textKey:"contains"}))}var da=Object(E.a)("CONTAINS","CONTAINS_WORK"),ma=function(e){function t(){return e.apply(this,arguments)||this}return o()(t,e),t.prototype.render=function(){return this.props.containedWork?l.a.createElement(ua,this.props):null},t}(l.a.PureComponent),pa=Object(m.connect)((function(e){var t;return{containedWork:null===(t=da(e))||void 0===t?void 0:t.get("fieldValues")}}))(ma),fa=Ge.bibMetadataEventComposer.composeMetadataLinkClickEvent,ga=Ge.bibMetadataEventComposer.composeShowMoreEvent,ha=g.CUSTOM_DIMENSIONS;function ba(){Object(Ve.sendAnalyticsEvents)(fa({fieldName:"SUBJECT",category:"SUBJECTGENRE",gtmContainerName:ha.CONTAINER_NAMES.BIB_ABOUT}))}function va(e){Object(Ve.sendAnalyticsEvents)(ga({expanded:e}))}function Ea(e){var t=e.subjectsGenres,a=e.bib.getIn(["briefInfo","contentType"]),n=["NONFICTION","GOVERNMENT_DOCUMENTS","ARCHIVAL"].includes(a);if(!t||!t.size||!n)return null;return l.a.createElement("div",{className:"cp-subject-genre"},l.a.createElement(ze.a,{tagName:"h3",size:"medium",variant:!0},l.a.createElement(d.FormattedMessage,{id:"bib_metadata_category_subjectgenre"})),l.a.createElement(Mt.ExpandableList,{list:t,getItemKey:function(e){return e.getIn(["primary","values",0])},renderItem:function(e){return l.a.createElement(ct,{value:e,handleClick:ba})},collapseCount:3,expandLinkHref:"#show-more-subject",handleToggle:va,stacked:!0,textKey:"subject_and_genre"}))}var ya=Object(E.a)("SUBJECTGENRE"),Ia=function(e){function t(){return e.apply(this,arguments)||this}return o()(t,e),t.prototype.render=function(){return this.props.subjectsGenres?l.a.createElement(Ea,this.props):null},t}(l.a.PureComponent),Sa=Object(m.connect)((function(e){var t,a=Object(E.b)(e).get("id");return{subjectsGenres:null===(t=ya(e))||void 0===t?void 0:t.flatMap((function(e){return e.get("fieldValues",O.a.List())})),bib:Object(C.d)(e).get(a)}}))(Ia),Oa=Ge.bibMetadataEventComposer.composeMetadataLinkClickEvent,_a=Ge.bibMetadataEventComposer.composeShowMoreEvent,Ca=g.CUSTOM_DIMENSIONS;function ka(e){Object(Ve.sendAnalyticsEvents)(_a({expanded:e}))}function Aa(e){var t,a=e.contributorNames;return l.a.createElement("div",{className:"cp-catalog-contributors"},(t=a.get("fieldValues"),l.a.createElement(Mt.ExpandableList,{list:t,getItemKey:function(e){return e.getIn(["primary","values",0])},renderItem:function(e){return l.a.createElement(ct,{value:e,handleClick:function(){return function(e){Object(Ve.sendAnalyticsEvents)(Oa({fieldName:e.get("fieldName"),category:"CONTRIBUTORS",gtmContainerName:Ca.CONTAINER_NAMES.BIB_ABOUT}))}(a)}})},collapseCount:3,expandLinkHref:"#show-more-contributors",handleToggle:ka,stacked:!0,textKey:"contributors"})))}var Na=a(311);function Ta(e){return l.a.createElement("div",{className:"contributor-wrapper"},function(e){if(e.get("profilePath")){var t=Na.c+"/"+e.get("profilePath");return l.a.createElement("img",{className:"contributor-image",alt:e.get("name"),src:t,loading:"lazy"})}return l.a.createElement(xe.UserCircle,{className:"contributor-image"})}(e),l.a.createElement("div",{className:"contributor-details"},l.a.createElement("div",{className:"contributor-name"},e.get("name")),l.a.createElement("div",{className:"character"},e.get("character"))))}var Ma=function(e){function t(){return e.apply(this,arguments)||this}o()(t,e);var a=t.prototype;return a.renderContributors=function(){return l.a.createElement(Mt.ExpandableList,{className:"contributor-list",itemClassName:"contributor-item",list:this.props.cast,getItemKey:function(e){return e.get("name")},renderItem:function(e){return Ta(e)},expandLinkHref:"#show-more-contributors",textKey:"contributors",collapseCount:4})},a.render=function(){return l.a.createElement("div",{className:"cp-movie-contributors"},this.renderContributors())},t}(l.a.PureComponent),ja=function(e){function t(){return e.apply(this,arguments)||this}o()(t,e);var a=t.prototype;return a.renderContributors=function(){var e=this.context.features,t=this.props,a=t.bib,n=t.contributorNames,r=t.movie,i=a.getIn(["briefInfo","superFormats"]);return e.get(De.TOGGLZ_FEATURES.BIB_PAGE_MOVIE_TRAILERS)&&i.includes("MOVIES_TV_VIDEO")?r&&l.a.createElement(Ma,{cast:r.getIn(["credits","cast"])}):null!=n&&n.size?l.a.createElement(Aa,{contributorNames:n}):null},a.render=function(){var e=this.renderContributors();return e?l.a.createElement("div",{className:"cp-contributors"},l.a.createElement(ze.a,{tagName:"h3",size:"medium",variant:!0},l.a.createElement(d.FormattedMessage,{id:"bib_metadata_category_contributors"})),e):null},t}(l.a.PureComponent);ja.contextType=b.a;var Fa=Object(_.createSelector)([function(e){return e.getIn(["movies","movie"])}],(function(e){return e.get("id")?e:null})),La=Object(E.a)("CONTRIBUTORS","CONTRIBUTOR_NAME"),wa=function(e){function t(){return e.apply(this,arguments)||this}return o()(t,e),t.prototype.render=function(){return l.a.createElement(ja,this.props)},t}(l.a.PureComponent),Ba=Object(m.connect)((function(e){var t=Object(E.b)(e).get("metadataId");return{bib:Object(C.d)(e).get(t),movie:Fa(e),contributorNames:La(e)}}))(wa);function Ra(e){var t=e.item,a=t.get("url")?l.a.createElement(qe.Link,{className:"distinction-title",href:t.get("url"),dataKey:"distinction-item-link"},t.get("title")):l.a.createElement("div",{className:"distinction-title unlinked"},t.get("title"));return l.a.createElement("div",{className:"cp-distinction-item"},a,l.a.createElement("div",{className:"subtitle"},t.get("subtitle")))}function Da(e,t){return l.a.createElement("div",{className:"list"},l.a.createElement(ze.a,{tagName:"h4",size:"modest"},e),l.a.createElement(Mt.ExpandableList,{className:"distinction-list",collapseCount:3,expandLinkHref:"#show-more-distinctions",getItemKey:function(e){return e.get("title")+"-"+e.get("subtitle")+"}"},itemClassName:"distinction-item",list:t,renderItem:function(e){return l.a.createElement(Ra,{item:e})},stacked:!0}))}var Pa=O.a.fromJS({awards:[{title:"The Reading List",subtitle:"Winner, Science Fiction, 2012",url:"/explore/awards/524289"}],bestsellers:[{title:"New York Times",subtitle:"Hardcover Fiction"}]}),xa=function(e){function t(){return e.apply(this,arguments)||this}return o()(t,e),t.prototype.render=function(){return l.a.createElement("div",{className:"cp-bib-distinctions"},l.a.createElement(ze.a,{tagName:"h3",size:"medium",variant:!0},l.a.createElement(d.FormattedMessage,{id:"awards_and_bestsellers"})),l.a.createElement("div",{className:"lists"},Da(l.a.createElement(d.FormattedMessage,{id:"awards"}),Pa.get("awards")),Da(l.a.createElement(d.FormattedMessage,{id:"bestsellers"}),Pa.get("bestsellers"))))},t}(l.a.PureComponent);function Ua(e){var t,a=e.bib,n=e.mediaSummary,r=e.audienceInfo,i=e.languageInfo,o=(null===(t=a.getIn(["briefInfo","superFormats"]))||void 0===t?void 0:t.includes("MOVIES_TV_VIDEO"))&&(!(null==r||!r.size)||!(null==i||!i.size)),c=function(e){return(null==e?void 0:e.size)>0&&l.a.createElement(lt,{key:e.get("fieldName"),field:e,compact:!0})};return n||o?l.a.createElement("div",{className:"cp-media-summary"},l.a.createElement(ze.a,{tagName:"h3",size:"medium",variant:!0},l.a.createElement(d.FormattedMessage,{id:"media_summary"})),n?l.a.createElement(Mt.ExpandableHtml,{htmlText:n,expandLinkHref:"#media-summary-read-more",dataKey:"media-summary-read-more-link",textKey:"media_summary"}):null,o?l.a.createElement("div",{className:"language-and-audience-info"},c(r),c(i)):null):null}var Ka=Object(E.a)("AUDIENCE","AUDIENCEGENERAL"),Ha=Object(E.a)("NOTES","LANGUAGE"),za=function(e){function t(){return e.apply(this,arguments)||this}return o()(t,e),t.prototype.render=function(){return l.a.createElement(Ua,this.props)},t}(l.a.PureComponent),qa=Object(m.connect)((function(e){var t=Object(E.b)(e).get("metadataId");return{bib:Object(C.d)(e).get(t),mediaSummary:V(e),audienceInfo:Ka(e),languageInfo:Ha(e)}}))(za),Va=function(e){function t(){return e.apply(this,arguments)||this}return o()(t,e),t.prototype.render=function(){return l.a.createElement("section",{className:"cp-bib-about container"},l.a.createElement("div",{className:"row"},l.a.createElement("div",{className:"col-lg-3"},l.a.createElement(ze.a,{tagName:"h2",size:"moderate",variant:!0},l.a.createElement(d.FormattedMessage,{id:"about_section"}))),l.a.createElement("div",{className:"col-lg-7"},l.a.createElement(qa,null),l.a.createElement(Rt,null),l.a.createElement(Re.a,null,(function(e){return e.get(De.TOGGLZ_FEATURES.NERF_BIB_PAGE_DEVELOPMENT)?l.a.createElement(xa,null):null})),l.a.createElement(ra,null),l.a.createElement(Ba,null),l.a.createElement(pa,null),l.a.createElement(Sa,null),l.a.createElement(Tt,null))))},t}(l.a.PureComponent),Ga=a(2743),Wa=a.n(Ga),Ya=a(393),Qa=a(871),Za=a(2744),Xa=a(2600),Ja=a.n(Xa),$a=a(2745),en=a(535),tn=a(71),an=a(2333),nn=a.n(an),rn=a(507);function on(e){var t=e.existingListItem,a=e.list,n=e.catalogBib,r=Object(m.useDispatch)(),i=Object(d.useIntl)(),o=Object(m.useSelector)($a.d),c=n.getIn(["brief","title"]),s=a.get("name");function u(){r(en.a.createListItem({metadataId:n.get("metadataId"),listId:a.get("id")}))}return l.a.createElement("div",{className:"cp-add-to-list-button"},function(){if(t){var e=a.get("draftListId")&&t.get("draft");return l.a.createElement(l.a.Fragment,null,l.a.createElement("span",{className:"title-added-label","aria-hidden":!0},l.a.createElement(xe.Checkmark,null),l.a.createElement(d.FormattedMessage,{id:e?"on_unpublished_draft_list":"on_list"})),l.a.createElement(Ye.a,null,l.a.createElement(d.FormattedMessage,{id:e?"on_unpublished_draft_list_sr":"on_list_sr",values:{title:c,listName:s}})))}var n=i.formatMessage({id:"button_add_to_existing_draft_list"}),r=i.formatMessage({id:"button_add_to_new_draft_list"}),m=i.formatMessage({id:"button_add_to_existing_draft_list_sr"},{title:c,listName:s}),p=i.formatMessage({id:"button_add_to_new_draft_list_sr"},{title:c,listName:s}),f=a.get("isDraft")||!!a.get("draftListId"),g=f?n:r,h=f?m:p;return l.a.createElement(Pe.TextButton,{handleClick:u,renderLeadingIcon:function(){return l.a.createElement(xe.Plus,null)},isLoading:o.getIn([a.get("id"),"isAdding"]),dataKey:"add-to-list-button"},l.a.createElement("span",{"aria-hidden":!0},g),l.a.createElement(Ye.a,null,h))}())}function cn(e){var t=e.handlePageClick,a=e.renderEmptyContent,n=e.lists,r=e.pagination,i=e.catalogBib,o=e.isFetching,c=Object(m.useSelector)(C.y).toList().groupBy((function(e){return e.get("listId")}));return l.a.createElement("div",{className:"cp-add-to-list-table"},n.size>0?l.a.createElement("div",{className:"lists-table"},l.a.createElement(an.PaginationLabel,{pagination:r,textKey:"lists_pagination_info",router:!1,autoFocus:!0}),l.a.createElement(Yt.Table,null,l.a.createElement(Yt.TableHeader,null,l.a.createElement(Yt.TableHeading,{className:"list-name-col"},l.a.createElement(d.FormattedMessage,{id:"list_name"})),l.a.createElement(Yt.TableHeading,{className:"list-date-col"},l.a.createElement(d.FormattedMessage,{id:"list_updated_date"})),l.a.createElement(Yt.TableHeading,{className:"list-action-col"},l.a.createElement(Ye.a,null,l.a.createElement(d.FormattedMessage,{id:"list_action_and_status"})))),l.a.createElement(Yt.TableBody,null,n.map((function(e){return l.a.createElement(Yt.TableRow,{className:"list-row",key:e.get("id")},l.a.createElement(Yt.TableCell,{className:"list-name-col",label:l.a.createElement(d.FormattedMessage,{id:"list_name"}),blockLabel:!0},e.get("name")||l.a.createElement(d.FormattedMessage,{id:"untitled_list"})),l.a.createElement(Yt.TableCell,{className:"list-date-col",label:l.a.createElement(d.FormattedMessage,{id:"list_updated_date"}),blockLabel:!0},l.a.createElement(rn.a,{value:e.get("updated")})),l.a.createElement(Yt.TableCell,{className:"list-action-col",label:l.a.createElement(Ye.a,null,l.a.createElement(d.FormattedMessage,{id:"list_action_and_status"})),blockLabel:!0},function(e){var t=(c.get(e.get("draftListId")||e.get("id"))||O.a.List()).find((function(e){return e.getIn(["bibListItem","id"])===i.get("metadataId")}));return l.a.createElement(on,{list:e,catalogBib:i,existingListItem:t})}(e)))})))),l.a.createElement(nn.a,{handleClick:t,pagination:r,textKey:"lists_pagination_info",isFetching:o,router:!1})):a())}var ln={DRAFT:"draft",PUBLISHED:"published"};function sn(e){var t,a=e.catalogBib,n=a.get("metadataId"),r=Object(c.useState)(ln.DRAFT),i=r[0],o=r[1],s=Object(m.useDispatch)(),u=Object(d.useIntl)(),p=Object(m.useSelector)($a.a),f=Object(m.useSelector)($a.g),g=Object(m.useSelector)($a.c),h=Object(m.useSelector)($a.i),b=Object(m.useSelector)($a.b),v=Object(m.useSelector)($a.h),E=0===p.size&&b,y=0===f.size&&v,I=((t={})[ln.DRAFT]=g.get("count",0),t[ln.PUBLISHED]=h.get("count",0),t),S=Se()(ln).map((function(e){return{label:u.formatMessage({id:"my_"+e+"_lists"},{count:I[e]}),selected:i===e,value:e}}));function O(e){var t=i===ln.DRAFT?tn.a.DRAFT_NOT_PUBLISHED:tn.a.PUBLISHED;s(en.a.getCurrentUserLists({metadataId:n,page:e,category:t}))}function _(){return l.a.createElement("div",{className:"empty-content"},l.a.createElement(d.FormattedMessage,{id:"empty_"+i+"_lists"}))}return Object(c.useEffect)((function(){Object(m.batch)((function(){s(en.a.getCurrentUserLists({metadataId:n,category:tn.a.DRAFT_NOT_PUBLISHED})),s(en.a.getCurrentUserLists({metadataId:n,category:tn.a.PUBLISHED}))}))}),[s,a,n]),l.a.createElement(ut.FullScreenOverlayBody,{className:"cp-add-to-list-overlay"},l.a.createElement(ut.FullScreenOverlayHeader,{title:l.a.createElement(d.FormattedMessage,{id:"add_to_list"})}),l.a.createElement(ut.FullScreenOverlayContent,null,l.a.createElement(dt.b,{metadataId:n}),E||y?l.a.createElement(Yt.TableStencil,null):l.a.createElement(Ja.a,{options:S,renderContent:function(){switch(i){case ln.DRAFT:return l.a.createElement(cn,{handlePageClick:O,renderEmptyContent:_,lists:p,isFetching:b,pagination:g,catalogBib:a});case ln.PUBLISHED:return l.a.createElement(cn,{handlePageClick:O,renderEmptyContent:_,lists:f,isFetching:v,pagination:h,catalogBib:a});default:return null}},handleSelect:o})))}function un(e){var t,a=e.catalogBib,n=e.block,r=e.overlayKey,i=Object(m.useDispatch)(),o=Object(c.useContext)(b.a).mobileApp,s=Object(Qa.metadataIdFixer)(a.get("metadataId"));function u(){i(v.a.redirect("/user_lists/new?bib="+s,{authRequired:!0}))}function p(){i(Za.a.openOverlay(r,{authRequired:!0}))}return o?null:l.a.createElement("div",{className:"cp-add-to-list-dropdown"},l.a.createElement(Ya.Dropdown,{block:n,dataKey:"add-to-list-dropdown",renderLabel:function(){return l.a.createElement(d.FormattedMessage,{id:"add_to_list"})}},l.a.createElement(Ya.DropdownMenuItem,{handleClick:u,item:O.a.Map({label:l.a.createElement(d.FormattedMessage,{id:"add_to_list_new"}),value:"add-to-new-list"})}),(t=l.a.createElement(l.a.Fragment,null,l.a.createElement("span",{"aria-hidden":!0},l.a.createElement(d.FormattedMessage,{id:"add_to_list_existing"})),l.a.createElement(Ye.a,null,l.a.createElement(d.FormattedMessage,{id:"sr_add_to_list_existing"}))),l.a.createElement(Ya.DropdownMenuItem,{handleClick:p,item:O.a.Map({label:t,value:"add-to-existing-list"})}))),l.a.createElement(Qe.a,{dataKey:"add-to-list-overlay",overlayKey:r,handleClose:function(){i(Za.a.closeOverlay(r))}},l.a.createElement(sn,{catalogBib:a})))}function dn(e){var t=e.lists,a=e.pagination,n=e.catalogBib,r=e.users,i=e.library;return!Object(c.useContext)(b.a).mobileApp||null!=t&&t.size?l.a.createElement("div",{className:"cp-community-lists"},l.a.createElement("div",{className:"community-lists-heading"},l.a.createElement(ze.a,{tagName:"h3",size:"medium",variant:!0},l.a.createElement(d.FormattedMessage,{id:"community_lists_featuring_title"}))),l.a.createElement(un,{catalogBib:n,overlayKey:"add-to-list-overlay-community-lists"}),function(){if((null==t?void 0:t.size)>0){var e=n.get("metadataId"),o=a.get("count");return l.a.createElement("div",{className:"community-lists-content"},l.a.createElement("ul",null,t.map((function(e){return l.a.createElement("li",{key:e.get("id")},l.a.createElement(Wa.a,{creator:r.get(e.getIn(["owner","id"]).toString()),library:i,list:e,titleTag:"div",horizontal:!0,smallCreatorLink:!0,smallHeading:!0}))}))),o>t.size&&l.a.createElement(qe.ChevronLink,{className:"view-all-link",dataKey:"view-all-community-lists",href:"/v2/record/"+e+"/lists?category=COMMUNITY"},l.a.createElement(d.FormattedMessage,{id:"view_all_community_lists",values:{count:o}})))}return l.a.createElement("div",{className:"empty-community-lists"},l.a.createElement(d.FormattedMessage,{id:"empty_community_lists"}))}()):null}var mn=Object(m.connect)((function(e){return{catalogBib:Object(E.b)(e),users:Object(C.O)(e),lists:be(e),pagination:ve(e),library:Object(k.b)(e)}}))((function(e){return l.a.createElement(dn,e)})),pn=a(2500),fn=a(166),gn=a(2388),hn=a(2749),bn=a(2736),vn=function(e){function t(){for(var t,a=arguments.length,n=new Array(a),r=0;r<a;r++)n[r]=arguments[r];return(t=e.call.apply(e,[this].concat(n))||this).renderQuotation=function(e){return l.a.createElement(hn.a,{quotation:e,catalogBib:t.props.catalogBib,handleDeleteSuccess:t.handleSuccess},l.a.createElement(Mt.ExpandableText,{text:e.get("quotation"),truncateCount:240,expandLinkHref:"#read-more-ugc-display-"+e.get("id"),textKey:"quotation"}))},t.renderEditor=function(){return l.a.createElement(bn.a,{catalogBib:t.props.catalogBib,handleSuccess:t.handleSuccess})},t.handleSuccess=function(){var e=t.props.catalogBib.get("metadataId");t.props.bibsActions.fetchUGC(e)},t}return o()(t,e),t.prototype.render=function(){var e=this.props,t=e.quotations,a=e.quotationsTransactions,n=e.catalogBib,r=this.props.summary.getIn(["quotations","total"]),i=t.size;return l.a.createElement("div",{className:"cp-quotations","data-key":"quotations"},l.a.createElement(gn.a,{items:t,catalogBib:n,transactions:a,renderItem:this.renderQuotation,renderEditor:this.renderEditor,contentType:"quotations"}),r>i&&l.a.createElement(qe.ChevronLink,{className:"all-quotations",href:"/v2/record/"+n.get("metadataId")+"/quotations",dataKey:"all-quotations"},l.a.createElement(d.FormattedMessage,{id:"view_all_quotations",values:{count:r}})))},t}(l.a.PureComponent),En=function(e){function t(){return e.apply(this,arguments)||this}return o()(t,e),t.prototype.render=function(){return l.a.createElement(vn,this.props)},t}(l.a.PureComponent),yn=Object(m.connect)((function(e){return{quotations:ne(e),quotationsTransactions:Object(pn.d)(e),summary:Z(e),catalogBib:Object(E.b)(e)}}),(function(e){return{bibsActions:Object(p.bindActionCreators)(fn.a,e)}}))(En),In=a(2503),Sn=a(2737),On=a(2750),_n=function(e){function t(){for(var t,a=arguments.length,n=new Array(a),r=0;r<a;r++)n[r]=arguments[r];return(t=e.call.apply(e,[this].concat(n))||this).handleSuccess=function(){var e=t.props.catalogBib.get("metadataId");t.props.bibsActions.fetchUGC(e)},t.renderSummary=function(e){return l.a.createElement(On.a,{summary:e,catalogBib:t.props.catalogBib,handleDeleteSuccess:t.handleSuccess},l.a.createElement(Mt.ExpandableText,{text:e.get("summary"),truncateCount:240,expandLinkHref:"#read-more-ugc-display-"+e.get("id"),textKey:"summary"}))},t.renderEditor=function(){var e=t.props,a=e.currentUserSummaries,n=e.catalogBib;return!a.get(n.get("metadataId"))&&l.a.createElement(Sn.a,{catalogBib:n,handleSuccess:t.handleSuccess})},t}return o()(t,e),t.prototype.render=function(){var e=this.props,t=e.summary,a=e.summaries,n=e.summariesTransactions,r=e.catalogBib,i=t.getIn(["summaries","total"]),o=a.size;return l.a.createElement("div",{className:"cp-summaries","data-key":"summaries"},l.a.createElement(gn.a,{items:a,catalogBib:r,transactions:n,renderItem:this.renderSummary,renderEditor:this.renderEditor,contentType:"summaries"}),i>o&&l.a.createElement(qe.ChevronLink,{className:"all-summaries",href:"/v2/record/"+r.get("metadataId")+"/summaries",dataKey:"all-summaries"},l.a.createElement(d.FormattedMessage,{id:"view_all_summaries",values:{count:i}})))},t}(l.a.PureComponent),Cn=function(e){function t(){return e.apply(this,arguments)||this}return o()(t,e),t.prototype.render=function(){return l.a.createElement(_n,this.props)},t}(l.a.PureComponent),kn=Object(m.connect)((function(e){return{summaries:re(e),summary:Z(e),summariesTransactions:Object(In.e)(e),currentUserSummaries:Object(In.a)(e),catalogBib:Object(E.b)(e)}}),(function(e){return{bibsActions:Object(p.bindActionCreators)(fn.a,e)}}))(Cn),An=a(2416),Nn=a(2732),Tn=a(2585);function Mn(e){var t=e.videos,a=e.currentUserVideos,n=e.videosTransactions,r=e.summary,i=e.bibsActions,o=e.catalogBib;function c(){var e=o.get("metadataId");i.fetchUGC(e)}var s=r.getIn(["videos","total"]),u=t.size;return l.a.createElement("div",{className:"cp-videos","data-key":"videos"},l.a.createElement(gn.a,{items:t,catalogBib:o,transactions:n,renderItem:function(e){return l.a.createElement(Nn.a,{video:e,catalogBib:o,handleDeleteSuccess:c})},renderEditor:function(){return!a.get(o.get("metadataId"))&&l.a.createElement(Tn.a,{metadataId:o.get("metadataId"),handleSuccess:c})},contentType:"videos"}),s>u&&l.a.createElement(qe.ChevronLink,{className:"all-videos",href:"/v2/record/"+o.get("metadataId")+"/videos",dataKey:"all-videos"},l.a.createElement(d.FormattedMessage,{id:"view_all_videos",values:{count:s}})))}var jn=Object(m.connect)((function(e){return{videos:ie(e),currentUserVideos:Object(An.a)(e),videosTransactions:Object(An.e)(e),summary:Z(e),catalogBib:Object(E.b)(e)}}),(function(e){return{bibsActions:Object(p.bindActionCreators)(fn.a,e)}}))((function(e){return l.a.createElement(Mn,e)})),Fn=a(2602),Ln=a(2755),wn=a(2368),Bn=a(213),Rn=a(2382),Dn=a(2358),Pn=a.n(Dn),xn=a(2901),Un=a(164),Kn=a(2390),Hn=a(295);function zn(e){var t=e.ageSuitabilityId,a=e.catalogBib,n=e.ageSuitabilitiesActions,r=e.handleSuccess,i=e.modalActions,o=e.ageSuitabilitiesTransactions;function c(){i.closeModal("delete-age-rating-"+t)}return l.a.createElement(Hn.a,{className:"cp-delete-age-rating-modal",dataKey:"delete-age-rating-modal",modalKey:"delete-age-rating-"+t,size:"small",handleClose:c},l.a.createElement(Kn.a,{ugcType:"ageSuitability",id:t,catalogBib:a,removeUgcAction:n.removeAgeSuitability,transactions:o,handleClose:c,handleSuccess:r}))}var qn=Object(m.connect)((function(e){return{ageSuitabilitiesTransactions:Object(Fn.b)(e)}}),(function(e){return{ageSuitabilitiesActions:Object(p.bindActionCreators)(Ln.a,e),modalActions:Object(p.bindActionCreators)(Bn.a,e)}}))((function(e){return l.a.createElement(zn,e)}));var Vn=Object(d.injectIntl)((function(e){var t=e.handleSuccess,a=e.currentUserAgeSuitability,n=e.metadataId,r=e.open,i=e.catalogBib,o=e.ageSuitabilitiesTransactions,s=e.ageSuitabilitiesActions,u=e.modalActions,m=e.ugcEditorActions,p=e.intl,f=null==a?void 0:a.size,g=f?a.get("min"):null,h=Object(c.useState)(g),b=h[0],v=h[1],E=null==a?void 0:a.get("id"),y=o.getIn([n,"isAdding"])||o.getIn([n,E,"isUpdating"]),I=Pn()(r),S=Object(c.useRef)(),_=Object(c.useRef)();function C(e){var a=b>0?b:null;null==e||e.preventDefault(),E?s.updateAgeSuitability({min:a,metadataId:n,ageSuitabilityId:E,postSuccess:function(){m.closeEditor("ageRating"),t&&t()}}):s.addAgeSuitability({metadataId:n,min:a,postSuccess:function(){m.closeEditor("ageRating"),t&&t()}})}function k(){var e,t=(e=Array(22).fill(null).map((function(e,t){return{key:"age-rating-"+t,value:t,label:0===t?p.formatMessage({id:"ugc_age_suitability_age_all"}):t+"+"}})),O.a.fromJS(e));return l.a.createElement(l.a.Fragment,null,l.a.createElement(Ye.a,null,l.a.createElement("label",{htmlFor:"rating-select"},l.a.createElement(d.FormattedMessage,{id:"age_suitability_select"}))),l.a.createElement(xn.Select,{id:"rating-select",dataKey:"rating-select",name:"age",value:b,ref:_,handleChange:v,prompt:p.formatMessage({id:"age_suitability_select"})},t.map((function(e){return l.a.createElement(xn.SelectOption,{key:e.get("key"),value:e.get("value")},e.get("label"))}))))}return Object(c.useEffect)((function(){r&&!I&&_.current&&Object(Un.setFocusWithinElement)(_.current),!r&&I&&S.current&&Object(Un.setFocusWithinElement)(S.current)}),[r,I,_,S]),l.a.createElement("div",{className:"age-rating-editor"},r?l.a.createElement(l.a.Fragment,null,k(),l.a.createElement("div",{className:"editor-buttons"},l.a.createElement(Pe.TransactionalSolidButton,{disabled:null===b,dataKey:"submit-button",className:"age-rating-submit-button",handleClick:C,isLoading:y},l.a.createElement(d.FormattedMessage,{id:"post_age_rating"})),l.a.createElement(Pe.SecondaryTextButton,{handleClick:function(){return m.closeEditor("ageRating")},className:"age-rating-cancel-button",dataKey:"cancel-button"},l.a.createElement(d.FormattedMessage,{id:"button_cancel"})))):l.a.createElement(l.a.Fragment,null,f?l.a.createElement("span",{className:"rating-label"},l.a.createElement(d.FormattedMessage,{id:"your_rating"})):null,l.a.createElement(Pe.TextButton,{ref:S,handleClick:function(){return m.openEditor("ageRating")},className:"open-editor-button",dataKey:"open-editor-button",size:"large"},l.a.createElement(d.FormattedMessage,{id:null!=a&&a.size?"edit_button":"age_suitability_add_rating"})),a&&l.a.createElement(Pe.TextButton,{handleClick:function(){return u.openModal("delete-age-rating-"+E)},className:"delete-rating-button",dataKey:"delete-rating-button",size:"large"},l.a.createElement(d.FormattedMessage,{id:"delete_button"}))),E&&l.a.createElement(qn,{handleSuccess:t,ageSuitabilityId:E,catalogBib:i}))}));var Gn=Object(m.connect)((function(e){var t=Object(E.b)(e),a=t.get("metadataId");return{currentUserAgeSuitability:Object(Fn.c)(e).get(a),metadataId:a,ageSuitabilitiesTransactions:Object(Fn.b)(e),open:Object(Rn.a)(e).has("ageRating"),catalogBib:t}}),(function(e){return{ageSuitabilitiesActions:Object(p.bindActionCreators)(Ln.a,e),ugcEditorActions:Object(p.bindActionCreators)(wn.a,e),modalActions:Object(p.bindActionCreators)(Bn.a,e)}}))((function(e){return l.a.createElement(Vn,e)}));var Wn=Object(d.injectIntl)((function(e){var t,a,n,r,i=e.currentUserAgeSuitability,o=e.summary,c=e.metadataId,s=e.bibsActions,u=e.intl,m=function(){s.fetchUGC(c)};function p(e,t){var a=0===t?u.formatMessage({id:"ugc_age_suitability_age_all"}):t+"+";return l.a.createElement("div",{className:"age-rating"},l.a.createElement("span",null,e?a:"-"))}return l.a.createElement("div",{className:"cp-age-suitability","data-key":"age-suitability"},l.a.createElement(ze.a,{tagName:"h3",size:"medium",variant:!0},l.a.createElement(d.FormattedMessage,{id:"ugc_age_suitability"})),l.a.createElement("div",{className:"age-suitability-display"},(n=o.getIn(["ageSuitabilities","total"]),r=o.getIn(["ageSuitabilities","average"]),l.a.createElement("div",{className:"average-rating"},p(n,r),l.a.createElement("div",{className:"rating-label"},l.a.createElement(d.FormattedMessage,{id:"age_suitability_average"})),n?l.a.createElement("div",{className:"total-label"},l.a.createElement(d.FormattedMessage,{id:"user_contribution_total_count",values:{count:n}})):null)),(t=null==i?void 0:i.size,a=(null==i?void 0:i.get("min"))||0,l.a.createElement("div",{className:"current-user-rating"},p(t,a),l.a.createElement(Gn,{handleSuccess:m})))))}));var Yn=Object(m.connect)((function(e){var t=Object(E.b)(e).get("metadataId");return{currentUserAgeSuitability:Object(Fn.c)(e).get(t),summary:Z(e),metadataId:t}}),(function(e){return{bibsActions:Object(p.bindActionCreators)(fn.a,e)}}))((function(e){return l.a.createElement(Wn,e)}));var Qn=Object(d.injectIntl)((function(e){var t,a=e.summary,n=e.intl,r=a.getIn(["contentAdvisories","totalUsers"]),i=a.getIn(["contentAdvisories","totalsByType"]);return l.a.createElement("div",{className:"cp-content-notices-summary"},(t=O.a.List(i).map((function(e){var t=e[0],a=e[1];return O.a.Map({type:t,total:a,label:n.formatMessage({id:t+"_advisory_type"})})})).filter((function(e){return e.get("total")})).sort((function(e,t){return t.get("total")-e.get("total")||(t.get("label")<e.get("label")?1:-1)})),l.a.createElement("div",{className:"content-notices-summary"},t.map((function(e){return l.a.createElement("span",{className:"content-notices-category",key:e.get("type")},e.get("label")+" ("+e.get("total")+")")})))),l.a.createElement("div",{className:"summary-label"},l.a.createElement(d.FormattedMessage,{id:"user_contribution_total_count",values:{count:r}})))}));function Zn(e){var t=e.summary,a=e.catalogBib,n=t.getIn(["contentAdvisories","total"]);return n?l.a.createElement("div",{className:"cp-content-notices","data-key":"content-notices"},l.a.createElement(ze.a,{tagName:"h3",size:"medium",variant:!0},l.a.createElement(d.FormattedMessage,{id:"ugc_content_advisories"})),l.a.createElement(Qn,{summary:t}),l.a.createElement(qe.ChevronLink,{className:"all-content-notices",dataKey:"all-content-notices",href:"/v2/record/"+a.get("metadataId")+"/contentnotices"},l.a.createElement(d.FormattedMessage,{id:"view_all_content_notices",values:{count:n}}))):null}var Xn=Object(m.connect)((function(e){return{catalogBib:Object(E.b)(e),summary:Z(e)}}))((function(e){return l.a.createElement(Zn,e)})),Jn="quotations",$n="summaries",er="videos",tr="suitability",ar=function(e){function t(){for(var t,a=arguments.length,n=new Array(a),r=0;r<a;r++)n[r]=arguments[r];return(t=e.call.apply(e,[this].concat(n))||this).state={selectedTab:Jn},t.handleSelect=function(e){t.setState({selectedTab:e})},t.renderContent=function(){switch(t.state.selectedTab){case Jn:return l.a.createElement(yn,null);case $n:return l.a.createElement(kn,null);case er:return l.a.createElement(jn,null);case tr:return l.a.createElement(l.a.Fragment,null,l.a.createElement(Yn,null),l.a.createElement(Xn,null));default:return null}},t}o()(t,e);var a=t.prototype;return a.constructLabel=function(e){var t=this.props.summary,a=t.getIn(["contentAdvisories","total"],0),n=t.getIn(["ageSuitabilities","average"],0),r=this.props.intl.formatMessage({id:e}),i=t.getIn([e,"total"]);return e===tr?(a&&(i=a),n&&(i=n),i&&(r+=n?" ("+i+"+)":" ("+i+")")):i&&(r+=" ("+i+")"),r},a.constructOptions=function(){var e=this;return[Jn,$n,er,tr].map((function(t){return{label:e.constructLabel(t),selected:e.state.selectedTab===t,value:t}}))},a.render=function(){return l.a.createElement("div",{className:"cp-ugc-tabs"},l.a.createElement(ze.a,{tagName:"h3",size:"medium",variant:!0},l.a.createElement(d.FormattedMessage,{id:"community_contributions"})),l.a.createElement(Ja.a,{options:this.constructOptions(),renderContent:this.renderContent,handleSelect:this.handleSelect}))},t}(l.a.PureComponent),nr=Object(d.injectIntl)(ar),rr=function(e){function t(){return e.apply(this,arguments)||this}return o()(t,e),t.prototype.render=function(){return l.a.createElement(nr,this.props)},t}(l.a.PureComponent),ir=Object(m.connect)((function(e){return{summary:Z(e)}}))(rr),or=function(e){function t(){return e.apply(this,arguments)||this}return o()(t,e),t.prototype.render=function(){return l.a.createElement("section",{className:"cp-bib-community container"},l.a.createElement("div",{className:"row"},l.a.createElement("div",{className:"col-lg-3"},l.a.createElement(ze.a,{tagName:"h2",size:"moderate",variant:!0},l.a.createElement(d.FormattedMessage,{id:"community_section"}))),l.a.createElement("div",{className:"col-lg-7"},l.a.createElement(mn,null),l.a.createElement(ir,null))))},t}(l.a.PureComponent),cr=a(301),lr=a.n(cr),sr=a(2532),ur=a.n(sr),dr=a(552),mr=a(554),pr=Ge.bibEventComposer.composeAuthorClickEvent,fr=g.CUSTOM_DIMENSIONS,gr=function(){Object(Ve.sendAnalyticsEvents)(pr({containerName:fr.CONTAINER_NAMES.BIB_ITEM}))},hr=function(e){function t(){return e.apply(this,arguments)||this}return o()(t,e),t.prototype.render=function(){var e=this.props.catalogBib.getIn(["brief","creators"],O.a.List());return l.a.createElement("div",{className:"cp-bib-authors authors-wrapper"},l.a.createElement(mr.a,{authors:e,renderAsLink:this.props.renderAsLink,truncateCount:this.props.truncateCount,handleClick:gr}))},t}(l.a.PureComponent);function br(e){var t,a,n=e.className,r=e.catalogBib,i=e.size,o=e.renderAttribution,c=e.handleClick;function s(){return l.a.createElement("div",{className:"bib-info"},l.a.createElement(dr.a,{mainTagName:"div",catalogBib:r,truncateCount:20,showSubTitle:!1}),l.a.createElement(hr,{catalogBib:r,renderAsLink:!1,truncateCount:20}))}return l.a.createElement("div",{className:Xe()("cp-bib-slide",n)},l.a.createElement(Kt,{metadataId:r.get("metadataId"),handleClick:c,className:"bib-slide-link",dataKey:"bib-slide-link"},(t=r.getIn(["brief","creators"],O.a.List()).map((function(e){return e.get("otherScriptFullName")||e.get("fullName")})),a=r.getIn(["brief","otherScriptTitle"])||r.getIn(["brief","title"]),l.a.createElement(ur.a,{title:a,authors:t})),l.a.createElement(lr.a,{size:i,renderDefault:function(){return l.a.createElement("div",{className:"text-cover","aria-hidden":!0},l.a.createElement("div",{className:"text-cover-content"},s()))},src:r.getIn(["brief","coverImage"])}),l.a.createElement("div",{className:"bib-slide-hover","aria-hidden":!0},s())),null==o?void 0:o())}br.defaultProps={size:"medium"};var vr=function(e){function t(){return e.apply(this,arguments)||this}return o()(t,e),t.prototype.render=function(){return l.a.createElement(br,this.props)},t}(l.a.PureComponent),Er=Object(m.connect)((function(e,t){return{catalogBib:Object(C.g)(e).get(t.metadataId)}}))(vr),yr=Ge.recommendationComposer.composeImageClickEvent;function Ir(e){var t=e.item,a=e.itemIndex;return l.a.createElement(Er,{className:"cp-bib-recommendation-item",metadataId:t.get("id"),renderAttribution:function(){return l.a.createElement("div",{className:"provider-label"},0===a&&l.a.createElement(ta,{name:t.get("providerName")}))},handleClick:function(){return function(e){var t=e.get("providerURI"),a=e.get("id");Object(Ve.sendAnalyticsEvents)(yr({providerURI:t,metadataId:a}))}(t)}})}var Sr=function(e){function t(){return e.apply(this,arguments)||this}o()(t,e);var a=t.prototype;return a.renderGroupedRecommendations=function(){return this.props.recommendations.groupBy((function(e){return e.get("providerName")})).map((function(e){return e.map((function(e,t){return l.a.createElement(Ir,{item:e,itemIndex:t,key:e.get("id")})}))})).valueSeq()},a.render=function(){var e=this.props,t=e.catalogBib,a=e.recommendations,n=t.get("metadataId");return a.size?l.a.createElement("div",{className:"cp-bib-recommendations"},l.a.createElement(ze.a,{tagName:"h2",size:"moderate",variant:!0,className:"group-title"},l.a.createElement(d.FormattedMessage,{id:"recommendations_may_also_like"})),l.a.createElement("div",{className:"groups"},this.renderGroupedRecommendations()),l.a.createElement(qe.SecondaryGhostLink,{className:"view-all-recommendations-link",href:"/v2/record/"+n+"/recommendations",dataKey:"recommendations-view-all-link"},l.a.createElement(d.FormattedMessage,{id:"view_all_recommendations"}))):null},t}(l.a.PureComponent),Or=function(e){function t(){return e.apply(this,arguments)||this}return o()(t,e),t.prototype.render=function(){return l.a.createElement(Sr,this.props)},t}(l.a.PureComponent),_r=Object(m.connect)((function(e){return{catalogBib:Object(E.b)(e),recommendations:me(e)}}))(Or),Cr=function(e){function t(){return e.apply(this,arguments)||this}o()(t,e);var a=t.prototype;return a.renderItem=function(e){var t=this.props,a=t.stacked,n=t.library,r=t.users,i=Xe()("list-item",a?"col-sm-12":"col-sm-3"),o=r.get(e.getIn(["owner","id"]).toString());return l.a.createElement("li",{key:e.get("id"),className:i},l.a.createElement(Wa.a,{creator:o,library:n,list:e,titleTag:"div",horizontal:a,smallHeading:!0,smallCreatorLink:!0}))},a.render=function(){var e=this,t=this.props,a=t.lists,n=t.className,r=t.stacked,i=Xe()("cp-lists-row","row",n,{stacked:r});return l.a.createElement("ul",{className:i},a.map((function(t){return e.renderItem(t)})))},t}(l.a.PureComponent),kr=function(e){function t(){return e.apply(this,arguments)||this}o()(t,e);var a=t.prototype;return a.renderAllListsLink=function(){var e=this.props.catalogBib.get("metadataId");return l.a.createElement(qe.SecondaryGhostLink,{className:"cp-all-lists-link",dataKey:"all-lists-link",href:"/v2/record/"+e+"/lists"},l.a.createElement(d.FormattedMessage,{id:"view_all_lists"}))},a.renderLists=function(){var e=this.props,t=e.lists,a=e.library,n=e.users;return t.size<=2?l.a.createElement("div",null,l.a.createElement(ze.a,{tagName:"h2",size:"moderate",variant:!0,className:"staff-lists-heading"},l.a.createElement(d.FormattedMessage,{id:"staff_lists_featuring_title"})),l.a.createElement(Cr,{lists:t,stacked:!0,users:n,library:a})):l.a.createElement("div",null,l.a.createElement(ze.a,{tagName:"h2",size:"moderate",variant:!0,className:"staff-lists-heading"},l.a.createElement(d.FormattedMessage,{id:"staff_lists_featuring_title"})),l.a.createElement(Cr,{key:"desktop",className:"lists-desktop",lists:t.take(4),library:a,users:n}),l.a.createElement(Cr,{key:"mobile",className:"lists-mobile",lists:t,stacked:!0,library:a,users:n}))},a.render=function(){var e=this.props.lists;return e.size?l.a.createElement("div",{className:"cp-staff-lists"},this.renderLists(e),l.a.createElement("div",{className:"view-all-link"},this.renderAllListsLink())):null},t}(l.a.PureComponent),Ar=function(e){function t(){return e.apply(this,arguments)||this}return o()(t,e),t.prototype.render=function(){return l.a.createElement(kr,this.props)},t}(l.a.PureComponent),Nr=Object(m.connect)((function(e){return{catalogBib:Object(E.b)(e),users:Object(C.O)(e),lists:he(e),library:Object(k.b)(e)}}))(Ar),Tr=function(e){function t(){return e.apply(this,arguments)||this}return o()(t,e),t.prototype.render=function(){var e=this.props,t=e.catalogBib,a=e.staffLists,n=e.recommendations,r=t.get("metadataId");return a.size||n.size?l.a.createElement("section",{className:"cp-bib-discover"},l.a.createElement("div",{className:"container"},l.a.createElement(Nr,{metadataId:r}),a.size>0&&n.size>0&&l.a.createElement(we.a,null),l.a.createElement(_r,null))):l.a.createElement("div",{className:"container"},l.a.createElement(we.a,null))},t}(l.a.PureComponent),Mr=a(2883),jr=a(2766),Fr=Ge.tagsEventComposer.composeTagClickEvent;var Lr=function(e){function t(){return e.apply(this,arguments)||this}o()(t,e);var a=t.prototype;return a.renderTag=function(e){var t=this.props.tagType,a=e.get("tag"),n="/v2/search?query="+a+"&searchType=tag",r=e.get("count");return l.a.createElement("li",{key:a+"-"+r,className:"tag-item"},l.a.createElement(t,{className:"tag-item-link",dataKey:"tag-item-link",href:n,rel:"noopener noreferrer",handleClick:function(){return function(e){Object(Ve.sendAnalyticsEvents)(Fr({tagName:e}))}(a)}},a," (",r,")"))},a.render=function(){var e=this;return l.a.createElement("ul",{className:Xe()("cp-tag-list",{"tag-list--stacked":this.props.stacked})},this.props.tags.map((function(t){return e.renderTag(t)})))},t}(l.a.PureComponent);Lr.defaultProps={tagType:qe.SecondaryLink};var wr=function(e){function t(){return e.apply(this,arguments)||this}return o()(t,e),t.prototype.render=function(){return l.a.createElement(ut.FullScreenOverlayBody,{className:"cp-all-community-tags"},l.a.createElement(ut.FullScreenOverlayHeader,{title:l.a.createElement(d.FormattedMessage,{id:"all_community_tags"})}),l.a.createElement(ut.FullScreenOverlayContent,{size:"small"},l.a.createElement(dt.b,{metadataId:this.props.metadataId}),l.a.createElement(we.a,{className:"divider"}),l.a.createElement(Lr,{tags:this.props.tags,tagType:qe.SecondaryLink,stacked:!0})))},t}(l.a.PureComponent),Br=a(2893),Rr=a(2771),Dr=function(e){function t(){return e.apply(this,arguments)||this}o()(t,e);var a=t.prototype;return a.componentDidMount=function(){var e=this.props,t=e.tagsActions,a=e.metadataId;t.fetchTagSummaries(a)},a.render=function(){return l.a.createElement(wr,this.props)},t}(l.a.PureComponent),Pr=Object(m.connect)((function(e){return{tags:Object(Rr.a)(e)}}),(function(e){return{tagsActions:Object(p.bindActionCreators)(Br.a,e)}}))(Dr),xr=function(e){function t(t){var a;return a=e.call(this,t)||this,Object(xt.bindAll)(Pt()(a)),a.state={open:!1},a}o()(t,e);var a=t.prototype;return a.handleOpen=function(){this.setState({open:!0})},a.handleClose=function(){this.setState({open:!1})},a.renderPillTags=function(){return l.a.createElement(Lr,{tags:this.props.tags,tagType:jr.LinkedPill})},a.renderOverlay=function(){return this.props.pagination.get("pages")>1?l.a.createElement("div",{className:"overlay-wrapper"},l.a.createElement(qe.ChevronLink,{className:"view-expand-link",href:"#view-expand-link",dataKey:"view-expand-link",handleClick:this.handleOpen,preventDefault:!0},l.a.createElement("span",{"aria-hidden":!0},l.a.createElement(d.FormattedMessage,{id:"view_all"})),l.a.createElement(Ye.a,null,l.a.createElement(d.FormattedMessage,{id:"view_all_tags"}))),l.a.createElement(Qe.a,{open:this.state.open,handleClose:this.handleClose,overlayKey:"all-community-tags-full-screen-overlay",dataKey:"all-community-tags-full-screen-overlay"},this.state.open&&l.a.createElement(Pr,{metadataId:this.props.metadataId}))):null},a.render=function(){return 0===this.props.tags.size?null:l.a.createElement("div",{className:"cp-community-tags"},l.a.createElement("div",{className:"community-tags-heading"},l.a.createElement(ze.a,{tagName:"h3",size:"medium",variant:!0},l.a.createElement(d.FormattedMessage,{id:"community_tags"})),this.renderPillTags()),this.renderOverlay())},t}(l.a.PureComponent),Ur=function(e){function t(){return e.apply(this,arguments)||this}return o()(t,e),t.prototype.render=function(){return l.a.createElement(xr,this.props)},t}(l.a.PureComponent),Kr=Object(m.connect)((function(e){return{tags:te(e),pagination:ae(e)}}))(Ur),Hr=Ge.relatedTitlesEventComposer.composeImageClickEvent;function zr(){var e=Object(m.useSelector)(pe);return e.size>0?l.a.createElement("div",{className:"cp-related-titles"},l.a.createElement("div",{className:"heading"},l.a.createElement(ze.a,{tagName:"h3",size:"medium",variant:!0},l.a.createElement(d.FormattedMessage,{id:"related_titles"}))),l.a.createElement("div",{className:"items"},e.map((function(e){return l.a.createElement(Er,{key:e.get("metadataId"),metadataId:e.get("metadataId"),handleClick:function(){return function(e){Object(Ve.sendAnalyticsEvents)(Hr({metadataId:e.get("metadataId")}))}(e)}})})))):null}function qr(e,t,a){return{metadataId:e,title:t,format:"BK",coverImage:{type:"NONLOCAL",local_url:a,providerURI:"https://novselect.ebscohost.com/"}}}var Vr=function(e){function t(){return e.apply(this,arguments)||this}return o()(t,e),t.prototype.render=function(){var e=O.a.fromJS([qr("S26C513402","Void trilogy","https://secure.syndetics.com/index.aspx?isbn=9781400157273/MC.GIF&client=ottap&type=xw12&oclc="),qr("S26C422868","Old Man's War universe","https://secure.syndetics.com/index.aspx?isbn=9780765394859/MC.GIF&client=ottap&type=xw12&oclc="),qr("S26C199946","Shadow series (Orson Scott Card)","https://secure.syndetics.com/index.aspx?isbn=9781435235045/MC.GIF&client=ottap&type=xw12&oclc=")]);return l.a.createElement("div",{className:"cp-similar-series"},l.a.createElement("div",{className:"similar-series-heading"},l.a.createElement(ze.a,{tagName:"h3",size:"medium",variant:!0},l.a.createElement(d.FormattedMessage,{id:"similar_series"})),l.a.createElement(ta,{name:"novelist"})),l.a.createElement(Wt,{bibs:e}))},t}(l.a.PureComponent);function Gr(e){var t=e.authors,a=e.handleClick;return l.a.createElement("div",{className:"cp-authors-list"},l.a.createElement(Mt.ExpandableList,{className:"authors-list",collapseCount:3,expandLinkHref:"#show-more-authors",getItemKey:function(e){return e},itemClassName:"author-item",list:t,renderItem:function(e){return function(e,t){return l.a.createElement(mr.a,{linkTag:qe.SecondaryLink,authors:O.a.List.of(e),handleClick:t})}(e,a)},stacked:!0,textKey:"authors"}))}var Wr=Ge.bibEventComposer.composeSimilarAuthorLinkClickEvent,Yr=g.CUSTOM_DIMENSIONS;function Qr(e){var t,a=e.authorSuggestions,n=null===(t=a.first())||void 0===t?void 0:t.get("providerName");return 0===a.size?null:l.a.createElement("div",{className:"cp-similar-authors"},l.a.createElement("div",{className:"similar-authors-heading"},l.a.createElement(ze.a,{tagName:"h3",size:"medium",variant:!0},l.a.createElement(d.FormattedMessage,{id:"similar_authors"})),l.a.createElement(ta,{name:n})),l.a.createElement(Gr,{authors:a,handleClick:function(){Object(Ve.sendAnalyticsEvents)(Wr({containerName:Yr.CONTAINER_NAMES.BIB_EXPLORE_FURTHER,providerName:n}))}}))}var Zr=function(e){function t(){return e.apply(this,arguments)||this}return o()(t,e),t.prototype.render=function(){return l.a.createElement(Qr,this.props)},t}(l.a.PureComponent),Xr=Object(m.connect)((function(e){return{authorSuggestions:fe(e)}}))(Zr),Jr=Ge.bibEventComposer.composeRelatedAuthorLinkClickEvent,$r=g.CUSTOM_DIMENSIONS,ei=function(){Object(Ve.sendAnalyticsEvents)(Jr({containerName:$r.CONTAINER_NAMES.BIB_EXPLORE_FURTHER}))};function ti(e){var t=e.relatedAuthors;return 0===t.size?null:l.a.createElement("div",{className:"cp-related-authors"},l.a.createElement("div",{className:"related-authors-heading"},l.a.createElement(ze.a,{tagName:"h3",size:"medium",variant:!0},l.a.createElement(d.FormattedMessage,{id:"related_authors"}))),l.a.createElement(Gr,{authors:t,handleClick:ei}))}var ai=function(e){function t(){return e.apply(this,arguments)||this}return o()(t,e),t.prototype.render=function(){return l.a.createElement(ti,this.props)},t}(l.a.PureComponent),ni=Object(m.connect)((function(e){return{relatedAuthors:G(e)}}))(ai);function ri(e){var t=e.resources,a=e.collapseCount,n=void 0===a?3:a,r=e.handleClick,i=t.flatMap((function(e){var t=e.get("id"),a=e.get("title")||e.get("description")||e.get("appliesToResourcePart");return(e.get("uris")||e.get("resourceURIs")).map((function(e){return O.a.Map({uri:e,title:a,key:t+"-"+e})}))}));return l.a.createElement(Mt.ExpandableList,{className:"cp-resources-list",expandLinkHref:"#show-more-resources",collapseCount:n,getItemKey:function(e){return e.get("key")},renderItem:function(e){return function(e,t){var a=e.get("uri");return l.a.createElement("div",{className:"resource-link"},l.a.createElement(qe.ChevronLink,{dataKey:"resource-link",href:a,target:"_blank",handleClick:function(){return t(a)}},e.get("title")||l.a.createElement(d.FormattedMessage,{id:"access_online_resource"})))}(e,r)},itemClassName:"resource-item",list:i,textKey:"resources",stacked:!0})}var ii=Ge.bibHoldingsEventComposer.composeOnlineResourceClickEvent,oi=g.CUSTOM_DIMENSIONS,ci=function(e){Object(Ve.sendAnalyticsEvents)(ii({url:e,gtmContainerName:oi.CONTAINER_NAMES.BIB_RELATED_RESOURCES}))};function li(e){var t=e.onlineResources;return 0===t.size?null:l.a.createElement("div",{className:"cp-online-resources"},l.a.createElement(ze.a,{tagName:"h3",size:"medium",variant:!0},l.a.createElement(d.FormattedMessage,{id:"online_resources"})),l.a.createElement(ri,{resources:t,handleClick:ci}))}var si=function(e){function t(){return e.apply(this,arguments)||this}return o()(t,e),t.prototype.render=function(){return l.a.createElement(li,this.props)},t}(l.a.PureComponent),ui=Object(m.connect)((function(e){return{onlineResources:Y(e)}}))(si);function di(){var e=Ge.novelistEventsComposer.composeViewAllEvent;Object(Ve.sendAnalyticsEvents)(e({gtmContainerName:g.CUSTOM_DIMENSIONS.CONTAINER_NAMES.MORE_ABOUT_TITLE}))}var mi=function(e){function t(){return e.apply(this,arguments)||this}return o()(t,e),t.prototype.render=function(){var e=this.props,t=e.catalogBib,a=e.tags,n=e.authorSuggestions,r=e.relatedTitles,i=e.relatedAuthors,o=e.onlineResources,c=t.get("metadataId");return a.size||n.size||r.size||i.size||o.size?l.a.createElement("div",null,l.a.createElement("section",{className:"cp-bib-explore container"},l.a.createElement("div",{className:"row"},l.a.createElement("div",{className:"col-lg-3"},l.a.createElement(ze.a,{tagName:"h2",size:"moderate",variant:!0},l.a.createElement(d.FormattedMessage,{id:"explore_section"}))),l.a.createElement("div",{className:"col-lg-7"},l.a.createElement(zr,null),l.a.createElement(ui,null),l.a.createElement(Kr,{metadataId:c}),l.a.createElement(Re.a,null,(function(e){return e.get(De.TOGGLZ_FEATURES.NERF_BIB_PAGE_DEVELOPMENT)?l.a.createElement(Vr,null):null})),n.size||i.size?l.a.createElement("div",{className:"more-authors"},l.a.createElement(Xr,null),l.a.createElement(ni,null)):null,l.a.createElement(Mr.a,{catalogBib:t,heading:l.a.createElement(ze.a,{tagName:"h3",size:"medium",variant:!0},l.a.createElement(d.FormattedMessage,{id:"more_about_this_title"})),handleClick:di})))),l.a.createElement("div",{className:"container"},l.a.createElement(we.a,null))):null},t}(l.a.PureComponent),pi=a(2968),fi=a.n(pi),gi=a(135),hi="movie-trailer-modal",bi=function(e){function t(){for(var t,a=arguments.length,n=new Array(a),r=0;r<a;r++)n[r]=arguments[r];return(t=e.call.apply(e,[this].concat(n))||this).handleOpen=function(){t.props.modalActions.openModal(hi,{authRequired:!1})},t.handleClose=function(){t.props.modalActions.closeModal(hi)},t}o()(t,e);var a=t.prototype;return a.componentDidMount=function(){fi.a.init(),fi.a.addDriver("scrollY",(function(){return window.scrollY}))},a.renderButton=function(){return l.a.createElement(Pe.SecondaryGhostButton,{className:"trailer-button",dataKey:"trailer-button",handleClick:this.handleOpen,renderLeadingIcon:function(){return l.a.createElement(xe.PlayCircleOutline,null)}},l.a.createElement(d.FormattedMessage,{id:"watch_trailer"}))},a.renderBackDrop=function(){var e=this.props.movie.get("backdropPath");return e&&l.a.createElement("img",{alt:"",className:"backdrop-image lax","data-lax-translate-y":"400 -150, 0 0",src:Na.c+"/"+e,loading:"lazy"})},a.renderPlayer=function(){var e=this.props.movie.getIn(["videos","results",0,"key"]);return e&&l.a.createElement(Hn.a,{modalKey:hi,handleClose:this.handleClose,bodyClassName:"trailer-modal"},l.a.createElement("div",null,l.a.createElement(gi.ModalHeader,{title:l.a.createElement(d.FormattedMessage,{id:"watch_trailer"})}),l.a.createElement("iframe",{src:Na.d+"/"+e,frameBorder:"0",allowFullScreen:!0})))},a.render=function(){var e=this.renderPlayer(),t=this.renderBackDrop();return e&&t?l.a.createElement("div",{className:"cp-movie-trailer"},this.renderButton(),l.a.createElement("div",{className:"backdrop-wrapper"},t),e):null},t}(l.a.PureComponent),vi=a(84),Ei=a(159),yi=a(398),Ii=a.n(yi),Si=a(351),Oi=a.n(Si),_i=a(516),Ci=a(2969),ki=a.n(Ci);function Ai(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function Ni(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Ai(Object(a),!0).forEach((function(t){I()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Ai(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function Ti(e,t,a){void 0===a&&(a={});var n=Oi.a.stringify(Ni(Ni({},a),{},{api_key:Na.a})),r=Ii.a[e](""+Na.b+t+"?"+n);return Object(_i.superagentToObservable)(r).map((function(e){return e.body=ki()(e.body),e}))}function Mi(e,t){return void 0===t&&(t=1),Ti("get","/search/movie",{language:"en-US",include_adult:!1,query:e,page:t})}function ji(e){return Ti("get","/movie/"+e,{language:"en-US",append_to_response:"videos,credits"})}var Fi={searchMovies:Mi,getMovieById:ji,getMovieByTitle:function(e){return Mi(e).pipe(Object(Ei.mergeMap)((function(e){return e.body.results&&e.body.results.length?ji(e.body.results[0].id):Object(vi.of)({})})))}};var Li={getMovieByTitle:function(e){return{types:[Na.e.GET_MOVIE_BY_TITLE_REQUEST,Na.e.GET_MOVIE_BY_TITLE_SUCCESS,Na.e.GET_MOVIE_BY_TITLE_FAILURE],apiRequest:function(){return Fi.getMovieByTitle(e)}}}},wi=function(e){function t(){return e.apply(this,arguments)||this}o()(t,e);var a=t.prototype;return a.componentDidMount=function(){this.fetchMovie()},a.fetchMovie=function(){if(this.context.features.get(De.TOGGLZ_FEATURES.BIB_PAGE_MOVIE_TRAILERS)){var e=this.props,t=e.moviesActions,a=e.bib,n=e.catalogBib.getIn(["brief","title"]),r=a.getIn(["briefInfo","superFormats"]);n&&r.includes("MOVIES_TV_VIDEO")&&t.getMovieByTitle(n)}},a.render=function(){return this.props.movie&&l.a.createElement(bi,this.props)},t}(l.a.PureComponent);wi.contextType=b.a;var Bi=Object(m.connect)((function(e){var t=Object(E.b)(e),a=t.get("metadataId");return{bib:Object(C.d)(e).get(a),catalogBib:t,movie:Fa(e)}}),(function(e){return{modalActions:Object(p.bindActionCreators)(Bn.a,e),moviesActions:Object(p.bindActionCreators)(Li,e)}}))(wi),Ri=function(e){function t(){return e.apply(this,arguments)||this}return o()(t,e),t.prototype.render=function(){return l.a.createElement("section",{className:"cp-bib-movies"},l.a.createElement(Bi,null))},t}(l.a.PureComponent),Di=a(2887);function Pi(e){var t=e.reviews,a=void 0===t?O.a.List():t,n=e.totalReviews,r=e.catalogBib;if(0===a.size)return null;var i=a.get(0).get("fullDetailsURI");return l.a.createElement("section",{className:"cp-critics-reviews"},l.a.createElement(ze.a,{tagName:"h3",size:"medium",variant:!0},l.a.createElement(d.FormattedMessage,{id:"critics_reviews_section"})),l.a.createElement("div",{className:"reviews"},function(e){return e.map((function(e){return l.a.createElement(Di.a,{review:e,compact:!0,key:e.get("id")})}))}(a)),n>a.size&&l.a.createElement(qe.ChevronLink,{className:"all-reviews",dataKey:"all-reviews",href:"/v2/record/"+r.get("metadataId")+"/reviews"},l.a.createElement(d.FormattedMessage,{id:"view_all_reviews",values:{count:n}})),!!i&&l.a.createElement("div",{className:"more-reviews"},l.a.createElement(d.FormattedMessage,{id:"read_more_reviews",values:{title:r.getIn(["brief","title"]),link:l.a.createElement(qe.SecondaryLink,{href:i,dataKey:"more-reviews"},"iDreamBooks.com")}})))}var xi=function(e){function t(){return e.apply(this,arguments)||this}return o()(t,e),t.prototype.render=function(){return l.a.createElement(Pi,this.props)},t}(l.a.PureComponent),Ui=Object(m.connect)((function(e){var t=q(e);return{reviews:t.get("items"),totalReviews:t.get("totalReviews"),catalogBib:Object(E.b)(e)}}))(xi),Ki=a(2734),Hi=function(e){function t(){for(var t,a=arguments.length,n=new Array(a),r=0;r<a;r++)n[r]=arguments[r];return(t=e.call.apply(e,[this].concat(n))||this).handleDeleteSuccess=function(){var e=t.props.catalogBib.get("metadataId");t.props.bibsActions.fetchUGC(e)},t.renderComment=function(e){return l.a.createElement(Ki.a,{comment:e,displayStaffBadge:!1,catalogBib:t.props.catalogBib,handleDeleteSuccess:t.handleDeleteSuccess},l.a.createElement(Mt.ExpandableText,{text:e.get("comment"),truncateCount:240,expandLinkHref:"#read-more-ugc-display-"+e.get("id"),textKey:"comment"}))},t}return o()(t,e),t.prototype.render=function(){return this.props.comments.size>0&&l.a.createElement("section",{className:"cp-staff-comments"},l.a.createElement(ze.a,{tagName:"h3",size:"medium",variant:!0,className:"staff-comments-subtitle"},l.a.createElement(d.FormattedMessage,{id:"staff_comments_section"})),l.a.createElement(gn.a,{items:this.props.comments,catalogBib:this.props.catalogBib,transactions:this.props.commentsTransactions,renderItem:this.renderComment,contentType:"staff_comments"}))},t}(l.a.PureComponent),zi=a(2456),qi=function(e){function t(){return e.apply(this,arguments)||this}return o()(t,e),t.prototype.render=function(){return l.a.createElement(Hi,this.props)},t}(l.a.PureComponent),Vi=Object(m.connect)((function(e){return{catalogBib:Object(E.b)(e),commentsTransactions:Object(zi.d)(e),comments:ee(e)}}),(function(e){return{bibsActions:Object(p.bindActionCreators)(fn.a,e)}}))(qi),Gi=a(2446),Wi=a(2738),Yi=function(e){function t(){for(var t,a=arguments.length,n=new Array(a),r=0;r<a;r++)n[r]=arguments[r];return(t=e.call.apply(e,[this].concat(n))||this).handleSuccess=function(){var e=t.props.catalogBib.get("metadataId");t.props.bibsActions.fetchUGC(e)},t.renderEditor=function(){var e=t.props,a=e.catalogBib;return!e.currentUserComments.get(a.get("metadataId"))&&l.a.createElement(Wi.a,{catalogBib:a,handleSuccess:t.handleSuccess})},t.renderComment=function(e){return l.a.createElement(Ki.a,{comment:e,catalogBib:t.props.catalogBib,handleDeleteSuccess:t.handleSuccess},l.a.createElement(Mt.ExpandableText,{text:e.get("comment"),truncateCount:240,expandLinkHref:"#read-more-ugc-display-"+e.get("id"),textKey:"comment"}))},t}return o()(t,e),t.prototype.render=function(){var e=this.props,t=e.catalogBib,a=e.comments,n=e.summary.getIn(["comments","total"]),r=a.size;return l.a.createElement("section",{className:"cp-community-comments"},l.a.createElement(ze.a,{tagName:"h3",size:"medium",variant:!0,className:"community-comments-subtitle"},l.a.createElement(d.FormattedMessage,{id:"community_comments_section"})),l.a.createElement(gn.a,{items:a,catalogBib:this.props.catalogBib,transactions:this.props.commentsTransactions,renderItem:this.renderComment,renderEditor:this.renderEditor,contentType:"community_comments"},l.a.createElement(Gi.a,null)),n>r&&l.a.createElement(qe.ChevronLink,{className:"all-comments",dataKey:"all-comments",href:"/v2/record/"+t.get("metadataId")+"/comments"},l.a.createElement(d.FormattedMessage,{id:"view_all_comments",values:{count:n}})))},t}(l.a.PureComponent),Qi=function(e){function t(){return e.apply(this,arguments)||this}return o()(t,e),t.prototype.render=function(){return l.a.createElement(Yi,this.props)},t}(l.a.PureComponent),Zi=Object(m.connect)((function(e){var t=Object(E.b)(e);return{comments:$(e),currentUserComments:Object(zi.e)(e),commentsTransactions:Object(zi.d)(e),summary:Z(e),catalogBib:t}}),(function(e){return{bibsActions:Object(p.bindActionCreators)(fn.a,e)}}))(Qi),Xi=function(e){function t(){return e.apply(this,arguments)||this}return o()(t,e),t.prototype.render=function(){return l.a.createElement("section",{className:"cp-bib-opinion container"},l.a.createElement("div",{className:"row"},l.a.createElement("div",{className:"col-lg-3"},l.a.createElement(ze.a,{tagName:"h2",size:"moderate",variant:!0},l.a.createElement(d.FormattedMessage,{id:"opinion_section"}))),l.a.createElement("div",{className:"col-lg-7"},l.a.createElement(Ui,null),l.a.createElement(Vi,null),l.a.createElement(Zi,null))))},t}(l.a.PureComponent),Ji=(a(555),a(550)),$i=a(2398),eo=a(15);function to(e){var t=e.otherLanguageTitles;return l.a.createElement("div",{className:"cp-other-languages-modal"},l.a.createElement(gi.ModalHeader,{title:l.a.createElement(d.FormattedMessage,{id:"other_languages"})}),l.a.createElement(gi.ModalContent,null,t.map((function(e){return function(e){return l.a.createElement("div",{className:"other-languages-title"},l.a.createElement(we.a,null),l.a.createElement(qe.Link,{className:"other-languages-title-link",dataKey:e.get("id"),href:"/v2/record/"+e.get("id")},l.a.createElement(l.a.Fragment,null,l.a.createElement(ze.a,{tagName:"div",size:"modest",variant:!0,className:"title-info"},e.getIn(["brief","otherScriptTitle"])||e.getIn(["brief","title"])),l.a.createElement("div",{className:"language-info"},l.a.createElement(d.FormattedMessage,{id:"LANGUAGE."+e.getIn(["brief","primaryLanguage"])})))))}(e)}))))}function ao(){var e=Object(m.useSelector)(Ee),t=Object(m.useDispatch)();return e.size?l.a.createElement("div",{className:"cp-other-languages-button"},l.a.createElement(Pe.SecondaryTextButton,{handleClick:function(){return t(Bn.a.openModal(eo.k,{authRequired:!1}))},className:"other-languages-button",dataKey:"other-languages-button"},l.a.createElement(d.FormattedMessage,{id:"other_languages_count",values:{count:e.size}})),l.a.createElement(Hn.a,{modalKey:eo.k,handleClose:function(){return t(Bn.a.closeModal(eo.k))},size:"small"},l.a.createElement(to,{otherLanguageTitles:e}))):null}function no(e){var t=e.catalogBib,a=e.editions,n=Object(c.useContext)(b.a).features.get(De.TOGGLZ_FEATURES.OTHER_LANGUAGES_BUTTON);if(!t)return null;var r=function(){var e=t.getIn(["brief","primaryLanguage"]);return!e||!n&&"eng"===e?null:l.a.createElement("span",{className:"bib-language"},l.a.createElement(d.FormattedMessage,{id:"LANGUAGE."+e}),n&&l.a.createElement(ao,null))}(),i=function(){var e=["CDROM","VIDEO_GAME"].includes(t.getIn(["brief","format"])),n=a&&a.size>0;if(!e&&!n)return null;var r=t.getIn(["brief","otherScriptEdition"]),i=t.getIn(["brief","edition"]);return l.a.createElement("span",{className:"bib-edition"},r,i&&r?"  ":null,i)}();return l.a.createElement("div",{className:"cp-edition-language"},i,r&&i?l.a.createElement(l.a.Fragment,null,"  "):null,r)}var ro=Object(m.connect)((function(e,t){return{catalogBib:t.catalogBib||Object(E.b)(e),editions:H(e)}}))((function(e){return l.a.createElement(no,e)})),io=a(2423),oo=a.n(io),co=a(2756),lo=a.n(co);function so(e){var t=e.excerpt,a=e.catalogBib,n=e.bib,r=e.googlePreviewAvailable,i=a.get("metadataId"),o=Object(c.useRef)(null);Object(c.useEffect)((function(){if(!r)return function(){};window.google||oo()("https://www.google.com/books/jsapi.js",(function(){return window.google.books.load()}));var e=setInterval((function(){var t;window.google&&window.google.books.DefaultViewer&&(t=n.getIn(["briefInfo","isbns"]).map((function(e){return"ISBN:"+e})).toJS(),new window.google.books.DefaultViewer(o.current).load(t),clearInterval(e))}),50);return function(){return clearInterval(e)}}),[n,r]);var s=r?"medium":"small";return l.a.createElement(ut.FullScreenOverlayBody,{className:"cp-bib-excerpt-overlay"},l.a.createElement(ut.FullScreenOverlayHeader,{title:l.a.createElement(d.FormattedMessage,{id:"read_excerpt"})}),l.a.createElement(ut.FullScreenOverlayContent,{size:s},l.a.createElement(dt.b,{metadataId:i}),r?l.a.createElement("div",{className:"google-book-preview",ref:o}):l.a.createElement("span",{dangerouslySetInnerHTML:{__html:t}})))}var uo=Ge.bibMetadataEventComposer.composeExcerptClickEvent,mo=function(e){function t(){for(var t,a=arguments.length,n=new Array(a),r=0;r<a;r++)n[r]=arguments[r];return(t=e.call.apply(e,[this].concat(n))||this).state={open:!1,googlePreviewAvailable:!1},t.handleOpen=function(){t.setState({open:!0}),Object(Ve.sendAnalyticsEvents)(uo())},t.handleClose=function(){return t.setState({open:!1})},t.renderExcerptLink=function(){var e=t.props.catalogBib.get("brief").get("title");return l.a.createElement(qe.SecondaryLink,{href:"#excerpt-overlay",dataKey:"excerpt-link",handleClick:t.handleOpen,preventDefault:!0},l.a.createElement("span",{"aria-hidden":!0},l.a.createElement(d.FormattedMessage,{id:"read_excerpt"})),l.a.createElement(Ye.a,null,l.a.createElement(d.FormattedMessage,{id:"sr_read_excerpt",values:{title:e}})))},t}o()(t,e);var a=t.prototype;return a.componentDidMount=function(){var e=this;if(this.props.currentLibrary.get("googleBook")){var t="https://books.google.com/books?jscmd=viewapi&bibkeys="+this.props.bib.getIn(["briefInfo","isbns"],O.a.List()).join(",");oo()(t,(function(){lo()(window._GBSBookInfo,(function(e){return"noview"!==e.preview}))&&e.setState({googlePreviewAvailable:!0})}))}},a.render=function(){return this.props.excerpt||this.state.googlePreviewAvailable?l.a.createElement("div",{className:"cp-bib-excerpt"},this.renderExcerptLink(),l.a.createElement(Qe.a,{open:this.state.open,handleClose:this.handleClose,overlayKey:"bib-excerpt-full-screen-overlay",dataKey:"bib-excerpt-full-screen-overlay"},this.state.open&&l.a.createElement(so,r()({},this.props,{googlePreviewAvailable:this.state.googlePreviewAvailable})))):null},t}(l.a.PureComponent),po=function(e){function t(){return e.apply(this,arguments)||this}return o()(t,e),t.prototype.render=function(){return l.a.createElement(mo,this.props)},t}(l.a.PureComponent),fo=Object(m.connect)((function(e){var t=Object(E.b)(e);return{excerpt:W(e),catalogBib:t,bib:Object(C.d)(e).get(t.get("metadataId")),currentLibrary:Object(k.b)(e)}}))(po),go=function(e){return e.getIn(["bibs","availability"],O.a.Map())},ho=Object(_.createSelector)([go],(function(e){return e.get("errorClassification")})),bo=Object(_.createSelector)([go,C.e],(function(e,t){return e.get("items",O.a.List()).map((function(e){return t.get(e)}))})),vo=Object(_.createSelector)([go,C.M],(function(e,t){return e.get("subscriptions",O.a.List()).map((function(e){return t.get(e.toString())}))})),Eo=Object(_.createSelector)([go,C.t],(function(e,t){return e.get("holdings",O.a.List()).map((function(e){return t.get(e.toString())}))})),yo=Object(_.createSelector)([go],(function(e){return e.get("probes")})),Io=a(2381),So=a.n(Io),Oo=a(2471),_o=a.n(Oo),Co=function(e){function t(){return e.apply(this,arguments)||this}o()(t,e);var a=t.prototype;return a.renderAvailabilityText=function(){return this.props.availability.get("localisedStatus")?l.a.createElement(So.a,{status:this.props.availability.get("localisedStatus"),rollUpStatus:this.props.availability.get("statusType"),availabilityLocationType:this.props.availability.get("availabilityLocationType")}):l.a.createElement(d.FormattedMessage,{id:"check_title_for_availability"})},a.render=function(){return l.a.createElement("div",{className:"cp-connected-library-hold-availability"},l.a.createElement("div",{className:"library-image"},l.a.createElement(_o.a,{circled:!0,small:!0,siteId:this.props.library.get("siteId")})),l.a.createElement("div",{className:"holdings-info"},l.a.createElement(qe.ChevronLink,{href:this.props.bibUrl,dataKey:"connected-library-link",className:"library-name"},l.a.createElement("span",null,this.props.library.get("fullName"))),this.renderAvailabilityText()))},t}(l.a.PureComponent),ko=function(e){function t(){return e.apply(this,arguments)||this}return o()(t,e),t.prototype.render=function(){var e=this,t=this.props.probes&&this.props.probes.size;return this.props.currentLibrary.get("showProbesOnBib")&&t>0&&!this.context.mobileApp?l.a.createElement("div",{className:"cp-connected-library-panel"},l.a.createElement("div",{className:"connected-library-panel__text"},l.a.createElement(d.FormattedMessage,{id:"circ_also_available"})),this.props.probes.map((function(t){return l.a.createElement(Co,{bibUrl:t.get("bibUrl"),library:e.props.libraries.get(t.get("libraryId").toString()),availability:e.props.availabilities.get(t.get("metadataId")),key:t.get("libraryId")})}))):null},t}(l.a.PureComponent);ko.contextType=b.a;var Ao=ko,No=function(e){function t(){return e.apply(this,arguments)||this}return o()(t,e),t.prototype.render=function(){return l.a.createElement(Ao,this.props)},t}(l.a.PureComponent),To=Object(m.connect)((function(e){return{probes:yo(e),libraries:Object(C.v)(e),availabilities:Object(C.c)(e),currentLibrary:Object(k.b)(e)}}))(No),Mo=a(80);var jo=function(e){var t=e.currentLibrary,a=e.catalogBib,n=Object(d.useIntl)(),r=t.get("showProbesOnBib"),i=t.get("showExternalSearchLink"),o=t.getIn(["externalSearch","externalSearchLinkTitle"])||"",c=t.getIn(["externalSearch","externalSearchLinkTitleWithAuthor"])||"",s=function(){if(i&&c&&!r){var e=a.getIn(["brief","creators",0,"searchQuery"]),t=a.getIn(["brief","title"]);return e?c.replace("{t}",Object(Mo.fixedEncodeURIComponent)(t)).replace("{a}",Object(Mo.fixedEncodeURIComponent)(e)):o.replace("{q}",Object(Mo.fixedEncodeURIComponent)(t))}return null}();if(s){var u=t.getIn(["externalSearch","nearbyLibrariesViaExternalSearchLink"])||n.formatMessage({id:"external_search_link"});return l.a.createElement("div",{className:"cp-external-search-link-panel"},l.a.createElement("div",{className:"external-search-link-panel__text"},l.a.createElement(d.FormattedMessage,{id:"find_this_title_on"})),l.a.createElement(qe.Link,{className:"external-search-link",handleClick:function(){Object(Ve.sendAnalyticsEvents)(Ge.searchEventComposer.composeExternalSearchPanelClickEvent({outboundURL:s,linkText:u}))},href:s,dataKey:"external-search-link"},u))}return null};var Fo=function(){var e={currentLibrary:Object(m.useSelector)(k.b),catalogBib:Object(m.useSelector)(E.b)};return!Object(c.useContext)(b.a).mobileApp&&l.a.createElement(jo,e)},Lo=Object(_.createSelector)([function(e){return e.getIn(["bibs","digitalFormats"],O.a.Map())}],(function(e){return e.map((function(e){return e.get("formats",O.a.List())}))})),wo=a(34),Bo=a.n(wo),Ro=a(10),Do=a(511),Po=a.n(Do),xo=a(23),Uo=function(e){function t(t){var a;return(a=e.call(this,t)||this).state={addToShelf:!1},Object(xt.bindAll)(Pt()(a)),a}o()(t,e);var a=t.prototype;return a.handleShelfChange=function(e){this.setState({addToShelf:e})},a.handleCancelHold=function(){var e=this,t=this.props,a=t.bib,n=t.holdItem,r=t.currentAccount,i=t.handleClose,o=t.holdActions,c=t.shelfActions;o.cancelHold({accountId:r.get("id"),metadataIds:[a.get("id")],holdIds:[n.get("holdsId")],postSuccess:function(){e.state.addToShelf?c.addToShelf({metadataId:a.get("id"),shelfToAdd:xo.e.FOR_LATER,postSuccess:i}):i()}})},a.renderShelfCheckbox=function(){return l.a.createElement("div",null,l.a.createElement("p",null,l.a.createElement(d.FormattedMessage,{id:"keep_a_reference",tagName:"strong"})),l.a.createElement(Po.a,{id:"add-to-shelf-checkbox",dataKey:"add-to-shelf-checkbox",label:l.a.createElement(d.FormattedMessage,{id:"add_title_to_for_later_shelf"}),checked:this.state.addToShelf,handleChange:this.handleShelfChange}))},a.render=function(){var e=this.props,t=e.bib,a=e.shelfTransactions,n=e.holdItem,r=e.holdsTransactions.getIn([n.get("holdsId"),"isCancelling"],!1),i=a.getIn([t.get("id"),"isAdding"],!1);return l.a.createElement("div",{className:"cp-cancel-hold-form"},l.a.createElement(gi.ModalHeader,{title:l.a.createElement(d.FormattedMessage,{id:"cancel_hold"})}),l.a.createElement(gi.ModalContent,null,l.a.createElement(dt.b,{metadataId:t.get("id")}),l.a.createElement("p",{className:"cancel-hold-description"},l.a.createElement(d.FormattedMessage,{id:"cancel_hold_description"})),this.renderShelfCheckbox()),l.a.createElement(gi.ModalFooter,{primaryActionButtonTag:Pe.TransactionalSolidButton,primaryActionButtonText:l.a.createElement(d.FormattedMessage,{id:"cancel_hold"}),handlePrimaryAction:this.handleCancelHold,isLoading:r||i}))},t}(l.a.PureComponent),Ko=function(e){function t(t){var a;return a=e.call(this,t)||this,Object(xt.bindAll)(Pt()(a)),a.modalKey="cancel-hold-modal-"+a.props.bib.get("id"),a}o()(t,e);var a=t.prototype;return a.handleOpen=function(){this.props.modalActions.openModal(this.modalKey,{accountRequired:!0})},a.handleClose=function(){this.props.modalActions.closeModal(this.modalKey)},a.renderModal=function(){var e=this.props,t=e.bib,a=e.currentAccount,n=e.holdItem,r=e.holdsTransactions,i=e.shelfTransactions,o=e.holdActions,c=e.shelfActions;return l.a.createElement(Hn.a,{modalKey:this.modalKey,handleClose:this.handleClose},l.a.createElement(Uo,{bib:t,currentAccount:a,holdItem:n,holdsTransactions:r,shelfTransactions:i,handleClose:this.handleClose,holdActions:o,shelfActions:c}))},a.render=function(){return l.a.createElement("div",{className:"cp-cancel-hold-button"},l.a.createElement(Pe.SecondarySolidButton,{block:!0,handleClick:this.handleOpen,disabled:this.props.disabled},l.a.createElement(d.FormattedMessage,{id:"cancel_hold"})),this.renderModal())},t}(l.a.PureComponent),Ho=a(215),zo=a(150),qo=a(513),Vo=a(189),Go=function(e){function t(){return e.apply(this,arguments)||this}return o()(t,e),t.prototype.render=function(){return l.a.createElement(Ko,this.props)},t}(l.a.PureComponent),Wo=Object(m.connect)((function(e,t){var a=t.bib.get("id"),n=Object(qo.a)(e).get(a,O.a.List());return{holdItem:1===n.size?n.first():null,currentAccount:Object(At.b)(e),holdsTransactions:Object(qo.i)(e),shelfTransactions:Object(Vo.e)(e)}}),(function(e){return{holdActions:Object(p.bindActionCreators)(Ho.default,e),shelfActions:Object(p.bindActionCreators)(zo.a,e),modalActions:Object(p.bindActionCreators)(Bn.a,e)}}))(Go),Yo=a(2449),Qo=a(308);var Zo=Object(d.injectIntl)((function(e){var t,a,n,r,i=e.currentAccount,o=e.branches,c=e.preferredBranches,s=e.handleChange,u=e.selectedBranchCode,m=e.intl;return o.size>0?l.a.createElement("div",{className:"cp-pickup-branch-select"},(r=i.get("preferredLocations",O.a.List()),!u&&!c.size&&r.size>0?l.a.createElement(Qo.WarningAlert,null,l.a.createElement(d.FormattedMessage,{id:"reselect_pickup_location_prompt"})):null),l.a.createElement("label",{htmlFor:"place-hold-branch-select"},l.a.createElement(d.FormattedMessage,{id:"pick_up_at"})),(t=O.a.Map(c.map((function(e){return[e.get("code"),e]}))),a=o.filter((function(e){return!t.get(e.get("code"))})),n=function(e){return l.a.createElement(xn.SelectOption,{key:e.get("code"),value:e.get("code")},e.get("name"))},l.a.createElement(xn.Select,{id:"place-hold-branch-select",dataKey:"branch-select",name:"branch",value:u,handleChange:s,prompt:m.formatMessage({id:"form_label_select_a_branch"})},c.map(n),c.size>0&&l.a.createElement(xn.SelectDivider,null),a.map(n)))):null})),Xo=function(e){function t(t){var a;return(a=e.call(this,t)||this).state={selectedBranchCode:t.preferredBranches.first()?t.preferredBranches.first().get("code"):"",enableSingleClickHolds:!1},Object(xt.bindAll)(Pt()(a)),a}o()(t,e);var a=t.prototype;return a.handleBranchChange=function(e){this.setState({selectedBranchCode:e})},a.handleSingleClickHoldsChange=function(e){this.setState({enableSingleClickHolds:e})},a.handlePlaceHold=function(){var e=this.props,t=e.bib,a=e.currentAccount,n=e.reciprocalRank,r=e.handleClose,i=e.holdActions,o=this.state,c=o.enableSingleClickHolds,l=o.selectedBranchCode;i.placeHold({postSuccess:r,materialType:eo.j,accountId:a.get("id"),metadataId:t.get("id"),enableSingleClickHolds:c,reciprocalRank:n,materialParams:{branchId:l,expiryDate:null}})},a.renderBranchSelect=function(){var e=this.props,t=e.currentAccount,a=e.branches,n=e.preferredBranches;return l.a.createElement(Zo,{branches:a,preferredBranches:n,currentAccount:t,selectedBranchCode:this.state.selectedBranchCode,handleChange:this.handleBranchChange})},a.renderSingleClickHoldsCheckbox=function(){return l.a.createElement("div",null,l.a.createElement(Po.a,{id:"single-click-holds-checkbox",dataKey:"single-click-holds-checkbox","aria-describedby":"single-click-description",label:l.a.createElement(d.FormattedMessage,{id:"place_hold_single_click_label"}),checked:this.state.enableSingleClickHolds,handleChange:this.handleSingleClickHoldsChange}),l.a.createElement("div",{className:"single-click-description",id:"single-click-description"},l.a.createElement(d.FormattedMessage,{id:"place_hold_single_click_description"})))},a.render=function(){var e=this.props,t=e.bib,a=e.currentLibrary,n=e.holdsTransactions.getIn([t.get("id"),"isPlacingHold"],!1),r=a.get("holdInfoMessages",O.a.List());return l.a.createElement("div",{className:"cp-physical-hold-form"},l.a.createElement(gi.ModalHeader,{title:l.a.createElement(d.FormattedMessage,{id:"place_hold"})}),l.a.createElement(gi.ModalContent,null,l.a.createElement(dt.b,{metadataId:t.get("id")}),l.a.createElement(Yo.a,{messageIds:r}),this.renderBranchSelect(),this.renderSingleClickHoldsCheckbox()),l.a.createElement(gi.ModalFooter,{primaryActionButtonTag:Pe.TransactionalSolidButton,primaryActionButtonText:l.a.createElement(d.FormattedMessage,{id:"place_hold"}),handlePrimaryAction:this.handlePlaceHold,disabled:!this.state.selectedBranchCode,isLoading:n}))},t}(l.a.PureComponent),Jo=a(2589),$o=a.n(Jo),ec=a(2455),tc=a.n(ec);function ac(e,t){switch(t){case"availability.libraryStatus":var a=e.getIn(["availability","libraryStatus"]);return a&&l.a.createElement("span",null,a);case"dueDate":var n=e.get("dueDate");return n&&l.a.createElement(rn.a,{value:n});default:return e.getIn(t.split("."))}}var nc=function(e){function t(t){var a;return a=e.call(this,t)||this,Object(xt.bindAll)(Pt()(a)),a.state={currentSortField:null,currentSortDirection:"asc"},a}o()(t,e);var a=t.prototype;return a.getSupportedFields=function(){var e=this.props.currentLibrary,t=["callNumber","volume","copy"],a=e.get("showVolumeSelectorCollection"),n=e.get("showVolumeSelectorStatus"),r=e.get("showVolumeSelectorDueDate");return a&&t.unshift("collection"),n&&t.push("availability.libraryStatus"),r&&t.push("dueDate"),t.unshift("itemId"),t},a.getTableItems=function(e){var t=this.state,a=t.currentSortField,n=t.currentSortDirection;return(a?this.props.holdableItems.sort($o()(a,n)):this.props.holdableItems).map((function(t){return O.a.Map(e.map((function(e){return[e,ac(t,e)]})))}))},a.handleSort=function(e){this.state.currentSortField===e?this.setState((function(e){return{currentSortDirection:"asc"===e.currentSortDirection?"desc":"asc"}})):this.setState({currentSortField:e,currentSortDirection:"asc"})},a.renderSingleSelectionControl=function(e){var t=this,a=this.props.holds.some((function(t){return t.get("itemId")===e.get("itemId")}));return l.a.createElement(tc.a,{checked:this.props.selectedItems.includes(e.get("itemId")),className:"select-single",disabled:a,handleChange:function(){return t.props.handleSingleSelect(e)},id:"row-select-"+e.get("itemId"),label:e.get("callNumber"),name:"select-single",srOnlyLabel:!0,value:e.get("itemId")})},a.renderBatchSelectionControl=function(e){var t=this,a=this.props.holds.some((function(t){return t.get("itemId")===e.get("itemId")}));return l.a.createElement(Po.a,{checked:this.props.selectedItems.includes(e.get("itemId")),dataKey:"select-multiple",disabled:a,handleChange:function(){return t.props.handleBatchSelect(e)},id:"row-select-"+e.get("itemId"),label:e.get("callNumber"),name:"select-multiple",srOnlyLabel:!0,value:e.get("itemId")})},a.renderSelectionControl=function(e){return this.props.bib.getIn(["policy","materialPolicy"],O.a.Map()).get("supportsBatchVolumeHolds")?this.renderBatchSelectionControl(e):this.renderSingleSelectionControl(e)},a.renderCaption=function(){var e=this.state,t=e.currentSortField,a=e.currentSortDirection;return t&&a&&l.a.createElement(d.FormattedMessage,{id:"table_sorted_by",values:{field:l.a.createElement(d.FormattedMessage,{id:t}),direction:l.a.createElement(d.FormattedMessage,{id:a})}})},a.renderTableHeader=function(e){var t=this,a=this.state,n=a.currentSortField,r=a.currentSortDirection,i=l.a.createElement(Yt.TableHeading,null,l.a.createElement(Ye.a,null,l.a.createElement(d.FormattedMessage,{id:"table_headings_item_select"})));return l.a.createElement(Yt.TableHeader,null,i,e.map((function(e){return l.a.createElement(Yt.TableHeading,{sortable:!0,sortDirection:n===e?r:void 0,handleSort:function(){return t.handleSort(e)},key:e},l.a.createElement(d.FormattedMessage,{id:e}))})))},a.renderRow=function(e,t){var a=this;return l.a.createElement(Yt.TableRow,{className:"bib-item-row",key:e.get("itemId"),selected:this.props.selectedItems.includes(e.get("itemId")),renderSelectionControl:function(){return a.renderSelectionControl(e)}},t.map((function(t){return l.a.createElement(Yt.TableCell,{key:t,label:l.a.createElement(d.FormattedMessage,{id:t}),blockLabel:!0},e.get(t))})))},a.render=function(){var e=this,t=this.getSupportedFields(),a=this.getTableItems(t),n=t.filter((function(e){return"itemId"!==e&&a.some((function(t){return!!t.get(e)}))}));return l.a.createElement("div",{className:"cp-item-level-holds-table"},l.a.createElement(Yt.Table,{caption:this.renderCaption()},this.renderTableHeader(n),l.a.createElement(Yt.TableBody,null,a.map((function(t){return e.renderRow(t,n)})))))},t}(l.a.PureComponent),rc=function(e){function t(t){var a;return a=e.call(this,t)||this,Object(xt.bindAll)(Pt()(a)),a.state={selectedBranchCode:t.preferredBranches.first()?t.preferredBranches.first().get("code"):"",selectedItems:O.a.Set()},a}o()(t,e);var a=t.prototype;return a.handleBranchChange=function(e){this.setState({selectedBranchCode:e})},a.select=function(e){this.setState((function(t){return{selectedItems:t.selectedItems.add(e)}}))},a.unselect=function(e){this.setState((function(t){return{selectedItems:t.selectedItems.delete(e)}}))},a.handleSingleSelect=function(e){this.setState({selectedItems:O.a.Set([e.get("itemId")])})},a.handleBatchSelect=function(e){return this.state.selectedItems.includes(e.get("itemId"))?this.unselect(e.get("itemId")):this.select(e.get("itemId"))},a.handleSubmit=function(e){e.preventDefault(),this.props.holdActions.placeItemHold({metadataId:this.props.metadataId,itemIds:this.state.selectedItems.toJS(),branchId:this.state.selectedBranchCode,postSuccess:this.props.handleClose})},a.renderBranchSelect=function(){var e=this.props,t=e.currentAccount,a=e.branches,n=e.preferredBranches;return l.a.createElement(Zo,{branches:a,preferredBranches:n,currentAccount:t,selectedBranchCode:this.state.selectedBranchCode,handleChange:this.handleBranchChange})},a.renderConfirmButton=function(){var e=this.props,t=e.metadataId,a=e.holdsTransactions.getIn([t,"isPlacingHold"],!1),n=!this.state.selectedItems.toJS().some(Boolean);return l.a.createElement(Pe.TransactionalSolidButton,{className:"confirm-hold-button",dataKey:"confirm-hold-button",isLoading:a,disabled:n,type:"submit"},l.a.createElement(d.FormattedMessage,{id:"button_confirm_hold"}))},a.render=function(){var e=this;return l.a.createElement(ut.FullScreenOverlayBody,{className:"cp-item-level-holds-form",tagName:"form",onSubmit:this.handleSubmit},l.a.createElement(ut.FullScreenOverlayHeader,{title:l.a.createElement(d.FormattedMessage,{id:"place_hold"})}),l.a.createElement(ut.FullScreenOverlayContent,null,l.a.createElement(dt.b,{metadataId:this.props.bib.get("id")}),this.renderBranchSelect(),this.props.isFetching?l.a.createElement(Yt.TableStencil,null):l.a.createElement(nc,{selectedItems:this.state.selectedItems,handleSingleSelect:function(t){return e.handleSingleSelect(t)},handleBatchSelect:function(t){return e.handleBatchSelect(t)},bib:this.props.bib,holdableItems:this.props.holdableItems,currentLibrary:this.props.currentLibrary,holds:this.props.holds})),l.a.createElement(ut.FullScreenOverlayFooter,{renderPrimaryAction:this.renderConfirmButton}))},t}(l.a.PureComponent),ic=Object(_.createSelector)([function(e){return e.getIn(["bibs","holdableItems"],O.a.Map())},C.s],(function(e,t){return e.get("items",O.a.List()).map((function(e){return t.get(e)}))})),oc=function(e){function t(){return e.apply(this,arguments)||this}o()(t,e);var a=t.prototype;return a.componentDidMount=function(){this.props.bibsActions.fetchHoldableItems(this.props.metadataId)},a.render=function(){return l.a.createElement(rc,this.props)},t}(l.a.PureComponent),cc=Object(m.connect)((function(e,t){return{isFetching:e.getIn(["bibs","holdableItems","isFetching"],!1),bib:Object(C.d)(e).get(t.metadataId),holdableItems:ic(e),branches:Object(k.f)(e),currentAccount:Object(At.b)(e),currentLibrary:Object(k.b)(e),holds:Object(qo.a)(e).get(t.metadataId,O.a.Map()),holdsTransactions:Object(qo.i)(e),preferredBranches:Object(k.a)(e)}}),(function(e){return{bibsActions:Object(p.bindActionCreators)(fn.a,e),holdActions:Object(p.bindActionCreators)(Ho.default,e)}}))(oc),lc=function(e){function t(t){var a;return a=e.call(this,t)||this,Object(xt.bindAll)(Pt()(a)),a.modalKey="physical-hold-modal-"+a.props.bib.get("id"),a}o()(t,e);var a=t.prototype;return a.componentDidUpdate=function(e){var t=this.props,a=t.bib,n=t.holdActions,r=t.holdError;!e.holdError&&r&&"HoldIsItemLevel"===r.get("classification")&&(this.handleModalClose(),n.openItemLevelHolds({metadataId:a.get("id")}))},a.handleModalClose=function(){this.props.modalActions.closeModal(this.modalKey)},a.handleOverlayClose=function(){this.props.holdActions.closeItemLevelHolds({metadataId:this.props.bib.get("id")})},a.handleButtonClick=function(){var e=this.props,t=e.bib,a=e.holdActions,n=t.get("id"),r=t.get("policy",O.a.Map());return r.getIn(["materialPolicy","itemLevelHoldsPredetermined"])&&r.get("itemLevelHoldableItems")?a.openItemLevelHolds({metadataId:n}):a.startPlaceHold({metadataId:n,modalKey:this.modalKey})},a.renderItemLevelHoldsOverlay=function(){var e=this.props,t=e.bib,a=e.holdsTransactions,n=t.get("id"),r=a.getIn([n,"itemLevelHoldsOpen"],!1);return l.a.createElement(Qe.a,{open:r,handleClose:this.handleOverlayClose,overlayKey:"item-level-holds-full-screen-overlay",dataKey:"item-level-holds-full-screen-overlay"},r&&l.a.createElement(cc,{metadataId:n,handleClose:this.handleOverlayClose}))},a.renderPhysicalHoldModal=function(){var e=this,t=this.props,a=t.bib,n=t.branches,r=t.preferredBranches,i=t.currentAccount,o=t.currentLibrary,c=t.holdsTransactions,s=t.holdActions;return i&&l.a.createElement(Hn.a,{modalKey:this.modalKey,handleClose:this.handleModalClose},l.a.createElement(Xo,{bib:a,branches:n,preferredBranches:r,currentAccount:i,currentLibrary:o,holdsTransactions:c,handleClose:this.handleModalClose,holdActions:s,ref:function(t){e.holdFormRef=t}}))},a.render=function(){var e=this.props,t=e.bib,a=e.disabled,n=e.holdsTransactions,r=!this.holdFormRef&&n.getIn([t.get("id"),"isPlacingHold"],!1);return l.a.createElement("div",{className:"cp-physical-hold-button"},l.a.createElement(Pe.TransactionalSolidButton,{block:!0,handleClick:this.handleButtonClick,disabled:a,isLoading:r},l.a.createElement(d.FormattedMessage,{id:"place_hold"})),this.renderPhysicalHoldModal(),this.renderItemLevelHoldsOverlay())},t}(l.a.PureComponent),sc=function(e){function t(){return e.apply(this,arguments)||this}return o()(t,e),t.prototype.render=function(){return l.a.createElement(lc,this.props)},t}(l.a.PureComponent),uc=Object(m.connect)((function(e){return{branches:Object(k.f)(e),preferredBranches:Object(k.a)(e),currentAccount:Object(At.b)(e),currentLibrary:Object(k.b)(e),holdsTransactions:Object(qo.i)(e),holdError:Object(qo.f)(e)}}),(function(e){return{holdActions:Object(p.bindActionCreators)(Ho.default,e),modalActions:Object(p.bindActionCreators)(Bn.a,e)}}))(sc),dc=a(397),mc=a.n(dc),pc=function(e){function t(t){var a,n;return(n=e.call(this,t)||this).state={digitalNotificationEmail:null===(a=n.props.currentAccount)||void 0===a?void 0:a.get("digitalNotificationEmail"),autoCheckoutsEnabled:!1},Object(xt.bindAll)(Pt()(n)),n}o()(t,e);var a=t.prototype;return a.handleEmailChange=function(e){this.setState({digitalNotificationEmail:e})},a.handleAutoCheckoutChange=function(e){this.setState({autoCheckoutsEnabled:e})},a.handleDigitalHold=function(){var e=this.props,t=e.holdActions,a=e.bib,n=e.handleClose,r=e.currentAccount,i=this.state,o=i.digitalNotificationEmail,c=i.autoCheckoutsEnabled;t.placeHold({accountId:r.get("id"),metadataId:a.get("id"),postSuccess:n,materialType:eo.i,enableSingleClickHolds:!1,materialParams:{email:o,autoCheckout:c}})},a.renderAutoCheckoutsCheckbox=function(){return this.props.bib.getIn(["policy","materialPolicy","supportAutoCheckout"])?l.a.createElement("div",{className:"digital-hold-auto-checkout"},l.a.createElement(Po.a,{id:"auto-checkout-checkbox",dataKey:"auto-checkout-checkbox","aria-describedby":"auto-checkout-description",label:l.a.createElement(d.FormattedMessage,{id:"enable_auto_checkout"}),checked:this.state.autoCheckoutsEnabled,handleChange:this.handleAutoCheckoutChange}),l.a.createElement("div",{className:"enable-auto-checkout-description",id:"digital-hold-description"},l.a.createElement(d.FormattedMessage,{id:"enable_auto_checkout_info"}))):null},a.renderNotificationEmailTextField=function(){return l.a.createElement("div",{className:"digital-hold-notification-email"},l.a.createElement(mc.a,{label:l.a.createElement(d.FormattedMessage,{id:"notification_email"}),type:"email",id:"digital-notification",onChange:this.handleEmailChange,value:this.state.digitalNotificationEmail,size:"large"}))},a.render=function(){var e=this.props,t=e.bib,a=e.holdsTransactions,n=e.digitalFormats,r=e.intl,i=a.getIn([t.get("id"),"isPlacingHold"],!1),o=n.map((function(e){return r.formatMessage({id:"digiformat_"+e.get("name").toLowerCase()})}));return l.a.createElement("div",{className:"cp-digital-hold-form"},l.a.createElement(gi.ModalHeader,{title:l.a.createElement(d.FormattedMessage,{id:"place_hold"})}),l.a.createElement(gi.ModalContent,null,l.a.createElement(dt.b,{metadataId:t.get("id")}),l.a.createElement("div",{className:"digital-hold-available-format"},l.a.createElement(d.FormattedMessage,{id:"available_as",values:{formats:o.join(", ")}})),this.renderNotificationEmailTextField(),this.renderAutoCheckoutsCheckbox()),l.a.createElement(gi.ModalFooter,{primaryActionButtonTag:Pe.TransactionalSolidButton,primaryActionButtonText:l.a.createElement(d.FormattedMessage,{id:"place_hold"}),isLoading:i,handlePrimaryAction:this.handleDigitalHold,disabled:!this.state.digitalNotificationEmail}))},t}(l.a.PureComponent),fc=Object(d.injectIntl)(pc),gc=function(e){function t(){return e.apply(this,arguments)||this}o()(t,e);var a=t.prototype;return a.renderModal=function(){var e=this.props,t=e.holdActions,a=e.handleClose,n=e.bib,r=e.modalKey,i=e.holdsTransactions,o=e.digitalFormats,c=e.currentAccount;return l.a.createElement(Hn.a,{modalKey:r,handleClose:a},l.a.createElement(fc,{bib:n,holdsTransactions:i,handleClose:a,holdActions:t,digitalFormats:o,currentAccount:c}))},a.render=function(){var e=this.props,t=e.disabled,a=e.handleOpen,n=e.isLoading;return l.a.createElement("div",{className:"cp-place-hold-button"},l.a.createElement(Pe.TransactionalSolidButton,{block:!0,isLoading:n,handleClick:a,disabled:t},l.a.createElement(d.FormattedMessage,{id:"place_hold"})),this.renderModal())},t}(l.a.PureComponent),hc=a(2419),bc=function(e){function t(t){var a;return a=e.call(this,t)||this,Object(xt.bindAll)(Pt()(a)),a}o()(t,e);var a=t.prototype;return a.handleOpen=function(){this.props.modalActions.openModal(this.props.modalKey,{accountRequired:!0})},a.render=function(){var e=this.props,t=e.checkoutItem,a=e.bib,n=e.intl,r=a.getIn(["policy","materialPolicy"],O.a.Map());if(t.get("downloadUrl")&&t.get("format"))return l.a.createElement(qe.Link,{className:"cp-download-button",target:"_blank",href:t.get("downloadUrl"),dataKey:"download-link"},l.a.createElement(d.FormattedMessage,{id:"download_now_format",values:{format:n.formatMessage({id:"digiformat_"+t.get("format").toLowerCase()})}}));if(r.get("supportsDownload"))return l.a.createElement(Pe.Button,{className:"cp-download-button",handleClick:this.handleOpen,dataKey:"download-button"},l.a.createElement(d.FormattedMessage,{id:"download"}));if(!t.get("thirdPartyReaderUrl")){var i=t.get("format")?r.get("helpUrl"):r.get("quickStartUrl");return l.a.createElement(qe.Link,{className:"cp-download-button",href:i,target:"_blank",dataKey:"download-help-link"},l.a.createElement(d.FormattedMessage,{id:"how_to_access_title"}))}return null},t}(l.a.PureComponent),vc=Object(d.injectIntl)(bc),Ec=a(2903),yc=a.n(Ec),Ic=function(e){function t(t){var a;return(a=e.call(this,t)||this).state={formatSelected:null},Object(xt.bindAll)(Pt()(a)),a}o()(t,e);var a=t.prototype;return a.componentDidMount=function(){var e=this.props,t=e.bib,a=e.digitalFormats,n=e.bibsActions;a||n.fetchDigitalFormats({metadataId:t.get("id")})},a.handleFormatChange=function(e){var t=this.props.digitalFormats.find((function(t){return t.get("name")===e}));this.setState({formatSelected:t.get("name")})},a.handleFormatLockIn=function(){var e=this.state.formatSelected,t=this.props,a=t.currentAccount,n=t.bib,r=t.checkoutActions,i=t.checkoutItem,o=t.handleClose;e&&r.lockInFormat({accountId:a.get("id"),checkoutId:i.get("checkoutId"),format:e,metadataId:n.get("id"),postSuccess:o,title:n.getIn(["briefInfo","title"])})},a.renderFormatSelectionCard=function(){var e=this;return this.props.digitalFormats.map((function(t){var a=t.get("name");return t.get("hasDownloadLink")?l.a.createElement(yc.a,{selected:a===e.state.formatSelected,value:a,label:l.a.createElement(d.FormattedMessage,{id:"digiformat_"+a.toLowerCase()}),name:"format",handleClick:e.handleFormatChange,key:a}):null}))},a.renderFormatSelector=function(){var e=this.props,t=e.digitalFormats,a=e.isLoading;return t&&t.size?l.a.createElement("div",{className:"format-selector"},l.a.createElement("div",{className:"format-selection-heading"},l.a.createElement(d.FormattedMessage,{id:"select_a_format"})),l.a.createElement("div",{className:"format-selection-cards"},this.renderFormatSelectionCard())):l.a.createElement("div",{className:"format-selector"},l.a.createElement("em",{className:"loading-indicator"},a?l.a.createElement(d.FormattedMessage,{id:"loading_formats"}):l.a.createElement(d.FormattedMessage,{id:"errors.DigitalFormats"}),l.a.createElement("span",{"aria-hidden":!0},"")))},a.render=function(){var e=this.props,t=e.bib,a=e.checkoutTransactions;return l.a.createElement("div",{className:"cp-download-form"},l.a.createElement(gi.ModalHeader,{title:l.a.createElement(d.FormattedMessage,{id:"download"})}),l.a.createElement(gi.ModalContent,null,l.a.createElement(dt.b,{metadataId:t.get("id")}),this.renderFormatSelector()),l.a.createElement(gi.ModalFooter,{primaryActionButtonTag:Pe.TransactionalSolidButton,primaryActionButtonText:l.a.createElement(d.FormattedMessage,{id:"download"}),disabled:!this.state.formatSelected,isLoading:a.getIn([t.get("id"),"isLockingFormat"]),handlePrimaryAction:this.handleFormatLockIn}))},t}(l.a.PureComponent),Sc=function(e){function t(t){var a;return a=e.call(this,t)||this,Object(xt.bindAll)(Pt()(a)),a}o()(t,e);var a=t.prototype;return a.handleClose=function(){this.props.modalActions.closeModal(this.props.modalKey)},a.render=function(){var e=this.props,t=e.digitalFormats,a=e.bib,n=e.checkoutTransactions,r=e.currentAccount,i=e.isLoading,o=e.bibsActions,c=e.checkoutActions,s=e.checkoutItem,u=e.modalKey;return l.a.createElement(Hn.a,{className:"cp-download-modal",modalKey:u,handleClose:this.handleClose},l.a.createElement(Ic,{bib:a,handleClose:this.handleClose,digitalFormats:t,checkoutTransactions:n,currentAccount:r,bibsActions:o,checkoutActions:c,checkoutItem:s,isLoading:i}))},t}(l.a.PureComponent);function Oc(e){var t=e.modalActions,a=e.modalKey;return l.a.createElement(Pe.Button,{className:"cp-fulfilment-button",handleClick:function(){t.openModal(a,{accountRequired:!0})},dataKey:"fulfilment-button"},l.a.createElement(d.FormattedMessage,{id:"access_this_item"}))}var _c=a(2418),Cc=function(e){function t(t){var a;return a=e.call(this,t)||this,Object(xt.bindAll)(Pt()(a)),a}o()(t,e);var a=t.prototype;return a.handleOpen=function(){this.props.modalActions.openModal(this.props.modalKey,{accountRequired:!0})},a.render=function(){return l.a.createElement(Pe.Button,{className:"cp-digital-return-button",handleClick:this.handleOpen},l.a.createElement(d.FormattedMessage,{id:"digital_return_now"}))},t}(l.a.PureComponent),kc=function(e){function t(){return e.apply(this,arguments)||this}return o()(t,e),t.prototype.render=function(){var e=this.props,t=e.checkoutItem,a=e.linkTag||qe.Link;return l.a.createElement(a,{target:"_blank",href:t.get("thirdPartyReaderUrl"),className:"cp-third-party-reader-link",dataKey:"third-party-reader-link"},l.a.createElement(d.FormattedMessage,{id:"open_in_third_party_reader"}))},t}(l.a.PureComponent);var Ac=function(e){function t(){return e.apply(this,arguments)||this}o()(t,e);var a=t.prototype;return a.getModalKey=function(e){return e+"-modal-"+this.props.bib.get("id")},a.fulfilmentWorkFlowEnabled=function(){var e=this.props.bib.getIn(["policy","provider"]);return this.context.features.get(De.TOGGLZ_FEATURES.NEW_OVERDRIVE_FULFILMENT_WORKFLOW)&&"OverDriveAPI"===e},a.renderDownloadModal=function(){var e=this.props,t=e.digitalFormats,a=e.bib,n=e.checkoutItem,r=e.isLoading,i=e.checkoutTransactions,o=e.currentAccount,c=e.bibsActions,s=e.checkoutActions,u=e.modalActions,d=a.getIn(["policy","materialPolicy"],O.a.Map());return!this.fulfilmentWorkFlowEnabled()&&d.get("supportsDownload")?l.a.createElement(Sc,{bib:a,modalKey:this.getModalKey("download"),bibsActions:c,modalActions:u,currentAccount:o,checkoutItem:n,checkoutTransactions:i,checkoutActions:s,digitalFormats:t,isLoading:r}):null},a.renderReturnDigitalCheckoutsModal=function(){var e=this.props,t=e.checkoutActions,a=e.checkoutItem,n=e.checkoutTransactions,r=e.currentAccount,i=e.bib,o=n.getIn([a.get("metadataId"),"isReturning"],!1),c=a.get("checkInEnabled"),s=a.get("metadataId"),u=a.get("checkoutId"),d=r.get("id");return i&&c?l.a.createElement(hc.a,{bib:i,modalKey:this.getModalKey("return"),modalActions:this.props.modalActions,shelfActions:this.props.shelfActions,isLoading:o,checkIn:t.digitalCheckIn,metadataId:s,checkoutId:u,accountId:d}):null},a.renderFulfilmentModal=function(){var e=this.props,t=e.bib,a=e.checkoutItem,n=e.currentAccount,r=e.checkoutActions,i=e.modalActions;return this.fulfilmentWorkFlowEnabled()?l.a.createElement(_c.a,{bib:t,modalKey:this.getModalKey("fulfilment"),accountId:n.get("id"),checkoutItem:a,checkoutActions:r,modalActions:i}):null},a.renderDigitalReturnOption=function(){var e=this.props,t=e.checkoutItem,a=e.modalActions;return t.get("checkInEnabled")&&l.a.createElement(Ya.DropdownMenuItem,null,l.a.createElement(Cc,{modalKey:this.getModalKey("return"),modalActions:a}))},a.renderThirdPartyReaderOption=function(){var e=this.props.checkoutItem;return!this.fulfilmentWorkFlowEnabled()&&e.get("thirdPartyReaderUrl")&&l.a.createElement(Ya.DropdownMenuItem,null,l.a.createElement(kc,{checkoutItem:e}))},a.renderDownloadOption=function(){var e=this.props,t=e.bib,a=e.checkoutItem,n=e.modalActions,r=e.digitalFormats;return!this.fulfilmentWorkFlowEnabled()&&r.some((function(e){return e.get("hasDownloadLink")}))?l.a.createElement(Ya.DropdownMenuItem,null,l.a.createElement(vc,{bib:t,modalActions:n,modalKey:this.getModalKey("download"),checkoutItem:a})):null},a.renderFulfilmentOption=function(){var e=this.props.modalActions;return this.fulfilmentWorkFlowEnabled()?l.a.createElement(Ya.DropdownMenuItem,null,l.a.createElement(Oc,{modalKey:this.getModalKey("fulfilment"),modalActions:e})):null},a.render=function(){return l.a.createElement("div",{className:"cp-checkedout-dropdown"},l.a.createElement(Ya.Dropdown,{block:!0,right:!0,className:"checked-out-dropdown",dataKey:"checked-out-dropdown",buttonTag:Pe.TransactionalSolidButton,renderLabel:function(){return l.a.createElement(d.FormattedMessage,{id:"checked_out"})}},this.renderFulfilmentOption(),this.renderDownloadOption(),this.renderThirdPartyReaderOption(),this.renderDigitalReturnOption(),l.a.createElement(Ya.DropdownMenuDivider,null),l.a.createElement(Ya.DropdownMenuItem,null,l.a.createElement(qe.Link,{href:"/v2/checkedout",dataKey:"view-all-checkedout"},l.a.createElement(d.FormattedMessage,{id:"view_all_checked_out"})))),this.renderDownloadModal(),this.renderReturnDigitalCheckoutsModal(),this.renderFulfilmentModal())},t}(l.a.PureComponent);Ac.contextType=b.a;var Nc=function(e){function t(t){var a;(a=e.call(this,t)||this).handleCheckout=function(){var e=a.props,t=e.currentAccount,n=e.checkoutActions,r=e.digitalFormats,i=e.bib,o=e.handleClose,c=r.find((function(e){return e.get("name")===a.state.formatSelected}));n.digitalCheckout({accountId:t.get("id"),metadataId:i.get("id"),title:i.get("title"),format:c,duration:a.state.durationSelected,postSuccess:o})},a.handleFormatChange=function(e){var t=a.props.digitalFormats.find((function(t){return t.get("name")===e}));a.setState({formatSelected:t.get("name"),durationSelected:t.get("durations").first()})},a.handleDurationChange=function(e){a.setState({durationSelected:e})};var n=t.bib,r=t.digitalFormats,i=n.getIn(["policy","materialPolicy"],O.a.Map()).get("requiresFormatDuringCheckout",!1)&&r.first();return a.state={formatSelected:i?i.get("name"):null,durationSelected:i?i.get("durations").first():null},a}o()(t,e);var a=t.prototype;return a.getFormatNames=function(){var e=this.props,t=e.intl;return e.digitalFormats.map((function(e){return t.formatMessage({id:"digiformat_"+e.get("name").toLowerCase()})}))},a.renderFormatSelectionCards=function(){var e=this;return this.props.digitalFormats.map((function(t){var a=t.get("name");return l.a.createElement(yc.a,{selected:a===e.state.formatSelected,value:a,label:l.a.createElement(d.FormattedMessage,{id:"digiformat_"+a.toLowerCase()}),name:"format",handleClick:e.handleFormatChange,key:a})}))},a.renderDurationSelectionCards=function(){var e=this;return this.props.digitalFormats.find((function(t){return t.get("name")===e.state.formatSelected})).get("durations").map((function(t){return l.a.createElement(yc.a,{selected:t===e.state.durationSelected,value:t,label:l.a.createElement(d.FormattedMessage,{id:"label_duration_length",values:{days:t}}),name:"duration",handleClick:e.handleDurationChange,key:t})}))},a.renderAvailableFormats=function(){var e=this.props.bib.getIn(["policy","materialPolicy"],O.a.Map()),t=e.get("showFormatDuringCheckout",!1),a=e.get("requiresFormatDuringCheckout",!1);return t&&!a?l.a.createElement(d.FormattedMessage,{id:"available_as",values:{formats:this.getFormatNames().join(", ")}}):null},a.renderDigitalFormats=function(){return this.props.bib.getIn(["policy","materialPolicy"],O.a.Map()).get("requiresFormatDuringCheckout",!1)?l.a.createElement("div",null,l.a.createElement("div",{className:"format-selector"},l.a.createElement(d.FormattedMessage,{id:"select_a_format"})),l.a.createElement("div",{className:"checkout-format-selector"},this.renderFormatSelectionCards())):null},a.renderDigitalFormatDurations=function(){return this.props.bib.getIn(["policy","materialPolicy"],O.a.Map()).get("requiresDuration",!1)?l.a.createElement("div",{className:"checkout-duration"},l.a.createElement("div",{className:"duration-selector"},l.a.createElement(d.FormattedMessage,{id:"select_a_duration"})),l.a.createElement("div",{className:"checkout-duration-selector"},this.renderDurationSelectionCards())):null},a.render=function(){var e=this.props,t=e.bib,a=e.checkoutTransactions.getIn([t.get("id"),"isCheckingOut"],!1);return l.a.createElement("div",{className:"cp-check-out-form"},l.a.createElement(gi.ModalHeader,{title:l.a.createElement(d.FormattedMessage,{id:"checkout"})}),l.a.createElement(gi.ModalContent,null,l.a.createElement(dt.b,{metadataId:t.get("id")}),l.a.createElement("div",{className:"check-out-available-format"},this.renderAvailableFormats(),this.renderDigitalFormats(),this.renderDigitalFormatDurations())),l.a.createElement(gi.ModalFooter,{primaryActionButtonTag:Pe.TransactionalSolidButton,primaryActionButtonText:l.a.createElement(d.FormattedMessage,{id:"checkout"}),isLoading:a,handlePrimaryAction:this.handleCheckout}))},t}(l.a.PureComponent),Tc=Object(d.injectIntl)(Nc),Mc=function(e){function t(){return e.apply(this,arguments)||this}o()(t,e);var a=t.prototype;return a.renderModal=function(){var e=this.props,t=e.bib,a=e.modalKey,n=e.handleClose,r=e.digitalFormats,i=e.checkoutActions,o=e.currentAccount,c=e.checkoutTransactions;return o&&l.a.createElement(Hn.a,{modalKey:a,handleClose:n},l.a.createElement(Tc,{bib:t,checkoutActions:i,handleClose:n,digitalFormats:r,currentAccount:o,checkoutTransactions:c}))},a.render=function(){var e=this.props,t=e.disabled,a=e.handleOpen,n=e.isLoading;return l.a.createElement("div",{className:"cp-check-out-button"},l.a.createElement(Pe.TransactionalSolidButton,{block:!0,isLoading:n,handleClick:a,disabled:t},l.a.createElement(d.FormattedMessage,{id:"checkout"})),this.renderModal())},t}(l.a.PureComponent),jc=function(e){function t(t){var a;return a=e.call(this,t)||this,Object(xt.bindAll)(Pt()(a)),a.modalKey="digital-access-modal-"+a.props.bib.get("id"),a}o()(t,e);var a=t.prototype;return a.handleOpen=function(){var e=this,t=this.props,a=t.bib,n=t.digitalFormats,r=t.bibsActions,i=t.modalActions,o=function(){return i.openModal(e.modalKey,{accountRequired:!0})};n?o():r.fetchDigitalFormats({metadataId:a.get("id"),postSuccess:o})},a.handleClose=function(){this.props.modalActions.closeModal(this.modalKey)},a.render=function(){var e=this.props,t=e.bib,a=e.realtimeAvailability,n=e.holdItem,r=e.checkoutItem,i=e.currentAccount,o=e.checkoutTransactions,c=e.holdsTransactions,s=e.bibsActions,u=e.holdActions,d=e.shelfActions,m=e.modalActions,p=e.checkoutActions,f=e.digitalFormats,g=e.isLoading,h=t.getIn(["policy","itemLevelHoldableItems"]),b=n&&n.get("status")===Ro.b.READY_FOR_PICKUP,v=a||t.get("availability");return r&&!h&&i?l.a.createElement(Ac,{bib:t,checkoutTransactions:o,checkoutActions:p,bibsActions:s,modalActions:m,digitalFormats:f,currentAccount:i,checkoutItem:r,shelfActions:d,isLoading:g}):b||"AVAILABLE"===v.get("status")?l.a.createElement(Mc,{bib:t,checkoutTransactions:o,checkoutActions:p,digitalFormats:f,currentAccount:i,handleOpen:this.handleOpen,handleClose:this.handleClose,isLoading:g,modalKey:this.modalKey}):l.a.createElement(gc,{bib:t,currentAccount:i,holdsTransactions:c,holdActions:u,digitalFormats:f,handleOpen:this.handleOpen,handleClose:this.handleClose,isLoading:g,modalKey:this.modalKey})},t}(l.a.PureComponent),Fc=a(305),Lc=a(2360),wc=function(e){function t(){return e.apply(this,arguments)||this}return o()(t,e),t.prototype.render=function(){return l.a.createElement(jc,this.props)},t}(l.a.PureComponent),Bc=Object(m.connect)((function(e,t){var a=t.bib.get("id"),n=Object(qo.a)(e).get(a,O.a.List()),r=Object(Lc.d)(e).get(a,O.a.List());return{isLoading:e.getIn(["bibs","digitalFormats",a,"isFetching"],!1),realtimeAvailability:Object(C.c)(e).get(a),digitalFormats:Lo(e).get(a),currentAccount:Object(At.b)(e),holdItem:1===n.size?n.first():null,checkoutItem:r.first(),checkoutTransactions:Object(Lc.c)(e),holdsTransactions:Object(qo.i)(e)}}),(function(e){return{bibsActions:Object(p.bindActionCreators)(fn.a,e),checkoutActions:Object(p.bindActionCreators)(Fc.default,e),holdActions:Object(p.bindActionCreators)(Ho.default,e),shelfActions:Object(p.bindActionCreators)(zo.a,e),modalActions:Object(p.bindActionCreators)(Bn.a,e)}}))(wc);var Rc=function(e){function t(){return e.apply(this,arguments)||this}o()(t,e);var a=t.prototype;return a.renderTransactionButton=function(){var e=this.props,t=e.bib,a=e.holdItem,n=t.getIn(["policy","itemLevelHoldableItems"]),r=t.getIn(["policy","materialType"])===eo.i,i=r&&a&&a.get("status")===Ro.b.READY_FOR_PICKUP,o=n&&a&&a.get("itemId");return!a||i||o?r?l.a.createElement(Bc,this.props):l.a.createElement(uc,this.props):l.a.createElement(Wo,this.props)},a.render=function(){var e=this.props,t=e.bib,a=e.block,n=e.isLoading;if(t.getIn(["policy","holdable"])){var r=Xe()("cp-title-transaction-button",{"title-transaction-button--block":a});return l.a.createElement("div",{className:r},n?l.a.createElement(Bo.a,{className:"button-placeholder",width:"120",height:"40",viewBox:"0 0 120 40",preserveAspectRatio:"none"},l.a.createElement("rect",{width:"120",height:"40",rx:"3"})):this.renderTransactionButton())}return null},t}(l.a.PureComponent),Dc=function(e){function t(){return e.apply(this,arguments)||this}return o()(t,e),t.prototype.render=function(){return l.a.createElement(Rc,this.props)},t}(l.a.PureComponent),Pc=Object(m.connect)((function(e,t){var a=Object(qo.a)(e).get(t.metadataId,O.a.List());return{isLoading:e.getIn(["bibs","userTransactions","isFetching"],!1),bib:Object(C.d)(e).get(t.metadataId),holdItem:1===a.size?a.first():null}}))(Dc),xc=a(2400),Uc=a(2975),Kc=a.n(Uc),Hc=function(e){function t(t){var a;return(a=e.call(this,t)||this).screenReaderMessage=function(e){return l.a.createElement(d.FormattedMessage,{id:"ada_add_to_different_shelf",values:{title:l.a.createElement(xc.a,{bibBrief:e.get("briefInfo")})}})},Object(xt.bindAll)(Pt()(a)),a}o()(t,e);var a=t.prototype;return a.handleClick=function(e){var t=this.props,a=t.bib,n=t.reciprocalRank;this.props.shelfActions.addToShelf({metadataId:a.get("id"),shelfToAdd:e,reciprocalRank:n})},a.getOptions=function(){var e=this.props,t=e.bib,a=e.primaryShelfName,n=t.get("briefInfo");return O.a.List(xo.a).sortBy((function(e){return e===a?0:1})).map((function(e){return O.a.Map({value:e,label:l.a.createElement("span",{className:"shelf-option"},e===a&&l.a.createElement(xe.ShelvesOutline,null),l.a.createElement("span",{"aria-hidden":!0},l.a.createElement(d.FormattedMessage,{id:"label_shelf_"+e})),l.a.createElement(Ye.a,null,l.a.createElement(d.FormattedMessage,{id:"ada_add_to_named_shelf",values:{title:l.a.createElement(xc.a,{bibBrief:n}),shelf:e}})))})}))},a.render=function(){var e=this,t=this.props,a=t.bib,n=t.rounded,r=t.disabled,i=t.shelfTransactions,o=t.iconOnly,c=i.getIn([a.get("id"),"isAdding"]);return l.a.createElement("div",{className:"cp-add-to-shelf-button"},o?l.a.createElement(Pe.IconButton,{dataKey:"add-to-shelf-button",className:"icon-only",isLoading:c,disabled:r,handleClick:function(){return e.handleClick(e.getOptions().first().get("value"))}},l.a.createElement(xe.ShelvesOutline,null),l.a.createElement(Ye.a,null,this.screenReaderMessage(a))):l.a.createElement(Kc.a,{block:!0,rounded:n,isLoading:c,disabled:r,handleClick:this.handleClick,options:this.getOptions(),dataKey:"add-to-shelf-button",renderDropdownLabel:function(){return e.screenReaderMessage(a)}}))},t}(l.a.PureComponent);Hc.defaultProps={primaryShelfName:xo.e.FOR_LATER};var zc=a(533),qc=a.n(zc),Vc=a(2751),Gc=a(2888);function Wc(e,t,a){return l.a.createElement("span",{className:"shelf-option"},!a&&l.a.createElement("span",{"aria-hidden":!0},l.a.createElement(d.FormattedMessage,{id:"label_shelf_"+e})),l.a.createElement(Ye.a,null,l.a.createElement(d.FormattedMessage,{id:"ada_add_to_named_shelf",values:{title:l.a.createElement(xc.a,{bibBrief:t}),shelf:e}})))}var Yc=function(e){function t(){for(var t,a=arguments.length,n=new Array(a),r=0;r<a;r++)n[r]=arguments[r];return(t=e.call.apply(e,[this].concat(n))||this).removeModalKey="remove-from-shelf-"+t.props.bib.get("id"),t.moveToShelf=function(e){var a=t.props,n=a.bib,r=a.shelfItem,i=a.reciprocalRank;t.props.shelfActions.updateShelfItems({shelfName:r.get("shelf"),newShelfName:e,shelfItemIds:[r.get("id")],metadataIds:[n.get("id")],privateItem:r.get("privateItem"),reciprocalRank:i})},t.toggleIOwnThis=function(){var e=t.props.bib.get("id"),a=t.props.iOwnThis;a?t.props.iOwnThisActions.removeIOwnThisSetting(e,a.get("id")):t.props.iOwnThisActions.createIOwnThisSetting(e)},t.togglePrivate=function(){var e=t.props,a=e.bib,n=e.shelfItem,r=e.reciprocalRank,i=n.get("privateItem");t.props.shelfActions.updateShelfItems({privateItem:!i,shelfName:n.get("shelf"),newShelfName:n.get("shelf"),shelfItemIds:[n.get("id")],metadataIds:[a.get("id")],reciprocalRank:r})},t.openRemovalModal=function(){t.props.modalActions.openModal(t.removeModalKey)},t.renderMoveToShelfOptions=function(){var e=t.props,a=e.bib,n=e.shelfItem,r=e.iconOnly,i=a.get("briefInfo"),o=n.get("shelf");return(r?xo.a:xo.a.filter((function(e){return e!==o}))).map((function(e){return l.a.createElement(Ya.DropdownMenuItem,{item:O.a.Map({label:Wc(e,i),value:e,selected:e===o}),key:e,handleClick:function(){return t.moveToShelf(e)},selectable:r})}))},t.renderLabel=function(){var e=t.props.shelfItem.get("shelf"),a=t.props.bib.get("briefInfo"),n=t.props.iconOnly;return l.a.createElement("span",{className:"dropdown-label"},l.a.createElement(xe.Shelves,{className:n&&"icon-only"}),Wc(e,a,n))},t}o()(t,e);var a=t.prototype;return a.renderShelfLink=function(){return l.a.createElement(Ya.DropdownMenuItem,null,l.a.createElement(Gc.a,{userId:this.props.user.get("id"),shelfName:this.props.shelfItem.get("shelf")},l.a.createElement(d.FormattedMessage,{id:"go_to_shelf"})))},a.renderRemoveButton=function(){return l.a.createElement(Ya.DropdownMenuItem,{handleClick:this.openRemovalModal,item:O.a.Map({label:l.a.createElement(d.FormattedMessage,{id:"button_remove_from_shelves"}),value:"remove-from-shelf"})})},a.renderPrivateSwitch=function(){return l.a.createElement(Ya.DropdownMenuItem,{closeOnClick:!1},l.a.createElement(qc.a,{id:"private-item",active:!!this.props.shelfItem.get("privateItem"),handleClick:this.togglePrivate,activeText:l.a.createElement(d.FormattedMessage,{id:"mark_as_private"}),inactiveText:l.a.createElement(d.FormattedMessage,{id:"mark_as_private"})}))},a.renderIOwnThisSwitch=function(){return l.a.createElement(Ya.DropdownMenuItem,{closeOnClick:!1},l.a.createElement(qc.a,{id:"i-own-this",active:!!this.props.iOwnThis,handleClick:this.toggleIOwnThis,activeText:l.a.createElement(d.FormattedMessage,{id:"button_i_own_this"}),inactiveText:l.a.createElement(d.FormattedMessage,{id:"button_i_own_this"})}))},a.render=function(){var e=this.props,t=e.bib,a=e.rounded,n=e.disabled,r=e.right,i=e.shelfTransactions,o=e.shelfItem,c=e.modalActions,s=e.shelfActions,u=e.handleDeleteSuccess,m=e.intl,p=e.iconOnly,f=i.get(t.get("id"))||O.a.Map(),g=f.get("isMoving",!1),h=f.get("isRemoving",!1),b=f.get("isUpdatingPrivacy",!1),v=m.formatMessage({id:"label_shelf_"+o.get("shelf")});return l.a.createElement("div",{className:"cp-on-shelf-dropdown"},l.a.createElement(Ya.Dropdown,{block:!p,right:r,rounded:a,disabled:n,isLoading:g||b,dataKey:"on-shelf-dropdown","aria-label":m.formatMessage({id:"item_on_shelf_cta"},{shelfName:v}),renderLabel:this.renderLabel,buttonTag:p&&Pe.IconButton},!p&&l.a.createElement(Ya.DropdownMenuHeader,null,l.a.createElement(d.FormattedMessage,{id:"move_to_shelf"})),this.renderMoveToShelfOptions(),l.a.createElement(Ya.DropdownMenuDivider,null),!this.context.mobileApp&&this.renderShelfLink(),this.renderRemoveButton(),l.a.createElement(Ya.DropdownMenuDivider,null),this.renderPrivateSwitch(),this.renderIOwnThisSwitch()),l.a.createElement(Vc.a,{modalActions:c,shelfActions:s,modalKey:this.removeModalKey,items:O.a.List.of(o),isLoading:h,postSuccess:u}))},t}(l.a.PureComponent);Yc.contextType=b.a;var Qc=Object(d.injectIntl)(Yc,{forwardRef:!0});var Zc=function(e){function t(){for(var t,a=arguments.length,n=new Array(a),r=0;r<a;r++)n[r]=arguments[r];return(t=e.call.apply(e,[this].concat(n))||this).dropdownRef=l.a.createRef(),t.addButtonRef=l.a.createRef(),t}o()(t,e);var a=t.prototype;return a.componentDidUpdate=function(e){var t=this.props,a=t.bib,n=t.shelfItem,r=t.shelfTransactions.get(a.get("id"));if(e.shelfTransactions.get(a.get("id"))&&!r){var i=!e.shelfItem&&n,o=e.shelfItem&&!n;i&&this.dropdownRef.current&&Object(Un.setFocusWithinElement)(this.dropdownRef.current),o&&this.addButtonRef.current&&Object(Un.setFocusWithinElement)(this.addButtonRef.current)}},a.renderContent=function(){return this.props.shelfItem&&this.props.user?l.a.createElement(Qc,r()({},this.props,{ref:this.dropdownRef})):l.a.createElement(Hc,r()({},this.props,{ref:this.addButtonRef}))},a.render=function(){var e=this.props,t=e.block,a=e.isLoading,n=Xe()("cp-shelf-actions-button",{"shelf-actions-button--block":t});return l.a.createElement("div",{className:n},a?l.a.createElement(Bo.a,{className:"button-placeholder",width:"170",height:"40",viewBox:"0 0 170 40",preserveAspectRatio:"none"},l.a.createElement("path",{d:"M165.526316,0 L4.47368421,0 C2.00293665,0 0,1.91877964 0,4.28571429 L0,35.7142857 C0,38.0812204 2.00293665,40 4.47368421,40 L165.526316,40 C167.997063,40 170,38.0812204 170,35.7142857 L170,4.28571429 C170,1.91877964 167.997063,0 165.526316,0 Z M4.47368421,0.952380952 L165.526316,0.952380952 C167.448008,0.952380952 169.005848,2.44476512 169.005848,4.28571429 L169.005848,35.7142857 C169.005848,37.5552349 167.448008,39.047619 165.526316,39.047619 L4.47368421,39.047619 C2.55199166,39.047619 0.994152047,37.5552349 0.994152047,35.7142857 L0.994152047,4.28571429 C0.994152047,2.44476512 2.55199166,0.952380952 4.47368421,0.952380952 Z"})):this.renderContent())},t}(l.a.PureComponent),Xc=a(2894),Jc=a(2772),$c=function(e){function t(){return e.apply(this,arguments)||this}return o()(t,e),t.prototype.render=function(){return l.a.createElement(Zc,this.props)},t}(l.a.PureComponent),el=Object(m.connect)((function(e,t){var a=Object(Vo.f)(e).get(t.metadataId),n=e.getIn(["bibs","userTransactions","isFetching"],!1);return{shelfItem:a,isLoading:t.isLoading||n,bib:Object(C.d)(e).get(t.metadataId),shelfTransactions:Object(Vo.e)(e),user:Object(At.c)(e),iOwnThis:Object(Jc.b)(e).get(t.metadataId)}}),(function(e){return{shelfActions:Object(p.bindActionCreators)(zo.a,e),iOwnThisActions:Object(p.bindActionCreators)(Xc.a,e),modalActions:Object(p.bindActionCreators)(Bn.a,e),bibsActions:Object(p.bindActionCreators)(fn.a,e)}}))($c),tl=a(874),al=a.n(tl);function nl(e){return e.availabilityError?l.a.createElement(Qo.WarningAlert,{className:"cp-ils-offline-message"},l.a.createElement(d.FormattedMessage,{id:"outdated_availability_error"})):null}function rl(e,t){var a=l.a.createElement("span",{className:"circulation-count"},t),n=["volumes","total_copies"].includes(e)&&1!==t?"plural":"singular";return l.a.createElement("div",null,l.a.createElement("span",{"aria-hidden":!0,className:al()(e)+"-count"},l.a.createElement(d.FormattedMessage,{id:"circ_"+e+"_"+n,values:{count:a}})),l.a.createElement(Ye.a,null,l.a.createElement(d.FormattedMessage,{id:"circ_"+e+"_"+n,values:{count:t}})))}function il(e){var t=e.availabilityError,a=e.realtimeAvailability,n=e.currentLibrary,r=a.get("statusType"),i=a.get("totalCopies"),o=a.get("volumesCount"),c=a.get("availableCopies"),s=a.get("onOrderCopies"),u=a.get("heldCopies"),m="DIGITAL_ALWAYS_AVAILABLE"===a.get("localisedStatus"),p=n.get("hideHolds");return l.a.createElement("div",{className:"cp-circulation-info"},l.a.createElement("span",{className:"availability-status"},l.a.createElement(So.a,{rollUpStatus:a.get("statusType"),status:a.get("localisedStatus"),availabilityLocationType:a.get("availabilityLocationType")})),l.a.createElement(nl,{availabilityError:t}),l.a.createElement("div",{className:"circulation-details"},m?l.a.createElement(d.FormattedMessage,{id:"title_always_available",tagName:"span"}):l.a.createElement(l.a.Fragment,null,i&&"ON_ORDER"!==r?rl("total_copies",i):null,o?rl("volumes",o):null,c?rl("available",c):null,s?rl("on_order",s):null,p?null:rl("on_hold",u))))}var ol=a(188);function cl(e){var t=e.bib,a=e.digitalFormats;if(t.getIn(["policy","materialType"])!==eo.i)return null;var n,r=(n=a)&&n.size>0?l.a.createElement("div",null,l.a.createElement(d.FormattedMessage,{id:"digital_formats_label"},(function(e){return l.a.createElement("div",{className:"formats-label"},e)})),n.map((function(e,t){return l.a.createElement("span",{className:"digital-format",key:e.get("name")},l.a.createElement(ol.FormattedHTMLMessage,{id:"digiformat_"+e.get("name").toLowerCase()}),t<n.size-1?", ":"")}))):null,i=function(e){var t=e.get("policy"),a=t.getIn(["materialPolicy","quickStartUrl"]),n=t.getIn(["materialPolicy","helpUrl"]);if(!a||!n)return null;var r=l.a.createElement(qe.Link,{target:"_blank",className:"vendor-link",dataKey:"vendor-link",href:a},l.a.createElement(d.FormattedMessage,{id:"digital_service_type_"+t.get("provider").toLowerCase()})),i=l.a.createElement(qe.SecondaryLink,{target:"_blank",dataKey:"digital-help-link",href:n},l.a.createElement(d.FormattedMessage,{id:"help_with_digital_content"}));return l.a.createElement("div",{className:"digital-vendor-info"},l.a.createElement("div",{className:"digital-content-provider"},l.a.createElement(d.FormattedMessage,{id:"digital_content_provider",values:{link:r}})),i)}(t);return r||i?l.a.createElement("div",{className:"cp-digital-content-info"},r,i):null}var ll=a(2463),sl=a(2599);var ul=function(e){function t(t){var a;return(a=e.call(this,t)||this).state={x:0,y:0,scale:1},Object(xt.bindAll)(Pt()(a)),a}o()(t,e);var a=t.prototype;return a.handleMapUpdate=function(e){this.setState(e)},a.handleZoomIn=function(){this.setState((function(e){return{scale:Math.min(5,e.scale+.5)}}))},a.handleZoomOut=function(){this.setState((function(e){var t=Math.max(1,e.scale-.5);return{scale:t,x:1!==t?e.x:0,y:1!==t?e.y:0}}))},a.handlePrint=function(){var e=this.props.stackMap,t=this.props.currentLibrary.get("stackMap"),a=Object(_i.createQueryString)({callno:e.get("callno"),library:e.get("library"),location:e.get("location"),v:"pf"});Object(Mo.openPopUpWindow)({url:"https://"+t.get("domain")+".stackmap.com/view/?"+a,STACK_MAP_WINDOW_NAME:"stack-map",windowFeatures:{height:800,width:950,directories:0}})},a.renderShelfDetails=function(){var e=this.props,t=e.stackMap,a=e.currentLibrary,n=t.getIn(["maps",0],O.a.Map()),r=a.get("stackMap");return l.a.createElement("div",{className:"library-shelf-details"},l.a.createElement("div",{className:"library-name"},n.get("library")),n.get("floorname"),!r.get("hideRanges")&&function(e){var t=e.getIn(["ranges",0]),a=l.a.createElement("span",{className:"section"},t.get("rangename")),n=l.a.createElement("span",{className:"shelving-range"},t.get("callnoDisplay"));return l.a.createElement("div",{className:"range-details"},l.a.createElement(d.FormattedMessage,{id:"stack_map_section",values:{rangeName:a}}),","," ",l.a.createElement(d.FormattedMessage,{id:"stack_map_shelving_range",values:{callNoDisplay:n}}))}(n))},a.renderMapControls=function(){var e=l.a.createElement(Pe.IconButton,{className:"zoom-in",dataKey:"zoom-in-button",handleClick:this.handleZoomIn},l.a.createElement(xe.ZoomIn,null)),t=l.a.createElement(Pe.IconButton,{className:"zoom-out",dataKey:"zoom-out-button",handleClick:this.handleZoomOut},l.a.createElement(xe.ZoomOut,null)),a=l.a.createElement(Pe.IconButton,{className:"print",dataKey:"print-button",handleClick:this.handlePrint},l.a.createElement(xe.Print,null));return l.a.createElement("div",{className:"stack-map-controls"},e,t,a)},a.renderImage=function(){var e=this.props.stackMap.getIn(["maps",0],O.a.Map());return l.a.createElement("div",{className:"stack-map-panel","aria-hidden":!0},l.a.createElement(sl.PanZoom,r()({className:"stack-map-image-wrapper",handleUpdate:this.handleMapUpdate},this.state,{height:e.get("height"),width:e.get("width"),maxScale:5}),l.a.createElement("img",{className:"stack-map-image","data-key":"stack-map-image",alt:e.get("library"),src:e.get("mapurl")+"&marker=1",loading:"eager"})))},a.renderDirections=function(){var e=this.props.stackMap.getIn(["maps",0],O.a.Map());return l.a.createElement("div",{className:"stack-map-directions"},l.a.createElement("div",{className:"additional-directions"},l.a.createElement(d.FormattedMessage,{id:"stack_map_additional_direction"})),e.get("directions"))},a.renderContent=function(){return this.props.stackMapTransactions.get("noResults")||!this.props.stackMap?l.a.createElement(Qo.WarningAlert,{className:"failure-warning"},l.a.createElement(d.FormattedMessage,{id:"stack_map_failure"})):l.a.createElement("div",null,this.renderShelfDetails(),this.renderMapControls(),this.renderImage(),l.a.createElement("div",{className:"powered-by"},l.a.createElement(d.FormattedMessage,{id:"stackmap_powered_by"})),this.renderDirections())},a.render=function(){return l.a.createElement("div",{className:"cp-stack-map-display"},this.props.stackMapTransactions.get("isFetching")?l.a.createElement(Bo.a,{className:"stack-map-placeholder",width:"709",height:"96",preserveAspectRatio:"none",viewBox:"0 0 709 96"},l.a.createElement("path",{fill:"currentColor",fillRule:"evenodd",d:"M365,84 L365,96 L0,96 L0,84 L365,84 Z M650,60 L650,72 L0,72 L0,60 L650,60 Z M709,36 L709,48 L0,48 L0,36 L709,36 Z M155,0 L155,16 L0,16 L0,0 L155,0 Z"})):this.renderContent())},t}(l.a.PureComponent),dl=a(2401);var ml=Object(m.connect)((function(e){return{stackMap:Object(dl.a)(e),stackMapTransactions:Object(dl.b)(e),currentLibrary:Object(k.b)(e)}}))((function(e){return l.a.createElement(ul,e)}));function pl(){return l.a.createElement(Bo.a,{width:"12",height:"12",viewBox:"0 0 12 12"},l.a.createElement("circle",{cx:"6",cy:"6",r:"6",fill:"#008000",fillRule:"evenodd"}))}function fl(){return l.a.createElement(Bo.a,{width:"12",height:"12",viewBox:"0 0 12 12"},l.a.createElement("path",{fill:"#A82009",fillRule:"evenodd",d:"M6,12 C2.6862915,12 0,9.3137085 0,6 C0,2.6862915 2.6862915,0 6,0 C9.3137085,0 12,2.6862915 12,6 C12,9.3137085 9.3137085,12 6,12 Z M4,4.7 C3.28202983,4.7 2.7,5.28202983 2.7,6 C2.7,6.71797017 3.28202983,7.3 4,7.3 L8,7.3 C8.71797017,7.3 9.3,6.71797017 9.3,6 C9.3,5.28202983 8.71797017,4.7 8,4.7 L4,4.7 Z"}))}var gl={AVAILABLE_ITEMS:l.a.createElement(pl,null),AVAILABLE_BY_REQUEST_ITEMS:l.a.createElement(pl,null),LIBRARY_USE_ONLY_ITEMS:l.a.createElement(pl,null),RESTRICTED_ACCESS_ITEMS:l.a.createElement(pl,null),NOT_AVAILABLE_ITEMS:l.a.createElement(fl,null)};function hl(e){var t=e.get("availability")||O.a.Map();return t.get("group")?t.get("group"):e.get("inSiteScope")?"AVAILABLE_ITEMS":"EXTENDED_AVAILABLE_ITEMS"}var bl=function(e){function t(t){var a;return a=e.call(this,t)||this,Object(xt.bindAll)(Pt()(a)),a.state={currentSortField:null,currentSortDirection:"asc"},a}o()(t,e);var a=t.prototype;return a.getSupportedFields=function(){var e=this.props.currentLibrary,t=e.get("showCollectionInCirc"),a=e.get("showDueDateInCirc"),n=e.get("singleBranch"),r=["callNumber","volume","copy","availability.libraryStatus"];return t&&r.unshift("collection"),a&&r.push("dueDate"),n||r.unshift("branch.name"),r},a.getTableItems=function(e){var t=this,a=this.props.bibItems,n=this.state,r=n.currentSortField,i=n.currentSortDirection;return(r?a.sort($o()(r,i)):a).map((function(a){return O.a.Map({itemId:a.get("itemId"),group:hl(a),statusType:a.getIn(["availability","statusType"]),cells:O.a.Map(e.map((function(e){return[e,t.renderCellContent(a,e)]})))})}))},a.handleSort=function(e){this.state.currentSortField===e?this.setState((function(e){return{currentSortDirection:"asc"===e.currentSortDirection?"desc":"asc"}})):this.setState({currentSortField:e,currentSortDirection:"asc"})},a.renderCellContent=function(e,t){switch(t){case"availability.libraryStatus":var a=e.getIn(["availability","status"]),n=e.getIn(["availability","libraryStatus"]),r=a===n?l.a.createElement(d.FormattedMessage,{id:"circ_"+a.toLowerCase()}):n;return r&&l.a.createElement("span",null,r);case"dueDate":var i=e.get("dueDate");return i&&l.a.createElement(rn.a,{value:i});case"collection":return l.a.createElement(l.a.Fragment,null,l.a.createElement("div",null,e.get("collection")),l.a.createElement(ll.a,{bibItem:e,handleClick:this.props.handleStackMapOpen}));default:return e.getIn(t.split("."))}},a.renderCaption=function(){var e=this.state,t=e.currentSortField,a=e.currentSortDirection;return t&&a&&l.a.createElement(d.FormattedMessage,{id:"table_sorted_by",values:{field:l.a.createElement(d.FormattedMessage,{id:t}),direction:l.a.createElement(d.FormattedMessage,{id:a})}})},a.renderTableHeader=function(e){var t=this,a=this.state,n=a.currentSortField,r=a.currentSortDirection;return l.a.createElement(Yt.TableHeader,null,e.map((function(e){return l.a.createElement(Yt.TableHeading,{sortable:!0,sortDirection:n===e?r:void 0,handleSort:function(){return t.handleSort(e)},key:e},l.a.createElement(d.FormattedMessage,{id:e}))})))},a.render=function(){var e=this.getSupportedFields(),t=this.getTableItems(e),a=t.groupBy((function(e){return e.get("group")})).toList().sortBy((function(e){return eo.a.indexOf(e.first().get("group"))})),n=e.filter((function(e){return t.some((function(t){return!!t.getIn(["cells",e])}))}));return l.a.createElement("div",{className:"cp-item-availability-table"},l.a.createElement(Yt.Table,{caption:this.renderCaption()},this.renderTableHeader(n),a.map((function(e){return l.a.createElement(Yt.TableBody,{key:e.first().get("group")},function(e,t){var a=e.first().get("group")||"";return l.a.createElement(Yt.TableRow,{className:"group-heading-row"},l.a.createElement(Yt.TableHeading,{colSpan:t.length},l.a.createElement(ze.a,{tagName:"h3",size:"medium",className:"availability-group-heading"},l.a.createElement("span",{className:"group-icon"},gl[a.replace(/EXTENDED_|IN_SCOPE_/,"")]),l.a.createElement(d.FormattedMessage,{id:"circ_group_count_"+a.toLowerCase(),values:{count:e.size}}))))}(e,n),function(e,t){return e.map((function(e){return l.a.createElement(Yt.TableRow,{className:"bib-item-row",key:e.get("itemId")},t.map((function(t){return l.a.createElement(Yt.TableCell,{key:t,label:l.a.createElement(d.FormattedMessage,{id:t}),blockLabel:!0},e.getIn(["cells",t]))})))}))}(e,n))}))))},t}(l.a.PureComponent);function vl(e){var t=e.notes;return l.a.createElement("div",{className:"cp-subscription-notes"},t.map((function(e,t){return l.a.createElement("ul",{className:"note-type",key:t.toLowerCase()+"-type"},function(e){return e.map((function(e,t){return l.a.createElement("li",{className:"note-content",key:t},e)})).toList()}(e))})).toList())}function El(e,t){switch(e){case"notes":var a=t.get(e).filter((function(e){return!!e.size}));return a.size>0&&l.a.createElement(vl,{notes:a});case"collection":var n=t.get(e);return n&&l.a.createElement("span",{className:"collection"},n);case"runDuration":var r=t.get(e);return r.size>0&&r.get(0).filter((function(e){return!!e})).map((function(e,t){var a="";return"beginText"===t&&(a+=e),"endText"===t&&(a+=" - "+e),"note"===t&&(a+=" ("+e+")"),a})).toList();default:return t.get(e)}}function yl(e){return function(e){var t=["collection","callNumbers","notes","mediaType","runDuration","status"];return O.a.Map(t.map((function(t){return[t,El(t,e)]}))).filter((function(e,a){return t.includes(a)&&!!e}))}(e).map((function(e,t){var a="callNumbers"===t?"callNumber":t;return l.a.createElement("div",{className:"subscription-field",key:t},l.a.createElement("div",{className:"field-label"},l.a.createElement(d.FormattedMessage,{id:a})),l.a.createElement("div",{className:"field-values"},e))})).toList()}function Il(e){var t=e.subscriptions;if(0===t.size)return null;var a=t.groupBy((function(e){return e.get("location")}));return l.a.createElement("div",{className:"cp-subscriptions"},a.map((function(e,t){return l.a.createElement("div",{className:"group",key:t.toLowerCase()},function(e){return l.a.createElement("div",{className:"subscription-group"},l.a.createElement(ze.a,{tagName:"h4",size:"modest",className:"subscription-heading"},e.first().get("location")),e.map((function(e){return l.a.createElement("div",{className:"subscription-content",key:e.get("id")},yl(e),l.a.createElement("br",null))})).toList())}(e),l.a.createElement(we.a,null))})).toList())}var Sl="circulation",Ol="subscription",_l=function(e){function t(){for(var t,a=arguments.length,n=new Array(a),r=0;r<a;r++)n[r]=arguments[r];return(t=e.call.apply(e,[this].concat(n))||this).state={stackMapOpen:!1,selectedTab:Ol},t.handleStackMapOpen=function(){t.setState({stackMapOpen:!0})},t.handleStackMapClose=function(){t.setState({stackMapOpen:!1})},t.handleTabSelect=function(e){t.setState({selectedTab:e})},t.renderTabContent=function(){switch(t.state.selectedTab){case Sl:return t.renderCirculation();case Ol:return t.renderSubscriptions();default:return null}},t}o()(t,e);var a=t.prototype;return a.renderCirculation=function(){var e=this.props,t=e.currentLibrary,a=e.bibItems;return l.a.createElement(bl,{bibItems:a,currentLibrary:t,handleStackMapOpen:this.handleStackMapOpen})},a.renderSubscriptions=function(){var e=this.props.subscriptions;return l.a.createElement(Il,{subscriptions:e})},a.renderTabs=function(){var e=this,t=[Ol,Sl].map((function(t){return{label:e.props.intl.formatMessage({id:"availability_modal_tab_"+t}),selected:t===e.state.selectedTab,value:t}}));return l.a.createElement(Ja.a,{options:t,renderContent:this.renderTabContent,handleSelect:this.handleTabSelect})},a.renderMainContent=function(){return this.props.isFetching?l.a.createElement(Yt.TableStencil,null):this.state.stackMapOpen?l.a.createElement(ml,null):this.props.bibItems.size>0&&this.props.subscriptions.size>0?this.renderTabs():this.props.bibItems.size>0?this.renderCirculation():this.props.subscriptions.size>0?this.renderSubscriptions():null},a.render=function(){var e=this.props,t=e.isFetching,a=e.metadataId,n=e.availabilityError,r=this.state.stackMapOpen?l.a.createElement(d.FormattedMessage,{id:"find_item"}):l.a.createElement(d.FormattedMessage,{id:"availability_details"});return l.a.createElement(ut.FullScreenOverlayBody,{className:"cp-availability-details"},l.a.createElement(ut.FullScreenOverlayHeader,{title:r}),l.a.createElement(ut.FullScreenOverlayContent,null,l.a.createElement(dt.b,{metadataId:a}),!t&&l.a.createElement(nl,{availabilityError:n}),this.renderMainContent()))},t}(l.a.PureComponent),Cl=Object(d.injectIntl)(_l),kl=function(e){function t(){return e.apply(this,arguments)||this}o()(t,e);var a=t.prototype;return a.componentDidMount=function(){var e=this.props,t=e.bibsActions,a=e.metadataId;t.fetchAvailability(a)},a.render=function(){return l.a.createElement(Cl,this.props)},t}(l.a.PureComponent),Al=Object(m.connect)((function(e){return{isFetching:e.getIn(["bibs","availability","isFetching"],!1),availabilityError:ho(e),bibItems:bo(e),subscriptions:vo(e),currentLibrary:Object(k.b)(e)}}),(function(e){return{bibsActions:Object(p.bindActionCreators)(fn.a,e)}}))(kl),Nl=Ge.availabilityEventComposer.composeViewAvailabilityEvent,Tl=function(e){function t(t){var a;return a=e.call(this,t)||this,Object(xt.bindAll)(Pt()(a)),a.state={open:!1},a}o()(t,e);var a=t.prototype;return a.handleOpen=function(){this.setState({open:!0});var e=this.props.bib.get("id"),t=this.props.availability.get("status");Object(Ve.sendAnalyticsEvents)(Nl({status:t,metadataId:e}))},a.handleClose=function(){this.setState({open:!1})},a.renderContent=function(){var e=this.props,t=e.bib,a=e.availability,n=t.getIn(["briefInfo","format"]);return l.a.createElement("span",null,l.a.createElement("span",{"aria-hidden":"true"},l.a.createElement(d.FormattedMessage,{id:"Availability.detailsLink"})),l.a.createElement(Ye.a,null,l.a.createElement(d.FormattedMessage,{id:"Availability.ada_detailsLink",values:{title:t.getIn(["briefInfo","title"]),format:l.a.createElement(d.FormattedMessage,{id:"FORMAT."+n.toLowerCase()}),status:l.a.createElement(So.a,{rollUpStatus:a.get("statusType"),status:a.get("localisedStatus"),availabilityLocationType:a.get("availabilityLocationType")})}})))},a.render=function(){var e=this.props,t=e.bib,a=e.linkTag,n=e.children,r=a||qe.SecondaryLink;return t.getIn(["policy","materialType"])===eo.j?l.a.createElement("div",{className:"cp-availability-details-link"},l.a.createElement(r,{href:"#availability-details-overlay",dataKey:"availability-details-link",handleClick:this.handleOpen,preventDefault:!0},n||this.renderContent()),l.a.createElement(Qe.a,{open:this.state.open,handleClose:this.handleClose,overlayKey:"availability-details-full-screen-overlay",dataKey:"availability-details-full-screen-overlay"},this.state.open&&l.a.createElement(Al,{metadataId:t.get("id")}))):null},t}(l.a.PureComponent);function Ml(e){var t=e.field,a=e.value;return a?l.a.createElement("div",{className:"cp-bib-item-field"},l.a.createElement("span",{className:"field-label"},t,":"),l.a.createElement("span",{className:"field-value"},a)):null}var jl=function(e){function t(){for(var t,a=arguments.length,n=new Array(a),r=0;r<a;r++)n[r]=arguments[r];return(t=e.call.apply(e,[this].concat(n))||this).state={stackMapOpen:!1},t.handleStackMapOpen=function(){t.setState({stackMapOpen:!0})},t.handleStackMapClose=function(){t.setState({stackMapOpen:!1})},t}o()(t,e);var a=t.prototype;return a.renderBranchInfo=function(){var e=this,t=this.props,a=t.realtimeAvailability,n=t.bibItems,r=t.preferredBranches;if("AVAILABLE"===a.get("statusType"))for(var i=function(t){var a=r.get(t),i=n.find((function(e){return function(e,t){return"AVAILABLE"===e.getIn(["availability","statusType"])&&e.getIn(["branch","code"])===t.get("code")}(e,a)}));if(i)return{v:l.a.createElement("div",{className:"branch-info"},l.a.createElement("div",{className:"branch-location"},l.a.createElement(d.FormattedMessage,{id:"find_at_branch_location",values:{branch:i.getIn(["branch","name"])}})),l.a.createElement(Ml,{field:l.a.createElement(d.FormattedMessage,{id:"collection"}),value:i.get("collection")}),l.a.createElement(Ml,{field:l.a.createElement(d.FormattedMessage,{id:"bib_call_number"}),value:i.get("callNumber")}),l.a.createElement(ll.a,{bibItem:i,handleClick:e.handleStackMapOpen}))}},o=0;o<r.size;o++){var c=i(o);if("object"==typeof c)return c.v}return null},a.renderStackMapOverlay=function(){var e=this.state.stackMapOpen;return l.a.createElement(Qe.a,{open:e,handleClose:this.handleStackMapClose,overlayKey:"stack-map-overlay",dataKey:"stack-map-overlay"},l.a.createElement(ut.FullScreenOverlayBody,null,l.a.createElement(ut.FullScreenOverlayHeader,{title:l.a.createElement(d.FormattedMessage,{id:"find_item"})}),l.a.createElement(ut.FullScreenOverlayContent,{size:"medium"},l.a.createElement(dt.b,{metadataId:this.props.bib.get("id")}),e&&l.a.createElement(ml,null))))},a.render=function(){var e=this.props,t=e.bib,a=e.bibItems,n=e.realtimeAvailability,r=e.subscriptions;return t.getIn(["policy","materialType"])===eo.j&&(a.size>0||r.size>0)?l.a.createElement("div",{className:"cp-branch-availability-info"},this.renderBranchInfo(),this.renderStackMapOverlay(),l.a.createElement(Tl,{bib:t,availability:n,linkTag:qe.ChevronLink},l.a.createElement("span",{"aria-hidden":!0},l.a.createElement(d.FormattedMessage,{id:"availability_by_location"})),l.a.createElement(Ye.a,null,l.a.createElement(d.FormattedMessage,{id:"sr_availability_by_location"})))):null},t}(l.a.PureComponent),Fl=Ge.bibHoldingsEventComposer.composeOnlineResourceClickEvent,Ll=g.CUSTOM_DIMENSIONS,wl=function(e){Object(Ve.sendAnalyticsEvents)(Fl({url:e,gtmContainerName:Ll.CONTAINER_NAMES.BIB_TRANSACT}))};function Bl(e){var t=e.realtimeAvailability,a=e.holdings;return t.get("bibType")!==eo.i&&a.size>0?l.a.createElement("div",{className:"cp-electronic-resource"},l.a.createElement("div",{className:"electronic-resource-label"},l.a.createElement(d.FormattedMessage,{id:"bib_online_resource"})),l.a.createElement(ri,{resources:a,handleClick:wl})):null}var Rl=a(517),Dl=a.n(Rl);function Pl(e){var t=e.currentLibrary,a=e.branches,n=e.preferredBranches,r=e.currentAccount,i=e.handleClose,o=e.suggestForPurchaseActions,s=e.suggestForPurchaseTransactions,u=e.currentUser,m=e.catalogBib,p=Object(c.useState)(""),f=p[0],g=p[1],h=Object(c.useState)(!1),b=h[0],v=h[1],E=Object(c.useState)(null),y=E[0],I=E[1],S=m.get("metadataId"),O=u.get("id"),_=t.getIn(["suggestForPurchase","lite","holdsOnSuggestedItems"]);function C(e){null==e||e.preventDefault(),o.submitLiteSuggestion({suggestion:{notes:f,branch:b?y:null,metadataId:S,userId:O},postSuccess:i})}return r&&l.a.createElement("form",{className:"cp-lite-suggestion-form",onSubmit:C},l.a.createElement(gi.ModalHeader,{title:l.a.createElement(d.FormattedMessage,{id:"suggest_for_purchase"})}),l.a.createElement(gi.ModalContent,null,l.a.createElement(dt.b,{metadataId:S}),l.a.createElement(Dl.a,{className:"lite-suggestion-form__suggestion-box",dataKey:"notes-textbox",id:"lite-suggestion-notes-textbox",label:l.a.createElement(d.FormattedMessage,{id:"suggest_for_purchase_suggestion_box"}),maxLength:1e3,minHeight:"9rem",handleChange:g,required:!0,value:f}),_&&a.size?l.a.createElement(l.a.Fragment,null,l.a.createElement(Po.a,{id:"place-hold-checkbox",dataKey:"place-hold-checkbox",label:l.a.createElement(d.FormattedMessage,{id:"suggest_for_purchase_place_hold"}),checked:b,handleChange:function(){return v(!b)}}),b?l.a.createElement(Zo,{branches:a,preferredBranches:n,currentAccount:r,selectedBranchCode:y,handleChange:I}):null):null),l.a.createElement(gi.ModalFooter,{renderPrimaryAction:function(){return l.a.createElement(Pe.TransactionalSolidButton,{disabled:!f||b&&!y,dataKey:"lite-suggestion-form-submit-button",handleClick:C,isLoading:s.get("isAdding")},l.a.createElement(d.FormattedMessage,{id:"button_submit"}))}}))}function xl(e){var t=e.currentLibrary,a=e.branches,n=e.preferredBranches,r=e.currentAccount,i=e.modalActions,o=e.suggestForPurchaseActions,c=e.suggestForPurchaseTransactions,s=e.currentUser,u=e.catalogBib;function m(){i.closeModal("suggest-for-purchase-lite-modal")}return l.a.createElement("div",{className:"cp-lite-suggestion-button"},l.a.createElement(Pe.SecondarySolidButton,{dataKey:"lite-suggestion-button",handleClick:function(){i.openModal("suggest-for-purchase-lite-modal",{accountRequired:!0})},block:!0},l.a.createElement(d.FormattedMessage,{id:"suggest_for_purchase"})),l.a.createElement(Hn.a,{modalKey:"suggest-for-purchase-lite-modal",handleClose:m},l.a.createElement(Pl,{handleClose:m,currentLibrary:t,branches:a,preferredBranches:n,currentAccount:r,suggestForPurchaseActions:o,suggestForPurchaseTransactions:c,currentUser:s,catalogBib:u})))}var Ul,Kl=Object(_.createSelector)([function(e){return e.get("suggestForPurchase",O.a.Map())}],(function(e){return e.get("suggestForPurchaseTransactions",O.a.Map())})),Hl=Object(_.createSelector)([C.z,At.c],(function(e,t){if(null!=t&&t.get("id")){var a=e.find((function(e){return e.get("ownerId")===t.get("id")}));return(null==a?void 0:a.toList())||O.a.List()}return O.a.List()})),zl=Object(_.createSelector)([C.F,At.c],(function(e,t){if(null!=t&&t.get("id")){var a=e.find((function(e){return e.get("ownerId")===t.get("id")}));return(null==a?void 0:a.toList())||O.a.List()}return O.a.List()})),ql=a(380);var Vl={submitLiteSuggestion:function(e,t){var a=t.route(Ul||(Ul=ke()(["/libraries/","/suggestforpurchase/litesuggestions"])),":librarySubdomain");return t.post(a,e)}},Gl=a(42),Wl=a(103);var Yl={submitLiteSuggestion:function(e){var t=e.suggestion,a=e.postSuccess;return{middlewareData:{authRequired:!0},types:[ql.a.SUBMIT_LITE_SUGGESTION_REQUEST,ql.a.SUBMIT_LITE_SUGGESTION_SUCCESS,ql.a.SUBMIT_LITE_SUGGESTION_FAILURE],apiRequest:function(e,a){return Vl.submitLiteSuggestion(t,a)},apiSuccess:function(){return{messaging:Object(Gl.a)("suggest_for_purchase_submitted")}},apiFailure:function(e){return{messaging:Object(Wl.a)(e.error)}},postSuccess:a}}};var Ql=Object(m.connect)((function(e){return{currentLibrary:Object(k.b)(e),branches:Object(k.f)(e),preferredBranches:Object(k.a)(e),currentAccount:Object(At.b)(e),suggestForPurchaseTransactions:Kl(e),currentUser:Object(At.c)(e),catalogBib:Object(E.b)(e)}}),(function(e){return{modalActions:Object(p.bindActionCreators)(Bn.a,e),suggestForPurchaseActions:Object(p.bindActionCreators)(Yl,e)}}))((function(e){return l.a.createElement(xl,e)}));function Zl(e){var t=e.message,a=Object(m.useSelector)(k.b).getIn(["suggestForPurchase","premium","enabled"]);return l.a.createElement("div",{className:"cp-suggest-for-purchase-info"},l.a.createElement("div",{className:"suggest-for-purchase-message"},t),a&&l.a.createElement(qe.Link,{block:!0,dataKey:"suggested-purchases-link",href:"/suggested_purchases"},l.a.createElement(d.FormattedMessage,{id:"view_suggested_purchases"})))}function Xl(e){var t,a,n=e.bib,r=e.catalogBib,i=e.currentLibrary,o=e.premiumSuggestionsSummary,c=i.getIn(["suggestForPurchase","premium","allowPatronSuggestions"]),s=Object(m.useDispatch)();function u(){var e=r.getIn(["brief","title"]),t=n.getIn(["briefInfo","isbns",0]),a=r.getIn(["brief","creators",0,"fullName"]),i=Object(Qa.metadataIdFixer)(r.get("metadataId"));s(v.a.redirect("/suggested_purchases",{authRequired:!0,method:"POST",data:{title:e,isbn:t,author:a,libBibId:i}}))}return l.a.createElement("div",{className:"cp-premium-suggestion-button"},(t=o.get("totalSuggestionsThisMonth"),a=o.get("suggestionsLimit"),c?t&&t>=a?l.a.createElement(Zl,{message:l.a.createElement(d.FormattedMessage,{id:"reach_suggestion_limit"})}):l.a.createElement(Pe.SecondarySolidButton,{handleClick:u,dataKey:"premium-suggestion-button",block:!0},l.a.createElement(d.FormattedMessage,{id:"suggest_for_purchase"})):l.a.createElement(Zl,{message:l.a.createElement(d.FormattedMessage,{id:"patron_suggestions_not_allowed"})})))}var Jl=Object(_.createSelector)([function(e){return e.getIn(["bibs","userTransactions"],O.a.Map())}],(function(e){return e.getIn(["suggestForPurchase","premiumSuggestions","summary"],O.a.Map())}));var $l=Object(m.connect)((function(e){var t=Object(E.b)(e),a=t.get("metadataId");return{bib:Object(C.d)(e).get(a),catalogBib:t,currentLibrary:Object(k.b)(e),premiumSuggestionsSummary:Jl(e)}}))((function(e){return l.a.createElement(Xl,e)}));function es(e){var t=e.currentLibrary,a=e.liteSuggestions,n=e.premiumSuggestions,r=t.getIn(["suggestForPurchase","externalLink"]),i=t.getIn(["suggestForPurchase","lite","enabled"]),o=t.getIn(["suggestForPurchase","premium","enabled"]);var c=r?l.a.createElement(qe.SecondarySolidLink,{href:r,dataKey:"external-suggestion-link",block:!0},l.a.createElement(d.FormattedMessage,{id:"suggest_for_purchase"})):null!=a&&a.size||null!=n&&n.size?l.a.createElement(Zl,{message:l.a.createElement(d.FormattedMessage,{id:"already_suggested_title"})}):i?l.a.createElement(Ql,null):o?l.a.createElement($l,null):null;return c?l.a.createElement("div",{className:"cp-suggest-for-purchase-button"},c):null}var ts=Object(m.connect)((function(e){return{currentLibrary:Object(k.b)(e),liteSuggestions:Hl(e),premiumSuggestions:zl(e)}}))((function(e){return l.a.createElement(es,e)}));var as=Object(d.injectIntl)((function(e){var t,a,n,r,i=e.realtimeAvailability,o=e.availabilityError,c=e.currentLibrary,s=e.catalogBib,u=e.intl,m="AvailabilityMatchError"===o;return l.a.createElement("div",{className:"cp-availability-error-info"},(a=0===(i&&i.get("totalCopies"))?"errors.NoAvailableCopies":"errors."+o,n=u.formatMessage({id:"availability_api_failure"}),r={libraryName:c.get("fullName")},l.a.createElement("strong",{className:"error-message"},l.a.createElement(d.FormattedMessage,{defaultMessage:n,id:a,values:r}))),(t="/v2/search?query="+encodeURIComponent(s.getIn(["brief","title"]))+"&searchType=title",l.a.createElement(qe.Link,{className:"search-link",href:t,dataKey:"search-link"},l.a.createElement(d.FormattedMessage,{id:"search_related_versions"}))),m&&l.a.createElement("div",null,l.a.createElement("div",{className:"match-error-disclaimer"},l.a.createElement(d.FormattedMessage,{id:"record_provided_by"})),l.a.createElement(ts,null)))}));function ns(e){var t=e.bib,a=e.bibItems,n=e.isLoaded,r=e.realtimeAvailability,i=e.preferredBranches,o=e.digitalFormats,c=e.availabilityError,s=e.catalogBib,u=e.currentLibrary,m=e.holdings,p=e.subscriptions,f=e.currentUser,g=e.bibsActions;function h(){return null!=f&&f.get("staff")?l.a.createElement(un,{block:!0,catalogBib:s,overlayKey:"add-to-list-overlay-transact-panel"}):null}function b(){var e=t.get("id");return l.a.createElement(el,{block:!0,metadataId:e,handleDeleteSuccess:function(){return g.fetchUGC(e)}})}return l.a.createElement("div",{className:"cp-transact-panel","data-key":"transact-panel"},l.a.createElement(Ye.a,null,l.a.createElement("h2",null,l.a.createElement(d.FormattedMessage,{id:"title_availability"}))),n&&t?function(){if(r){var e=r.get("bibType"),n=r.get("totalCopies"),f=(null==p?void 0:p.size)||0,g=t.getIn(["briefInfo","superFormats"]).includes("ELECTRONIC_FORMATS")&&u.get("hideCirculationForElectronicFormats");if("DIGITAL_RESOURCE"===e&&(0===n&&0===f||g))return l.a.createElement("div",{className:"panel-section electronic-section"},l.a.createElement(cl,{bib:t,digitalFormats:o}),l.a.createElement(Bl,{realtimeAvailability:r,holdings:m}),b(),h());if(n>0||f>0)return l.a.createElement("div",null,l.a.createElement("div",{className:"panel-section circulation-section"},l.a.createElement(il,{availabilityError:c,realtimeAvailability:r,currentLibrary:u})),l.a.createElement("div",{className:"panel-section availability-section"},l.a.createElement(jl,{bib:t,bibItems:a,preferredBranches:i,realtimeAvailability:r,subscriptions:p}),l.a.createElement(cl,{bib:t,digitalFormats:o}),l.a.createElement(Bl,{realtimeAvailability:r,holdings:m}),t.getIn(["policy","holdable"])?l.a.createElement(Pc,{block:!0,metadataId:t.get("id")}):l.a.createElement("div",{className:"non-holdable-title-info"},l.a.createElement(d.FormattedMessage,{id:"title_not_holdable"})),b(),h()))}return l.a.createElement("div",{className:"panel-section error-section"},l.a.createElement(as,{availabilityError:c,realtimeAvailability:r,currentLibrary:u,catalogBib:s}),b(),h())}():l.a.createElement("div",null,l.a.createElement("div",{className:"panel-section"},l.a.createElement(Bo.a,{className:"panel-placeholder",width:"264",height:"54",viewBox:"0 0 264 54",preserveAspectRatio:"none"},l.a.createElement("rect",{width:"187",height:"20",y:"5"}),l.a.createElement("rect",{width:"259",height:"14",y:"36"}))),l.a.createElement("div",{className:"panel-section"},l.a.createElement(Bo.a,{className:"panel-placeholder",width:"264",height:"152",viewBox:"0 0 264 152",preserveAspectRatio:"none"},l.a.createElement("rect",{width:"120",height:"14",y:"6"}),l.a.createElement("rect",{width:"264",height:"40",y:"44",rx:"4"}),l.a.createElement("path",{d:"M4.48301887,103 L259.516981,103 C261.992884,103 264,105.014719 264,107.5 L264,139.5 C264,141.985281 261.992884,144 259.516981,144 L4.48301887,144 C2.00711591,144 0,141.985281 0,139.5 L0,107.5 C0,105.014719 2.00711591,103 4.48301887,103 Z M4.48301887,104 C2.55731657,104 0.996226415,105.567003 0.996226415,107.5 L0.996226415,139.5 C0.996226415,141.432997 2.55731657,143 4.48301887,143 L259.516981,143 C261.442683,143 263.003774,141.432997 263.003774,139.5 L263.003774,107.5 C263.003774,105.567003 261.442683,104 259.516981,104 L4.48301887,104 Z"})))))}var rs=function(e){function t(){return e.apply(this,arguments)||this}return o()(t,e),t.prototype.render=function(){return l.a.createElement(ns,this.props)},t}(l.a.PureComponent),is=Object(m.connect)((function(e){var t=Object(E.b)(e),a=t.get("metadataId"),n=Object(C.d)(e).get(a),r=e.getIn(["bibs","availability","isLoaded"],!1),i=e.getIn(["bibs","userTransactions","isLoaded"],!1);return{bib:n,catalogBib:t,bibItems:bo(e),isLoaded:r&&i,realtimeAvailability:Object(C.c)(e).get(a),digitalFormats:Lo(e).get(a),preferredBranches:Object(k.a)(e),availabilityError:ho(e),currentLibrary:Object(k.b)(e),holdings:Eo(e),subscriptions:vo(e),currentUser:Object(At.c)(e)}}),(function(e){return{bibsActions:Object(p.bindActionCreators)(fn.a,e)}}))(rs),os=a(16),cs=a.n(os),ls=a(2904),ss=a.n(ls),us=a(527),ds=a.n(us),ms=a(788),ps=a.n(ms);function fs(e){var t=e.isActive,a=e.bib,n=e.formatsCount,r=e.availability,i=Object(d.useIntl)(),o=a.getIn(["briefInfo","format"]),c=a.getIn(["briefInfo","publicationDate"]),s=i.formatMessage({id:"FORMAT."+o.toLowerCase()}),u=r.get("statusType"),m=r.get("localisedStatus"),p=r.get("availabilityLocationType"),f=i.formatMessage({id:"circ_"+(m?m.toLowerCase():u.toLowerCase())},{location:p}),g=c?i.formatMessage({id:"format_chooser_sr_current_format"},{format:s,pubDate:c,availabilityStatus:f}):i.formatMessage({id:"format_chooser_sr_current_format_no_date"},{format:s,availabilityStatus:f}),h=i.formatMessage({id:"format_chooser_sr_also_offer_as"},{format:s,availabilityStatus:f});return l.a.createElement(Ye.a,{className:"cp-format-chooser-sr-message"},function(){if(n){var e=i.formatMessage({id:"format_chooser_sr_more_formats"},{count:n-1});return g+" "+e}return t?g:h}())}function gs(e){var t=e.bib,a=e.availability,n=e.showAvailability,r=e.showPublicationDate,i=e.showEdition,o=e.showCheckMark,c=e.formatsCount,s=t.getIn(["briefInfo","format"]),u=t.getIn(["briefInfo","publicationDate"]),m=t.getIn(["briefInfo","edition"]);return l.a.createElement("div",{className:"cp-bib-manifestation-info"},l.a.createElement(ps.a,{format:s}),l.a.createElement("div",{className:"manifestation-overview","aria-hidden":!0},l.a.createElement("span",{className:"bib-details"},l.a.createElement(d.FormattedMessage,{id:"FORMAT."+s.toLowerCase()}),!!u&&r&&l.a.createElement(ds.a,{publicationDate:u,separator:", "}),!!m&&i&&l.a.createElement(l.a.Fragment,null,"  ",m)),n&&l.a.createElement(So.a,{rollUpStatus:a.get("statusType"),status:a.get("localisedStatus"),availabilityLocationType:a.get("availabilityLocationType")})),l.a.createElement(fs,{isActive:r,bib:t,formatsCount:c,availability:a}),o&&l.a.createElement(xe.Checkmark,null))}var hs=["isActive","availability","bib","className","displayChevron","formatsCount"];function bs(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}var vs=Ge.bibFormatChooser.composeFormatPickerSelectionEvent;function Es(e){var t;function a(t){var a=e.bib;return l.a.createElement(Ya.DropdownMenuItem,{key:t.get("id"),handleClick:function(){Object(Ve.sendAnalyticsEvents)(vs(a.getIn(["briefInfo","format"])+" | other-edition"))}},l.a.createElement(Kt,{metadataId:t.getIn(["briefInfo","metadataId"]),dataKey:"edition-link"},l.a.createElement(gs,{bib:t,availability:t.get("availability"),showAvailability:!0,showPublicationDate:!0,showEdition:!0})))}var n=e.isActive,r=e.availability,i=e.bib,o=e.className,c=e.displayChevron,s=e.formatsCount,u=cs()(e,hs),m=r.get("statusType").toLowerCase(),p=Xe()("format-chooser-capsule-content",((t={})[m]=n,t)),f=function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?bs(Object(a),!0).forEach((function(t){I()(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):bs(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({active:n,className:Xe()("cp-format-chooser-capsule",o),contentClassName:p,dataKey:"format-chooser-capsule",renderSecondaryInfo:function(){var t=e.isActive,n=e.editions;return t?n&&n.size>0?l.a.createElement(Ya.Dropdown,{renderTrigger:function(e){return l.a.createElement(Pe.Button,{handleClick:e,type:"button",dataKey:"expand-editions",className:"expand-editions"},l.a.createElement(d.FormattedMessage,{tagName:"span",id:"additional_edition_count",values:{count:n.size}}),l.a.createElement(xe.ChevronDown,null))},dataKey:"editions-dropdown"},e.editions.map(a)):null:l.a.createElement(So.a,{"aria-hidden":!0,rollUpStatus:e.availability.get("statusType"),status:e.availability.get("localisedStatus"),availabilityLocationType:e.availability.get("availabilityLocationType")})}},u);return l.a.createElement(ss.a,f,l.a.createElement(gs,{bib:i,availability:r,showPublicationDate:n,formatsCount:s}),c&&l.a.createElement(xe.ChevronRight,null))}Es.defaultProps={displayChevron:!0};var ys=Es,Is=Ge.bibFormatChooser.composeFormatPickerSelectionEvent,Ss=Ge.bibFormatChooser.composeFormatPickerExpandEvent;var Os=function(e){function t(t){var a;return a=e.call(this,t)||this,Object(xt.bindAll)(Pt()(a)),a}o()(t,e);var a=t.prototype;return a.renderMenu=function(){return this.props.manifestations.map((function(e){return function(e){return l.a.createElement(Ya.DropdownMenuItem,{key:"format-"+e.getIn(["briefInfo","format"]).toLowerCase(),handleClick:function(){Object(Ve.sendAnalyticsEvents)(Is(e.getIn(["briefInfo","format"])))}},l.a.createElement(Kt,{metadataId:e.getIn(["briefInfo","metadataId"])},l.a.createElement(gs,{bib:e,availability:e.get("availability"),showAvailability:!0})))}(e)})).toArray()},a.renderTrigger=function(e,t){return l.a.createElement(Pe.Button,{className:"more-formats-button",handleClick:function(){e(),Object(Ve.sendAnalyticsEvents)(Ss(!t))}},l.a.createElement("span",{"aria-hidden":!0},"+",this.props.manifestations.size),l.a.createElement(Ye.a,null,l.a.createElement(d.FormattedMessage,{id:"format_chooser_sr_more_formats",values:{count:this.props.manifestations.size}})))},a.render=function(){return l.a.createElement("div",{className:"cp-more-formats-dropdown"},l.a.createElement(Ya.Dropdown,{right:!0,className:"formats-dropdown",renderTrigger:this.renderTrigger,dataKey:"more-formats-dropdown"},this.renderMenu()))},t}(l.a.PureComponent),_s=Ge.bibFormatChooser.composeFormatPickerSelectionEvent;var Cs=function(e){function t(t){var a;return a=e.call(this,t)||this,Object(xt.bindAll)(Pt()(a)),a}o()(t,e);var a=t.prototype;return a.renderViewAllLink=function(){var e=this.props,t=e.catalogBib,a=e.summary,n="/v2/search?query=groupKey:"+encodeURIComponent(a.get("groupKey"))+"&searchType=bl&title="+encodeURIComponent(t.getIn(["brief","title"]));return l.a.createElement("div",{className:"view-all-link"},a.get("editionsCount")>1&&l.a.createElement(qe.Link,{className:"view-all-formats-editions-link",dataKey:"view-all-formats-editions-link",href:n},l.a.createElement(d.FormattedMessage,{id:"view_all_formats_and_edition"})))},a.renderManifestations=function(){var e=this.props,t=e.realtimeAvailabilities,a=e.catalogBib,n=function(e){var n=e.get("id")===a.get("id"),r=t.get(e.get("id"),e.get("availability")),i="manifestation-link-"+e.get("id");return l.a.createElement(qe.Link,{className:"manifestation-link",dataKey:i,key:i,href:"/v2/record/"+e.get("id"),handleClick:function(){return function(e){Object(Ve.sendAnalyticsEvents)(_s(e.getIn(["briefInfo","format"])))}(e)}},l.a.createElement(gs,{key:e.get("id"),bib:e,availability:r,showPublicationDate:n,showCheckMark:n,showAvailability:!0}),l.a.createElement(we.a,null))};return this.props.manifestations.map((function(e){return n(e)}))},a.render=function(){return l.a.createElement(Hn.a,{className:"cp-format-chooser-modal",modalKey:eo.g,handleClose:this.props.handleClose,size:"small"},l.a.createElement(gi.ModalHeader,{title:l.a.createElement(d.FormattedMessage,{id:"select_a_format"})}),l.a.createElement(gi.ModalContent,null,l.a.createElement(we.a,null),this.renderManifestations(),this.renderViewAllLink()))},t}(l.a.PureComponent),ks=Ge.bibFormatChooser.composeFormatPickerSelectionEvent,As=function(e){function t(t){var a;return a=e.call(this,t)||this,Object(xt.bindAll)(Pt()(a)),a}o()(t,e);var a=t.prototype;return a.handleOpen=function(e){e.preventDefault(),this.props.modalActions.openModal(eo.g,{authRequired:!1})},a.handleClose=function(){this.props.modalActions.closeModal(eo.g)},a.renderMoreFormatsDropdown=function(){return this.props.manifestations.size>3?l.a.createElement(Os,{manifestations:this.props.manifestations.slice(3)}):null},a.renderMobile=function(){var e=this.props,t=e.manifestations,a=e.realtimeAvailabilities,n=e.catalogBib,r=e.summary,i=t.find((function(e){return e.get("id")===n.get("id")})),o=a.get(i.get("id"),i.get("availability")),c=t.size,s=c>1;return l.a.createElement("div",{className:"format-chooser-capsule-mobile"},l.a.createElement(ys,{href:s?"#format-chooser-modal":void 0,handleClick:s?this.handleOpen:void 0,isActive:!0,className:"capsule-mobile",availability:o,bib:i,displayChevron:s,formatsCount:c}),l.a.createElement(Cs,{catalogBib:n,summary:r,handleClose:this.handleClose,manifestations:t,realtimeAvailabilities:a}))},a.renderDesktop=function(){var e=this.props,t=e.realtimeAvailabilities,a=e.catalogBib,n=e.editions;return l.a.createElement("div",{className:"format-chooser-capsule-desktop"},this.props.manifestations.slice(0,3).map((function(e){var r=e.get("id")===a.get("id"),i=t.get(e.get("id"),e.get("availability"));return l.a.createElement(ys,{href:r?void 0:"/v2/record/"+e.get("id"),handleClick:r?void 0:function(){return function(e){Object(Ve.sendAnalyticsEvents)(ks(e.getIn(["briefInfo","format"])))}(e)},className:"capsule-desktop",key:"format-chooser-capsule-desktop-"+e.get("id"),availability:i,bib:e,editions:n,isActive:r})})),this.renderMoreFormatsDropdown())},a.render=function(){return l.a.createElement("div",{className:"cp-format-chooser"},this.renderDesktop(),this.renderMobile())},t}(l.a.PureComponent),Ns=function(e){function t(){return e.apply(this,arguments)||this}return o()(t,e),t.prototype.render=function(){return l.a.createElement(As,this.props)},t}(l.a.PureComponent),Ts=Object(m.connect)((function(e){return{catalogBib:Object(E.b)(e),realtimeAvailabilities:Object(C.c)(e),manifestations:U(e),editions:H(e),summary:K(e)}}),(function(e){return{modalActions:Object(p.bindActionCreators)(Bn.a,e)}}))(Ns),Ms=Ge.bibMetadataEventComposer.composeReadMoreEvent,js=g.CUSTOM_DIMENSIONS;function Fs(e){Object(Ve.sendAnalyticsEvents)(Ms({expanded:e,gtmContainerName:js.CONTAINER_NAMES.TRANSACT_DESCRIPTION}))}var Ls=function(e){function t(){return e.apply(this,arguments)||this}return o()(t,e),t.prototype.render=function(){var e=this.props.catalogBib,t=e.getIn(["brief","description"],"");return t?l.a.createElement("div",{className:"cp-bib-description"},l.a.createElement(Mt.ExpandableHtml,{truncateCount:325,htmlText:t,expandLinkHref:"#read-more-bib-"+e.get("metadataId"),textKey:"about_the_title",handleToggle:Fs})):null},t}(l.a.PureComponent);var ws=function(e){var t=e.catalogBib,a=Object(c.useContext)(b.a).mobileApp,n=t.getIn(["brief","format"]),r=t.getIn(["brief","coverImage"]),i=t.get("metadataId"),o=Xe()("cp-bib-transact container",{"bib-transact--mobile-app":a});return l.a.createElement("section",{className:o},l.a.createElement("div",{className:"row"},l.a.createElement("div",{className:"col-md-2 col-lg-3"},l.a.createElement(Ut.a,{format:n,cover:r,metadataId:i}),l.a.createElement("div",{className:"cp-bib-excerpt-desktop"},l.a.createElement(fo,null))),l.a.createElement("div",{className:"col-md-5 col-lg-5 col-xl-6 main-info"},l.a.createElement(dr.a,{catalogBib:t,secondaryClassName:"secondary-title"}),l.a.createElement(hr,{catalogBib:t}),l.a.createElement(ro,null),l.a.createElement("div",{className:"rating-info"},l.a.createElement(Ji.a,{metadataId:i}),l.a.createElement($i.a,{metadataId:i})),l.a.createElement(Ts,null),l.a.createElement(Ls,{catalogBib:t}),l.a.createElement("div",{className:"cp-bib-excerpt-mobile"},l.a.createElement(fo,null))),l.a.createElement("div",{className:"col-md-5 col-lg-4 col-xl-3 transact-panel"},l.a.createElement(is,null),l.a.createElement(To,null),l.a.createElement(Fo,null))))},Bs=function(e){function t(){return e.apply(this,arguments)||this}return o()(t,e),t.prototype.render=function(){var e=this.props,t=e.catalogBib,a=e.staffLists,n=e.recommendations,r=e.relatedTitles,i=e.tags,o=e.authorSuggestions,c=e.relatedAuthors,s=e.onlineResources,u=l.a.createElement("div",{className:"container"},l.a.createElement(we.a,null));return l.a.createElement("div",{className:"cp-bib-page","data-key":"bib-page"},l.a.createElement("div",{className:"container"},l.a.createElement(Ke,null)),l.a.createElement(ws,{catalogBib:t}),u,l.a.createElement(Ri,{catalogBib:t}),l.a.createElement(Va,{catalogBib:t}),u,l.a.createElement(Xi,{catalogBib:t}),l.a.createElement(Tr,{catalogBib:t,staffLists:a,recommendations:n}),l.a.createElement(mi,{catalogBib:t,tags:i,relatedTitles:r,authorSuggestions:o,relatedAuthors:c,onlineResources:s}),l.a.createElement(or,{catalogBib:t}))},t}(l.a.PureComponent),Rs=function(e){function t(){return e.apply(this,arguments)||this}o()(t,e);var a=t.prototype;return a.renderDocumentHead=function(){var e=this.props,t=e.catalogBib,a=e.linkedData,n=t.getIn(["brief","title"]),r=t.getIn(["brief","coverImage","large"]),i=t.getIn(["brief","creators",0,"fullName"]),o=u()([n,i,t.getIn(["brief","description"])]).join("  "),c=this.context.baseURL+"/v2/record/"+t.get("metadataId"),s="UNMATCHED"===t.get("localizationLevel");return l.a.createElement(ye.a,{pageTitle:n,description:o,imageUrl:r,linkedData:a,pageUrl:c,noIndex:s})},a.render=function(){var e=this.props,t=e.catalogBib,a=e.staffLists,n=e.recommendations,i=e.tags,o=e.relatedTitles,c=e.authorSuggestions,s=e.relatedAuthors,u=e.analyticsContext,d=e.onlineResources;if(t){var m={staffLists:a,recommendations:n,relatedTitles:o,tags:i,authorSuggestions:c,relatedAuthors:s,onlineResources:d};return l.a.createElement("div",null,this.renderDocumentHead(),l.a.createElement(je,{context:u,contextName:g.CONTEXTS.BIB}),l.a.createElement(Bs,r()({catalogBib:this.props.catalogBib},m)))}return l.a.createElement(Fe.a,null)},t}(l.a.PureComponent);Rs.contextType=b.a;t.default=Object(f.withRouter)(Object(m.connect)((function(e){return{catalogBib:Object(E.b)(e),linkedData:x(e),analyticsContext:Q(e),previewFeatures:Object(oe.a)(e),staffLists:he(e),relatedTitles:pe(e),recommendations:me(e),tags:te(e),authorSuggestions:fe(e),relatedAuthors:G(e),onlineResources:Y(e)}}),(function(e){return{redirectActions:Object(p.bindActionCreators)(v.a,e)}}))(Object(d.injectIntl)(Rs)))}}]);
//# sourceMappingURL=app.app-components-bibs-BibPage-BibPageContainer-8823a1671eeedcfd122c.js.map